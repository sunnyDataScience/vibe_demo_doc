# Module 3ï¼šè³‡æ–™å“è³ªèˆ‡è™•ç†
## æ™‚é–“ï¼š13:00-14:00ï¼ˆ60åˆ†é˜ï¼‰

ğŸ“ **è³‡æ–™é›†ï¼šSupermarket Salesï¼ˆç¹¼çºŒä½¿ç”¨ï¼‰- æ¸…æ´—å’Œè™•ç†å¯¦ä½œ**

---

## æ™‚é–“é…ç½®
- **13:00-13:20**ï¼šè³‡æ–™å“è³ªæª¢æŸ¥ï¼ˆ20åˆ†é˜ï¼‰
- **13:20-13:40**ï¼šç¼ºå¤±å€¼è™•ç†ç­–ç•¥ï¼ˆ20åˆ†é˜ï¼‰
- **13:40-14:00**ï¼šç•°å¸¸å€¼æª¢æ¸¬èˆ‡è™•ç†ï¼ˆ20åˆ†é˜ï¼‰

---

## Part 1ï¼šè³‡æ–™å“è³ªæª¢æŸ¥ï¼ˆ20åˆ†é˜ï¼‰

### æª¢æŸ¥é …ç›®
```
ã€å®Œæ•´æ€§æª¢æŸ¥ã€‘
1. ç©ºå€¼æ•¸é‡èˆ‡åˆ†å¸ƒ
   - æ¯å€‹æ¬„ä½çš„ç¼ºå¤±æƒ…æ³
   - ç¼ºå¤±æ¨¡å¼åˆ†æï¼ˆéš¨æ©Ÿ/ç³»çµ±æ€§ï¼‰

2. å¿…å¡«æ¬„ä½å®Œæ•´åº¦
   - æ¥­å‹™é—œéµæ¬„ä½
   - å”¯ä¸€è­˜åˆ¥æ¬„ä½

ã€ä¸€è‡´æ€§æª¢æŸ¥ã€‘
1. è³‡æ–™æ ¼å¼çµ±ä¸€æ€§
   - æ—¥æœŸæ ¼å¼ï¼ˆYYYY-MM-DD vs MM/DD/YYï¼‰
   - æ•¸å€¼æ ¼å¼ï¼ˆå°æ•¸ä½æ•¸ï¼‰
   - æ–‡å­—å¤§å°å¯«

2. å–®ä½ä¸€è‡´æ€§
   - è²¨å¹£å–®ä½
   - åº¦é‡å–®ä½
   - æ™‚å€çµ±ä¸€

ã€åˆç†æ€§æª¢æŸ¥ã€‘
1. æ•¸å€¼ç¯„åœé©—è­‰
   - åƒ¹æ ¼ä¸èƒ½ç‚ºè² 
   - æŠ˜æ‰£åœ¨0-100%ä¹‹é–“
   - å¹´é½¡åœ¨åˆç†ç¯„åœ

2. é‚è¼¯é—œä¿‚é©—è­‰
   - çµæŸæ—¥æœŸ > é–‹å§‹æ—¥æœŸ
   - ç¸½åƒ¹ = å–®åƒ¹ Ã— æ•¸é‡
   - åˆ†é¡èˆ‡å­åˆ†é¡å°æ‡‰
```

### å¯¦ä½œç·´ç¿’ï¼šå“è³ªæª¢æŸ¥å ±å‘Š
```python
# ä»»å‹™ï¼šç”¢ç”Ÿè³‡æ–™å“è³ªå ±å‘Š
# æ­¥é©Ÿï¼š
# 1. æª¢æŸ¥ç¼ºå¤±å€¼
df.isnull().sum()

# 2. æª¢æŸ¥é‡è¤‡å€¼
df.duplicated().sum()

# 3. æª¢æŸ¥è³‡æ–™é¡å‹
df.dtypes

# 4. æ•¸å€¼æ¬„ä½ç¯„åœ
df.describe()

# 5. å”¯ä¸€å€¼æª¢æŸ¥
df.nunique()
```

### Prompt æ¨¡æ¿
```
"è«‹æª¢æŸ¥è³‡æ–™å“è³ªï¼ŒåŒ…å«ï¼š
1. æ¯å€‹æ¬„ä½çš„ç¼ºå¤±å€¼æ•¸é‡å’Œç™¾åˆ†æ¯”
2. é‡è¤‡è¨˜éŒ„çš„æ•¸é‡
3. æ•¸å€¼æ¬„ä½çš„ç•°å¸¸å€¼ï¼ˆè¶…å‡ºåˆç†ç¯„åœï¼‰
4. è³‡æ–™åˆ†å¸ƒçš„åŸºæœ¬çµ±è¨ˆ
5. ç”¢ç”Ÿå“è³ªè©•åˆ†å’Œæ”¹é€²å»ºè­°"
```

---

## Part 2ï¼šç¼ºå¤±å€¼è™•ç†ç­–ç•¥ï¼ˆ20åˆ†é˜ï¼‰

### è™•ç†æ–¹æ³•æ±ºç­–æ¡†æ¶

#### 1. åˆªé™¤æ³•
```python
# æ•´åˆ—åˆªé™¤ï¼ˆè¨˜éŒ„å±¤ç´šï¼‰
# é©ç”¨ï¼šç¼ºå¤±å€¼å¤ªå¤šï¼Œç„¡æ³•æä¾›æœ‰ç”¨è³‡è¨Š
df_clean = df.dropna()  # åˆªé™¤ä»»ä½•å«ç©ºå€¼çš„åˆ—

# æ•´æ¬„åˆªé™¤ï¼ˆæ¬„ä½å±¤ç´šï¼‰
# é©ç”¨ï¼šæŸæ¬„ä½ç¼ºå¤±ç‡éé«˜ï¼ˆå¦‚>50%ï¼‰
df_clean = df.dropna(axis=1, thresh=len(df)*0.5)

# æ¢ä»¶åˆªé™¤
# é©ç”¨ï¼šé—œéµæ¬„ä½ç¼ºå¤±
df_clean = df.dropna(subset=['CustomerID', 'Total'])
```

#### 2. å¡«è£œæ³•
```python
# å›ºå®šå€¼å¡«è£œ
df['Category'].fillna('Unknown', inplace=True)
df['Quantity'].fillna(0, inplace=True)

# çµ±è¨ˆå€¼å¡«è£œ
df['Age'].fillna(df['Age'].mean(), inplace=True)  # å¹³å‡å€¼
df['Income'].fillna(df['Income'].median(), inplace=True)  # ä¸­ä½æ•¸
df['Product'].fillna(df['Product'].mode()[0], inplace=True)  # çœ¾æ•¸

# å‰å‘/å¾Œå‘å¡«è£œ
df['Date'].fillna(method='ffill', inplace=True)  # ç”¨å‰ä¸€ç­†
df['Status'].fillna(method='bfill', inplace=True)  # ç”¨å¾Œä¸€ç­†

# æ’å€¼æ³•
df['Temperature'].interpolate(method='linear', inplace=True)
```

### æ±ºç­–æŒ‡å—
| ç¼ºå¤±ç‡ | å»ºè­°è™•ç†æ–¹å¼ | ç†ç”± |
|:------|:-----------|:-----|
| <5% | ç°¡å–®åˆªé™¤æˆ–å‡å€¼å¡«è£œ | å½±éŸ¿å° |
| 5-20% | æ ¹æ“šæ¥­å‹™é‚è¼¯å¡«è£œ | éœ€è¬¹æ…è™•ç† |
| 20-50% | è€ƒæ…®ä½œç‚ºç‰¹å¾µæˆ–åˆ†ç¾¤è™•ç† | å¯èƒ½æœ‰æ„ç¾© |
| >50% | åˆªé™¤æ¬„ä½ | è³‡è¨Šåƒ¹å€¼ä½ |

### Prompt æ¨¡æ¿
```
"è³‡æ–™ä¸­ [æ¬„ä½å] æœ‰ X% ç¼ºå¤±å€¼ï¼Œ
è³‡æ–™é¡å‹æ˜¯ [é¡å‹]ï¼Œ
æ¥­å‹™ä¸Šä»£è¡¨ [æ„ç¾©]ï¼Œ
è«‹å»ºè­°è™•ç†æ–¹å¼ä¸¦å¯¦ä½œ"
```

---

## Part 3ï¼šç•°å¸¸å€¼æª¢æ¸¬èˆ‡è™•ç†ï¼ˆ20åˆ†é˜ï¼‰

### 3-1 çµ±è¨ˆæ–¹æ³•æª¢æ¸¬
```python
# 3å€æ¨™æº–å·®æ³•å‰‡
mean = df['Total'].mean()
std = df['Total'].std()
lower_bound = mean - 3*std
upper_bound = mean + 3*std
outliers = df[(df['Total'] < lower_bound) | (df['Total'] > upper_bound)]

# å››åˆ†ä½è·ï¼ˆIQRï¼‰æ³•
Q1 = df['Total'].quantile(0.25)
Q3 = df['Total'].quantile(0.75)
IQR = Q3 - Q1
lower_bound = Q1 - 1.5*IQR
upper_bound = Q3 + 1.5*IQR
outliers = df[(df['Total'] < lower_bound) | (df['Total'] > upper_bound)]

# Z-Scoreæ–¹æ³•
from scipy import stats
z_scores = stats.zscore(df['Total'])
outliers = df[abs(z_scores) > 3]
```

### 3-2 æ¥­å‹™é‚è¼¯æª¢æ¸¬
```python
# æ¥­å‹™è¦å‰‡é©—è­‰
# å¹´é½¡ç•°å¸¸
age_outliers = df[(df['Age'] < 0) | (df['Age'] > 150)]

# æŠ˜æ‰£ç•°å¸¸
discount_outliers = df[(df['Discount'] < 0) | (df['Discount'] > 100)]

# é‚è¼¯é—œä¿‚ç•°å¸¸
logic_outliers = df[df['Total'] != df['Unit_Price'] * df['Quantity']]
```

### 3-3 è™•ç†ç­–ç•¥

#### è™•ç†æ±ºç­–æµç¨‹
```
ç™¼ç¾ç•°å¸¸å€¼
    â†“
æ˜¯å¦ç‚ºéŒ¯èª¤ï¼Ÿ
    â”œâ”€æ˜¯â†’ ä¿®æ­£æˆ–åˆªé™¤
    â””â”€å¦â†’ æ˜¯å¦ç‚ºç‰¹æ®Šæƒ…æ³ï¼Ÿ
           â”œâ”€æ˜¯â†’ ä¿ç•™ä¸¦æ¨™è¨˜
           â””â”€å¦â†’ è©•ä¼°å½±éŸ¿
                  â”œâ”€å½±éŸ¿å¤§â†’ è™•ç†ï¼ˆcap/transformï¼‰
                  â””â”€å½±éŸ¿å°â†’ ä¿ç•™
```

#### è™•ç†æ–¹æ³•
```python
# 1. åˆªé™¤
df_clean = df[df['Total'] < upper_bound]

# 2. æˆªå°¾ï¼ˆCappingï¼‰
df.loc[df['Total'] > upper_bound, 'Total'] = upper_bound
df.loc[df['Total'] < lower_bound, 'Total'] = lower_bound

# 3. è½‰æ›
df['Total_log'] = np.log1p(df['Total'])  # å°æ•¸è½‰æ›

# 4. åˆ†ç¾¤è™•ç†
df['is_outlier'] = (df['Total'] > upper_bound).astype(int)
# åˆ†é–‹å»ºæ¨¡æˆ–åˆ†æ
```

### Prompt æ¨¡æ¿
```
"è«‹æª¢æ¸¬ [æ¬„ä½] çš„ç•°å¸¸å€¼ï¼Œ
ä½¿ç”¨ [IQRæ³•/3å€æ¨™æº–å·®/æ¥­å‹™è¦å‰‡]ï¼Œ
æ‰¾å‡ºç•°å¸¸å¾Œï¼š
1. é¡¯ç¤ºç•°å¸¸å€¼æ•¸é‡å’Œæ¯”ä¾‹
2. è¦–è¦ºåŒ–ç•°å¸¸å€¼åˆ†å¸ƒ
3. å»ºè­°è™•ç†æ–¹å¼
4. å¯¦æ–½è™•ç†ä¸¦é©—è­‰çµæœ"
```

---

## å¯¦æˆ°æ¡ˆä¾‹ï¼šå®Œæ•´çš„è³‡æ–™æ¸…æ´—æµç¨‹

### ç¶œåˆç·´ç¿’ï¼ˆ15åˆ†é˜ï¼‰
```python
# ä»»å‹™ï¼šæ¸…æ´—Supermarket Salesæ•¸æ“š
# ç›®æ¨™ï¼šæº–å‚™ä¹¾æ·¨çš„è³‡æ–™é›†ä¾›å¾ŒçºŒåˆ†æ

# Step 1: å“è³ªè©•ä¼°
print("=== è³‡æ–™å“è³ªå ±å‘Š ===")
print(f"è³‡æ–™å½¢ç‹€: {df.shape}")
print(f"ç¼ºå¤±å€¼ç¸½æ•¸: {df.isnull().sum().sum()}")
print(f"é‡è¤‡è¨˜éŒ„: {df.duplicated().sum()}")

# Step 2: è™•ç†ç¼ºå¤±å€¼
# æ ¹æ“šæ¥­å‹™é‚è¼¯è™•ç†
df['Product line'].fillna('General', inplace=True)
df['Customer type'].fillna('Normal', inplace=True)

# Step 3: è™•ç†ç•°å¸¸å€¼
# IQRæ–¹æ³•
for col in ['Total', 'Quantity', 'Unit price']:
    Q1 = df[col].quantile(0.25)
    Q3 = df[col].quantile(0.75)
    IQR = Q3 - Q1
    df = df[~((df[col] < Q1 - 1.5*IQR) |
              (df[col] > Q3 + 1.5*IQR))]

# Step 4: è³‡æ–™è½‰æ›
df['Date'] = pd.to_datetime(df['Date'])
df['Month'] = df['Date'].dt.month
df['Weekday'] = df['Date'].dt.day_name()

# Step 5: é©—è­‰æ¸…æ´—çµæœ
print("\n=== æ¸…æ´—å¾Œè³‡æ–™å“è³ª ===")
print(f"è³‡æ–™å½¢ç‹€: {df.shape}")
print(f"ä¿ç•™æ¯”ä¾‹: {len(df)/len(df_original)*100:.1f}%")
```

---

## é‡é»æ•´ç†

### è³‡æ–™æ¸…æ´—ä¸‰æ­¥é©Ÿ
1. **æª¢æŸ¥**ï¼šäº†è§£è³‡æ–™å•é¡Œ
2. **æ±ºç­–**ï¼šé¸æ“‡è™•ç†ç­–ç•¥
3. **åŸ·è¡Œ**ï¼šå¯¦æ–½ä¸¦é©—è­‰

### å¸¸è¦‹é™·é˜±
- éåº¦æ¸…æ´—ï¼šä¸Ÿå¤±é‡è¦è³‡è¨Š
- å¿½ç•¥æ¥­å‹™é‚è¼¯ï¼šçµ±è¨ˆæ­£ç¢ºä½†æ¥­å‹™éŒ¯èª¤
- æœªè¨˜éŒ„è™•ç†ï¼šç„¡æ³•é‡ç¾çµæœ

### Prompt è¬ç”¨æ¨¡æ¿
```
"å¹«æˆ‘åŸ·è¡Œå®Œæ•´çš„è³‡æ–™æ¸…æ´—æµç¨‹ï¼š
1. ç”¢ç”Ÿå“è³ªå ±å‘Š
2. è™•ç†ç¼ºå¤±å€¼ï¼ˆèªªæ˜ç­–ç•¥ï¼‰
3. æª¢æ¸¬ä¸¦è™•ç†ç•°å¸¸å€¼
4. å¿…è¦çš„è³‡æ–™è½‰æ›
5. è¼¸å‡ºæ¸…æ´—å‰å¾Œå°æ¯”"
```

---

## èª²å ‚ç­†è¨˜å€
ï¼ˆå­¸å“¡å¯åœ¨æ­¤è¨˜éŒ„é‡é»ï¼‰

---

## å»¶ä¼¸å­¸ç¿’
- é€²éšç•°å¸¸æª¢æ¸¬ï¼šIsolation Forestã€DBSCAN
- ç¼ºå¤±å€¼æ’è£œï¼šKNN Imputationã€MICE
- è³‡æ–™å“è³ªæ¡†æ¶ï¼šSix Sigma DMAIC