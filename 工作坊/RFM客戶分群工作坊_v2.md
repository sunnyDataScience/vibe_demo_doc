# AI Vibe Coding 工作坊：RFM 客戶分群實戰 v2

> **模組 2 專項深化版** | Online Retail 54萬筆數據 | 6 小時濃縮精華
> 目標：從零開始，帶走能用的 RFM 分析系統

---

## 🎯 工作坊核心定位

```
課程主題：RFM 客戶分群分析與營銷策略
資料來源：Online Retail Dataset（54萬筆交易數據）
技術棧：Python + Pandas + Plotly + Streamlit
交付物：RFM 分層表 + 流失警告清單 + 營銷策略儀表板
成功指標：70% 學員能獨立完成 RFM 分析並部署上線
```

---

## 📊 資料集規格

| 項目 | 規格 |
|:-----|:-----|
| **資料集名稱** | Online Retail II |
| **資料量** | 541,909 筆交易紀錄 |
| **時間跨度** | 2009-2011 年 |
| **欄位數** | 8 個關鍵欄位 |
| **國家數** | 43 個國家 |
| **產品數** | 4,070 種產品 |
| **客戶數** | 5,942 位客戶 |
| **缺失率** | < 5%（已清洗） |

### 資料欄位說明

```python
# 核心欄位
- Invoice: 訂單編號
- StockCode: 產品代碼
- Description: 產品描述
- Quantity: 購買數量
- InvoiceDate: 交易日期
- Price: 單價
- CustomerID: 客戶編號
- Country: 國家
```

---

## 🏗️ 課程架構設計（6 小時版）

### 整體時間配置

| 階段 | 時間 | 內容 | 產出 |
|:-----|:-----|:-----|:-----|
| **暖身階段** | 09:00-10:30 | 理解 RFM + 資料探索 | 資料洞察報告 |
| **核心階段** | 10:30-12:00 | RFM 計算與分群 | 客戶分層矩陣 |
| **午餐休息** | 12:00-13:00 | — | — |
| **進階階段** | 13:00-14:30 | 流失預警與策略 | 警告清單 + 行動方案 |
| **部署階段** | 14:30-15:30 | Streamlit 儀表板 | 線上連結 |
| **Demo Time** | 15:30-16:00 | 成果展示 | 3分鐘 Pitch |

---

## 📚 模組化教學設計

### 🔥 Module 0：開場破冰（30 分鐘）

#### 0-1 簽到暖身（09:00-09:10）
```
【活動】快速自我介紹
【問題】「你最想了解哪些客戶？」
【工具】Mentimeter 即時投票
【產出】學員期待清單
```

#### 0-2 RFM 概念導入（09:10-09:30）
```
【Context】為什麼要做客戶分群？
- 案例：某電商從「群發」到「精準」，轉換率提升 3 倍
- 痛點：不知道誰是 VIP、誰要流失、該推什麼產品

【Demo】現場展示完成品
- 展示已部署的 RFM 儀表板
- 操作：上傳資料 → 自動分群 → 策略建議

【產出】理解 RFM 三個字母的意義
- R (Recency)：最近一次購買距今天數
- F (Frequency)：購買頻率
- M (Monetary)：消費金額
```

---

### 🔍 Module 1：資料探索與清洗（60 分鐘）

#### 1-1 暖身題：載入資料看一眼（09:30-09:50）

```python
【題目】讀取 Online Retail 資料集
【情境】老闆丟給你一份 54 萬筆交易紀錄，要你「分析一下」
【輸入】online_retail.csv（已下載）
【產出】
  - 資料形狀（rows, columns）
  - 前 10 筆資料
  - 基本統計描述

【DoD】
  □ 成功讀取 CSV
  □ 印出 shape 和 head()
  □ 發現有缺失值

【Fallback】
  - 記憶體不夠 → 用 sample_retail.csv（1萬筆）
  - 讀取失敗 → 發 checkpoint_load.py

【Prompt 提示】
「請幫我用 pandas 讀取 online_retail.csv，
 顯示資料形狀、前10筆、資料類型和缺失值統計」
```

#### 1-2 核心題：資料清洗與驗證（09:50-10:30）

```python
【題目】清洗資料並建立分析基礎
【情境】髒資料會讓 RFM 分析失真，要先處理

【清洗步驟】
1. 移除缺失客戶 ID（約 13 萬筆）
2. 移除退貨訂單（Invoice 開頭為 C）
3. 移除單價或數量為 0 的異常值
4. 新增「銷售額」欄位 = 數量 × 單價
5. 轉換日期格式

【產出】
  - 清洗後資料集（約 40 萬筆）
  - 清洗報告（移除了多少筆、為什麼）

【DoD】
  □ CustomerID 無缺失值
  □ 無負數銷售額
  □ InvoiceDate 為 datetime 格式
  □ 清洗後筆數 > 30 萬

【Fallback】
  - 清洗邏輯不確定 → 發 data_cleaning_guide.md
  - 跑太慢 → 直接給 cleaned_retail.csv

【Prompt 提示】
「請幫我清洗這份零售資料：
 1. 刪除 CustomerID 為空的資料
 2. 刪除 Invoice 開頭為 'C' 的退貨訂單
 3. 計算 Revenue = Quantity * Price
 4. 確保日期欄位是 datetime 格式」
```

#### 1-3 挑戰題：探索性分析（選做）
```python
【題目】快速了解業務全貌
【產出】
  - Top 10 暢銷產品
  - Top 10 客戶
  - 各國銷售分布
  - 月銷售趨勢圖
```

---

### 💎 Module 2：RFM 指標計算（90 分鐘）

#### 2-1 暖身題：理解 RFM 計算邏輯（10:30-10:45）

```python
【題目】手動計算一位客戶的 RFM
【情境】先理解公式，再批量處理

【範例客戶】CustomerID = 12346
【計算】
  - R：最後購買日 - 分析基準日
  - F：不重複訂單數
  - M：總消費金額

【產出】
  該客戶的 R=23天, F=7次, M=$1563.45

【DoD】
  □ 能說出 R/F/M 各自的計算公式
  □ 計算結果正確

【Prompt 提示】
「請計算 CustomerID=12346 的 RFM 值：
 R = 分析日期(2011-12-31) - 該客戶最後購買日
 F = 該客戶的不重複訂單數
 M = 該客戶的總消費金額」
```

#### 2-2 核心題：批量計算所有客戶 RFM（10:45-11:30）

```python
【題目】為 5000+ 客戶計算 RFM 指標
【情境】從個體到全體，規模化分析

【計算步驟】
1. 設定分析基準日（2011-12-31）
2. 按 CustomerID 分組
3. 計算每位客戶的：
   - 最後購買日
   - 購買次數（訂單數）
   - 總消費金額
4. 計算 Recency 天數
5. 產出 RFM 表

【產出】
  rfm_table.csv 包含：
  - CustomerID
  - Recency（天數）
  - Frequency（次數）
  - Monetary（金額）

【DoD】
  □ 產出包含所有客戶（~5000筆）
  □ 無負值或空值
  □ 能解釋最大/最小值的業務意義

【Fallback】
  - 計算錯誤 → 發 rfm_formula.py
  - 記憶體不足 → 分批計算範例

【Prompt 提示】
「請用 pandas groupby 計算所有客戶的 RFM：
 按 CustomerID 分組，計算：
 - 最後購買日期 (max of InvoiceDate)
 - 訂單數 (nunique of Invoice)
 - 總消費金額 (sum of Revenue)
 基準日使用 2011-12-31」
```

#### 2-3 RFM 評分與分群（11:30-12:00）

```python
【題目】將 RFM 值轉換為分群標籤
【情境】原始數值難以解讀，需要分層分群

【分群邏輯】
1. 將 R/F/M 各切分為 5 等分（使用分位數）
2. 給予 1-5 分（R 反向計分）
3. 組合成 RFM_Score（如：555 = 最佳客戶）
4. 映射到客戶標籤

【8 大客戶分群】
- Champions（冠軍客戶）：RFM 都高
- Loyal Customers（忠誠客戶）：F 高
- Potential Loyalist（潛力客戶）：近期 R 高
- New Customers（新客戶）：R 高但 F 低
- At Risk（瀕危客戶）：FM 高但 R 低
- Can't Lose Them（不能失去）：FM 很高但 R 很低
- Hibernating（休眠客戶）：都低
- Lost（流失客戶）：R 非常低

【產出】
  - rfm_segmented.csv
  - 客戶分群分布圖
  - 各群組人數統計

【DoD】
  □ 每個客戶都有分群標籤
  □ 分群分布合理（沒有 90% 在同一群）
  □ 能產出視覺化圖表

【Prompt 提示】
「請將 RFM 值轉換為 1-5 的分數：
 使用 pd.qcut() 分為 5 等分
 R 分數要反向（值越小分數越高）
 根據 RFM 組合分配客戶標籤」
```

---

### 🎯 Module 3：流失預警與營銷策略（90 分鐘）

#### 3-1 暖身題：識別高風險客戶（13:00-13:20）

```python
【題目】找出需要立即關注的客戶
【情境】預防勝於治療，提前介入

【篩選條件】
- At Risk：過去是好客戶，近期不活躍
- Can't Lose：高價值但快流失
- Hibernating：長期沉睡

【產出】
  churn_alert_list.csv 包含：
  - 客戶 ID
  - 風險等級（高/中/低）
  - 上次購買天數
  - 歷史貢獻金額
  - 建議行動

【DoD】
  □ 產出至少 500 位風險客戶
  □ 按風險等級排序
  □ 包含具體行動建議
```

#### 3-2 核心題：設計差異化營銷策略（13:20-14:00）

```python
【題目】為不同客群制定營銷方案
【情境】一套策略打天下 = 無效營銷

【策略矩陣設計】
每個客群設計：
1. 營銷目標
2. 溝通頻率
3. 優惠力度
4. 推薦產品類型
5. 溝通渠道

【範例】
Champions：
- 目標：維持忠誠度
- 頻率：每月 2 次
- 優惠：VIP 專屬、早鳥優先
- 產品：新品、高單價
- 渠道：Email + 專屬客服

At Risk：
- 目標：喚醒重新購買
- 頻率：每週 1 次（3 週內）
- 優惠：限時回歸禮 20% off
- 產品：過往購買類似品
- 渠道：簡訊 + Email

【產出】
  marketing_strategy.csv
  - 8 個客群 × 5 個策略維度
  - 預期 ROI 估算

【DoD】
  □ 每個客群都有對應策略
  □ 策略之間有明顯差異
  □ 可量化執行（非空泛建議）
```

#### 3-3 挑戰題：預測 CLV（選做）

```python
【題目】計算客戶生命週期價值
【產出】預測未來 6 個月的客戶價值
【提示】使用歷史 RFM 趨勢推估
```

---

### 🚀 Module 4：Streamlit 儀表板開發（60 分鐘）

#### 4-1 暖身題：基礎介面搭建（14:30-14:45）

```python
【題目】建立 RFM 分析儀表板框架
【情境】讓非技術同事也能用

【介面元素】
1. 標題：RFM Customer Segmentation
2. 側邊欄：檔案上傳器
3. 主區域：分成 3 個 Tab
   - Overview（總覽）
   - Segmentation（分群）
   - Action（行動方案）

【產出】
  app.py 能在本地運行

【DoD】
  □ Streamlit 能啟動
  □ 能上傳 CSV 檔案
  □ 3 個 Tab 能切換

【Prompt 提示】
「創建 Streamlit app，包含：
 檔案上傳器、3 個 tabs、基本 layout」
```

#### 4-2 核心題：完整功能實作（14:45-15:20）

```python
【題目】實作完整 RFM 分析流程
【情境】一鍵生成所有分析結果

【功能清單】
1. 上傳資料 → 自動清洗
2. 計算 RFM → 顯示統計
3. 客戶分群 → 視覺化圖表
4. 風險預警 → 可下載清單
5. 策略建議 → 表格顯示

【關鍵圖表】
- RFM 3D 散點圖（Plotly）
- 客群分布圓餅圖
- RFM Heat Map
- 時間趨勢線圖

【產出】
  完整功能的 app.py

【DoD】
  □ 上傳檔案後自動處理
  □ 顯示至少 4 種圖表
  □ 可下載分析結果
  □ 無錯誤訊息

【Fallback】
  - Plotly 圖表失敗 → 改用 matplotlib
  - 功能太多做不完 → 優先做分群功能

【Prompt 提示】
「在 Streamlit 中實作：
 1. 讀取上傳的 CSV
 2. 執行 RFM 計算函數
 3. 用 Plotly 繪製 3D 散點圖
 4. 顯示客群統計表
 5. 提供下載按鈕」
```

#### 4-3 部署上線（15:20-15:30）

```python
【題目】部署到 Streamlit Cloud
【產出】
  - GitHub repo（含所有程式碼）
  - requirements.txt
  - 線上網址

【DoD】
  □ 網址可訪問
  □ 功能正常運作
  □ 載入時間 < 30 秒
```

---

### 🎭 Module 5：Demo Time（30 分鐘）

#### 5-1 準備 3 分鐘 Pitch（15:30-15:45）

```
【架構】
1. 問題（30 秒）
   「我們公司有 5000+ 客戶，但不知道該重點經營誰」

2. 解決方案（1 分鐘）
   「我用 RFM 分析，自動分成 8 類客戶」

3. 成果展示（1 分鐘）
   - 打開儀表板
   - 上傳資料
   - 展示分群結果
   - 展示風險清單

4. 商業價值（30 秒）
   「可以提升 20% 營銷 ROI」
   「預防流失 300 位高價值客戶」
```

#### 5-2 互評與回饋（15:45-16:00）

```
【評分維度】
- 完成度（功能是否齊全）40%
- 實用性（解決真實問題）30%
- 視覺化（圖表是否清晰）20%
- 表達力（說明是否清楚）10%
```

---

## ⏱️ 詳細時間節拍表

### 上午場（09:00-12:00）

| 時間 | 時長 | 環節 | 講師動作 | 助教動作 | 產出檢核 |
|:-----|:-----|:-----|:---------|:---------|:---------|
| 09:00 | 10m | 簽到 | 準備設備 | 確認環境 | 全員到齊 |
| 09:10 | 20m | RFM 概念 | 講解+案例 | 記錄問題 | 理解概念 |
| 09:30 | 20m | 載入資料 | Demo | 巡場 | 資料載入 |
| 09:50 | 40m | 資料清洗 | 引導 | 救援 | 清洗完成 |
| 10:30 | 15m | 休息 | — | — | — |
| 10:45 | 15m | RFM 邏輯 | 講解公式 | 白板輔助 | 理解計算 |
| 11:00 | 30m | 批量計算 | 協助 Debug | 發 checkpoint | RFM 表 |
| 11:30 | 30m | 客戶分群 | 展示結果 | 確認進度 | 分群完成 |

### 下午場（13:00-16:00）

| 時間 | 時長 | 環節 | 講師動作 | 助教動作 | 產出檢核 |
|:-----|:-----|:-----|:---------|:---------|:---------|
| 13:00 | 20m | 風險識別 | 講解邏輯 | 準備資料 | 風險清單 |
| 13:20 | 40m | 策略設計 | 引導思考 | 記錄創意 | 策略矩陣 |
| 14:00 | 30m | 休息+準備 | — | — | — |
| 14:30 | 15m | Streamlit | Demo 基礎 | 協助安裝 | 介面框架 |
| 14:45 | 35m | 功能開發 | 重點提示 | Debug | 完整 App |
| 15:20 | 10m | 部署 | 協助部署 | 備援方案 | 上線成功 |
| 15:30 | 30m | Demo | 主持 | 計時+評分 | 全員展示 |

---

## 🛠️ 教學資源準備清單

### 必要檔案

```
/workshop-rfm/
├── data/
│   ├── online_retail.csv (原始 54萬筆)
│   ├── sample_retail.csv (1萬筆樣本)
│   ├── cleaned_retail.csv (清洗後)
│   └── rfm_result_sample.csv (範例結果)
├── checkpoints/
│   ├── checkpoint_load.py
│   ├── checkpoint_clean.py
│   ├── checkpoint_rfm.py
│   ├── checkpoint_segment.py
│   └── checkpoint_app.py
├── solutions/
│   ├── complete_analysis.ipynb
│   └── final_app.py
├── templates/
│   ├── rfm_formula.md
│   ├── segmentation_rules.md
│   └── marketing_strategy_template.xlsx
└── requirements.txt
```

### 環境需求

```python
# requirements.txt
pandas==2.0.0
numpy==1.24.0
plotly==5.14.0
streamlit==1.28.0
openpyxl==3.1.0
scikit-learn==1.3.0
```

### 常見錯誤處理卡

| 錯誤類型 | 症狀 | 快速解法 |
|:---------|:-----|:---------|
| 記憶體不足 | MemoryError | 用 sample_retail.csv |
| 缺失值錯誤 | KeyError: CustomerID | 確認清洗步驟 |
| 分群失敗 | 所有客戶同一群 | 檢查分位數計算 |
| 圖表空白 | Plotly 不顯示 | 改用 st.pyplot() |
| 部署失敗 | Requirements | 用 pipreqs 重新生成 |

---

## 📈 學習成效評估

### 形成性評估（過程中）

| 檢核點 | 時間 | 標準 |
|:-------|:-----|:-----|
| 資料載入 | 09:50 | 80% 完成 |
| RFM 計算 | 11:30 | 70% 完成 |
| 客戶分群 | 12:00 | 60% 完成 |
| 儀表板 | 15:20 | 50% 完成 |

### 總結性評估（Demo）

| 維度 | 權重 | 評分標準 |
|:-----|:-----|:---------|
| 功能完整 | 40% | RFM 計算正確、分群合理 |
| 商業價值 | 30% | 能說明 ROI、可行動 |
| 技術實作 | 20% | 程式碼品質、效能 |
| 簡報表達 | 10% | 清晰、有說服力 |

---

## 💡 教學提醒與技巧

### 開場破冰
- 用「亞馬遜如何預測你要買什麼」當開場故事
- 讓學員分享自己公司的客戶管理痛點

### 節奏控制
- 每 30 分鐘確認一次進度
- 落後超過 30% 就發 checkpoint
- 提前完成的給挑戰題

### 助教配置
- 1 位主助教：負責技術救援
- 1 位輔助教：負責環境問題
- 講師專注於概念講解和節奏掌控

### 危機處理
- 準備離線版資料集（避免下載問題）
- 準備 Google Colab 備案
- 準備錄好的 Demo 影片

---

## 🎯 課後延伸

### 進階主題建議
1. **機器學習預測**：用 RFM 預測流失機率
2. **即時計算**：串接 POS 系統即時更新
3. **A/B Testing**：測試不同策略效果
4. **多維度分析**：加入產品、地區維度

### 回家作業
1. 用自己公司的資料重做一遍
2. 加入一個新的分析維度
3. 優化儀表板 UI/UX

### 持續學習資源
- Kaggle RFM 競賽
- Customer Analytics 線上課程
- Python for Marketing 書籍

---

## ✅ 開課前檢查清單

### D-7 準備
- [ ] 下載並測試 Online Retail 資料集
- [ ] 準備所有 checkpoint 檔案
- [ ] 測試 Streamlit Cloud 帳號
- [ ] 印製講義和評分表

### D-1 確認
- [ ] 學員環境安裝狀況調查
- [ ] 助教 briefing 完成
- [ ] 備援熱點準備
- [ ] Demo 網站測試

### 當天準備
- [ ] 提早 30 分鐘到場
- [ ] 投影設備測試
- [ ] WiFi 密碼公告
- [ ] 簽到表和名牌
- [ ] 開啟 Streamlit Cloud

---

*Last Updated: 2024.12*
*Version: 2.0 - RFM Specialization*