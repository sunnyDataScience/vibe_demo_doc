# 📦 模組2:後台管理系統(2.5小時)

## 🔍 第一性原理拆解

**核心知識點:權限管理 (Authorization)**

```
最根本的問題:
「不同的人能做不同的事」

生活類比:
├─ 超市員工:只能收銀
├─ 店長:能收銀+查看報表+管理員工
└─ 總部:能看所有店的資料

軟體中的實現:
角色(Role) + 權限(Permission) = 能做什麼
```

**拆解成4個子問題:**
1. **角色定義**:「系統有哪些角色?」
2. **權限分配**:「每個角色能做什麼?」
3. **權限檢查**:「怎麼確認某人有權限做某事?」
4. **介面呈現**:「不同角色看到不同畫面」

---

## 📐 架構設計

**角色-權限對照表(學生設計)**

```
🎭 角色定義

┌─────────────┬───────────────────────────────┐
│   角色名稱   │         能做的事情            │
├─────────────┼───────────────────────────────┤
│ 超級管理員  │ • 管理所有使用者              │
│ (Super Admin)│ • 查看所有訂單                │
│             │ • 修改系統設定                │
│             │ • 匯出資料                    │
├─────────────┼───────────────────────────────┤
│ 一般管理員  │ • 查看訂單                    │
│ (Admin)     │ • 修改訂單狀態                │
│             │ • 管理商品                    │
├─────────────┼───────────────────────────────┤
│ 客戶經理    │ • 查看自己負責的客戶訂單      │
│ (Manager)   │ • 聯繫客戶                    │
│             │ • 新增客戶備註                │
├─────────────┼───────────────────────────────┤
│ 一般客戶    │ • 查看自己的訂單              │
│ (Customer)  │ • 下新訂單                    │
│             │ • 修改個人資料                │
└─────────────┴───────────────────────────────┘
```

**頁面訪問控制矩陣**

```
                 |超級管理員|一般管理員|客戶經理|一般客戶|
─────────────────┼─────────┼─────────┼────────┼────────┤
訂單列表(全部)   |    ✅    |    ✅    |   ❌   |   ❌   |
訂單列表(自己的) |    ✅    |    ✅    |   ✅   |   ✅   |
修改訂單狀態     |    ✅    |    ✅    |   ❌   |   ❌   |
使用者管理       |    ✅    |    ❌    |   ❌   |   ❌   |
系統設定         |    ✅    |    ❌    |   ❌   |   ❌   |
CRM客戶資料      |    ✅    |    ✅    |   ✅   |   ❌   |
```

**學生練習:設計自己的角色權限表**

**產出文件**:`模組2_權限設計矩陣.md`

---

## 💬 Vibe Prompt範例

```markdown
# 後台管理系統需求

## 系統角色
我需要4種角色:超級管理員、一般管理員、客戶經理、一般客戶

權限分配如下:
[貼上剛才設計的權限矩陣]

## 主要功能

### 1. 訂單管理
- 列表顯示所有訂單(依權限過濾)
- 可以篩選:訂單狀態、日期範圍、客戶名稱
- 點擊訂單可以看詳細資訊
- 管理員可以修改訂單狀態(待處理→處理中→已出貨→已完成)

### 2. 商品管理(僅管理員)
- 新增商品(名稱、價格、庫存)
- 編輯商品資訊
- 下架商品(不刪除,只是不顯示)

### 3. 使用者管理(僅超級管理員)
- 查看所有使用者列表
- 修改使用者角色
- 停用/啟用帳號

## 介面需求
- 左側選單(依角色顯示不同選項)
- 上方顯示目前登入者身份
- 每個功能區塊都要檢查權限(沒權限顯示「無權訪問」)

## 技術需求
- 後台使用Streamlit建構(快速開發)
- 資料來自Supabase
- 權限檢查要在每個頁面載入時執行

請生成這個後台管理系統的程式碼。
```

---

## 🎯 可維護性重點:中介層設計

**教學生「不要把邏輯寫死在頁面上」**

#### ❌ 不好的做法:
```python
# 在每個頁面都寫一次權限判斷
if user.role == "admin" or user.role == "super_admin":
    顯示訂單管理頁面
else:
    顯示錯誤訊息
```

**問題**:如果新增角色「運營經理」也能看訂單,要改N個地方

#### ✅ 好的做法:
```markdown
告訴AI:
「請建立一個權限檢查器(permission_checker.py)
- 定義每個角色的權限清單
- 提供函式:can_user_do(user_role, action)
- 所有頁面都呼叫這個檢查器
這樣未來改權限只要改一個檔案」
```

**學生練習:用白話文寫出「中介層」的設計概念**
