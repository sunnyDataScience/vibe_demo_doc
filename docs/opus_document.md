# ğŸ¯ OrderFlow å…­å¤§å­æ¨¡çµ„ - Vibe Coding å®Œæ•´æŒ‡å—

## ğŸ“‹ Vibe Coding è¨­è¨ˆåŸå‰‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Vibe Coding æ ¸å¿ƒæ€ç¶­                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ã€ä»€éº¼æ˜¯ Vibe Coding?ã€‘                                                   â”‚
â”‚   ç”¨è‡ªç„¶èªè¨€æè¿°ä½ è¦ä»€éº¼ â†’ AI å¹«ä½ å¯«ç¨‹å¼ â†’ å¿«é€Ÿè¿­ä»£èª¿æ•´                     â”‚
â”‚                                                                             â”‚
â”‚   ã€Prompt è¨­è¨ˆå››è¦ç´ ã€‘                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚   â”‚ Context â”‚ â†’ â”‚  Task   â”‚ â†’ â”‚ Format  â”‚ â†’ â”‚ Example â”‚                   â”‚
â”‚   â”‚ èƒŒæ™¯è„ˆçµ¡ â”‚   â”‚ å…·é«”ä»»å‹™ â”‚   â”‚ è¼¸å‡ºæ ¼å¼ â”‚   â”‚ ç¯„ä¾‹åƒè€ƒ â”‚                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                             â”‚
â”‚   ã€æ¯å€‹æ¨¡çµ„ Prompt çµæ§‹ã€‘                                                  â”‚
â”‚   1. ğŸ¯ æ¨¡çµ„ç›®æ¨™èªªæ˜                                                        â”‚
â”‚   2. ğŸ“ æŠ€è¡“è¦æ ¼å®šç¾©                                                        â”‚
â”‚   3. ğŸ“ åˆ†éšæ®µ Prompt (Step-by-Step)                                       â”‚
â”‚   4. âœ… é©—æ”¶æª¢æŸ¥æ¸…å–®                                                        â”‚
â”‚   5. ğŸ”§ å¸¸è¦‹å•é¡Œèª¿æ•´ Prompt                                                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# æ¨¡çµ„ 1ï¸âƒ£ï¼šæœƒå“¡ç™»å…¥ç³»çµ±

## ğŸ¯ æ¨¡çµ„ç›®æ¨™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯¦ç¾ç”¨æˆ¶è¨»å†Šã€ç™»å…¥ã€JWT èªè­‰ã€è§’è‰²æ¬Šé™æ§åˆ¶      â”‚
â”‚  æŠ€è¡“ï¼šPython + FastAPI + Supabase              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ æ¶æ§‹æ€è·¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æœƒå“¡ç³»çµ±æ¶æ§‹æ€è·¯                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   ã€è³‡æ–™æµã€‘                                                    â”‚
â”‚   ç”¨æˆ¶è¼¸å…¥ â†’ API æ¥æ”¶ â†’ å¯†ç¢¼é©—è­‰ â†’ ç”¢ç”Ÿ JWT â†’ å›å‚³ Token       â”‚
â”‚                                                                 â”‚
â”‚   ã€æ ¸å¿ƒæ¦‚å¿µã€‘                                                  â”‚
â”‚   â€¢ å¯†ç¢¼ä¸èƒ½æ˜æ–‡å­˜ï¼Œè¦ç”¨ bcrypt åŠ å¯†                           â”‚
â”‚   â€¢ JWT = ç”¨æˆ¶èº«ä»½è­‰ï¼Œæ¯æ¬¡è«‹æ±‚éƒ½è¦å¸¶è‘—                         â”‚
â”‚   â€¢ è§’è‰²æ¬Šé™ = ä¸åŒäººèƒ½åšä¸åŒäº‹                                â”‚
â”‚                                                                 â”‚
â”‚   ã€æª”æ¡ˆçµæ§‹é è¦½ã€‘                                              â”‚
â”‚   auth/                                                         â”‚
â”‚   â”œâ”€â”€ router.py    â† API è·¯ç”± (æ¥æ”¶è«‹æ±‚)                       â”‚
â”‚   â”œâ”€â”€ service.py   â† æ¥­å‹™é‚è¼¯ (è™•ç†é‚è¼¯)                       â”‚
â”‚   â”œâ”€â”€ models.py    â† è³‡æ–™æ¨¡å‹ (å®šç¾©çµæ§‹)                       â”‚
â”‚   â””â”€â”€ utils.py     â† å·¥å…·å‡½æ•¸ (JWT è™•ç†)                       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ Vibe Coding Prompts

### **Step 1: å»ºç«‹è³‡æ–™æ¨¡å‹**

```markdown
## Prompt 1-1: å»ºç«‹ User è³‡æ–™æ¨¡å‹

ã€èƒŒæ™¯ã€‘
æˆ‘æ­£åœ¨ç”¨ Python + FastAPI + Supabase å»ºç«‹ä¸€å€‹è¨‚å–®ç®¡ç†ç³»çµ±çš„æœƒå“¡æ¨¡çµ„ã€‚

ã€ä»»å‹™ã€‘
è«‹å¹«æˆ‘å»ºç«‹ User ç›¸é—œçš„ Pydantic è³‡æ–™æ¨¡å‹ï¼Œéœ€è¦åŒ…å«ï¼š

1. UserBase - åŸºç¤æ¬„ä½
   - email: é›»å­éƒµä»¶ (å¿…å¡«ï¼Œéœ€é©—è­‰æ ¼å¼)
   - role: è§’è‰² (admin/staff/customerï¼Œé è¨­ customer)

2. UserCreate - è¨»å†Šç”¨
   - ç¹¼æ‰¿ UserBase
   - password: å¯†ç¢¼ (å¿…å¡«ï¼Œæœ€å°‘8å­—å…ƒ)

3. UserLogin - ç™»å…¥ç”¨
   - email: é›»å­éƒµä»¶
   - password: å¯†ç¢¼

4. UserInDB - è³‡æ–™åº«å­˜çš„å®Œæ•´è³‡æ–™
   - id: UUID
   - email, role
   - password_hash: åŠ å¯†å¾Œçš„å¯†ç¢¼
   - is_active: æ˜¯å¦å•Ÿç”¨
   - created_at: å»ºç«‹æ™‚é–“

5. UserResponse - å›å‚³çµ¦å‰ç«¯çš„ (ä¸å«å¯†ç¢¼)
   - id, email, role, is_active, created_at

6. TokenResponse - ç™»å…¥æˆåŠŸå›å‚³
   - access_token: JWT token
   - token_type: "bearer"
   - user: UserResponse

ã€æŠ€è¡“è¦æ±‚ã€‘
- ä½¿ç”¨ Pydantic v2 èªæ³•
- åŠ å…¥é©ç•¶çš„ Field é©—è­‰
- åŠ å…¥ model_config è¨­å®š

ã€è¼¸å‡ºæ ¼å¼ã€‘
è«‹çµ¦æˆ‘å®Œæ•´çš„ models.py æª”æ¡ˆå…§å®¹
```

### **Step 2: JWT å·¥å…·å‡½æ•¸**

```markdown
## Prompt 1-2: å»ºç«‹ JWT å·¥å…·å‡½æ•¸

ã€èƒŒæ™¯ã€‘
å»¶çºŒä¸Šä¸€æ­¥ï¼Œæˆ‘éœ€è¦è™•ç† JWT token çš„ç”¢ç”Ÿå’Œé©—è­‰ã€‚

ã€ä»»å‹™ã€‘
è«‹å¹«æˆ‘å»ºç«‹ JWT ç›¸é—œçš„å·¥å…·å‡½æ•¸ utils.pyï¼š

1. è¨­å®šå¸¸æ•¸
   - SECRET_KEY: å¾ç’°å¢ƒè®Šæ•¸è®€å–
   - ALGORITHM: HS256
   - ACCESS_TOKEN_EXPIRE_MINUTES: 60 åˆ†é˜

2. create_access_token(data: dict) å‡½æ•¸
   - æ¥æ”¶è¦ç·¨ç¢¼çš„è³‡æ–™
   - åŠ å…¥éæœŸæ™‚é–“ (exp)
   - å›å‚³ JWT token å­—ä¸²

3. verify_token(token: str) å‡½æ•¸
   - è§£ç¢¼ä¸¦é©—è­‰ token
   - å›å‚³ payload æˆ– None (å¦‚æœç„¡æ•ˆ)

4. get_current_user ä¾è³´æ³¨å…¥å‡½æ•¸
   - å¾ Request Header å–å¾— Bearer token
   - é©—è­‰ token
   - å¾è³‡æ–™åº«æŸ¥è©¢ç”¨æˆ¶
   - å›å‚³ UserInDB æˆ–æ‹‹å‡º 401 éŒ¯èª¤

5. require_role(allowed_roles: list) è£é£¾å™¨
   - æª¢æŸ¥ç•¶å‰ç”¨æˆ¶è§’è‰²æ˜¯å¦åœ¨å…è¨±åˆ—è¡¨ä¸­
   - ä¸å…è¨±å‰‡æ‹‹å‡º 403 éŒ¯èª¤

ã€æŠ€è¡“è¦æ±‚ã€‘
- ä½¿ç”¨ python-jose å¥—ä»¶
- ä½¿ç”¨ FastAPI çš„ Depends æ©Ÿåˆ¶
- é©ç•¶çš„éŒ¯èª¤è™•ç†

ã€è¼¸å‡ºæ ¼å¼ã€‘
å®Œæ•´çš„ utils.py æª”æ¡ˆ
```

### **Step 3: æ¥­å‹™é‚è¼¯å±¤**

```markdown
## Prompt 1-3: å»ºç«‹èªè­‰æœå‹™å±¤

ã€èƒŒæ™¯ã€‘
æˆ‘éœ€è¦è™•ç†å¯†ç¢¼åŠ å¯†ã€ç”¨æˆ¶æŸ¥è©¢ç­‰æ¥­å‹™é‚è¼¯ã€‚

ã€ä»»å‹™ã€‘
è«‹å»ºç«‹ service.py åŒ…å«ä»¥ä¸‹å‡½æ•¸ï¼š

1. hash_password(password: str) -> str
   - ä½¿ç”¨ bcrypt åŠ å¯†å¯†ç¢¼

2. verify_password(plain: str, hashed: str) -> bool
   - é©—è­‰å¯†ç¢¼æ˜¯å¦æ­£ç¢º

3. async get_user_by_email(email: str) -> UserInDB | None
   - å¾ Supabase æŸ¥è©¢ç”¨æˆ¶
   - ä½¿ç”¨ supabase-py å¥—ä»¶

4. async create_user(user: UserCreate) -> UserInDB
   - æª¢æŸ¥ email æ˜¯å¦å·²å­˜åœ¨
   - åŠ å¯†å¯†ç¢¼
   - å¯«å…¥ Supabase
   - å›å‚³æ–°å»ºçš„ç”¨æˆ¶

5. async authenticate_user(email: str, password: str) -> UserInDB | None
   - æŸ¥è©¢ç”¨æˆ¶
   - é©—è­‰å¯†ç¢¼
   - æˆåŠŸå›å‚³ç”¨æˆ¶ï¼Œå¤±æ•—å›å‚³ None

ã€Supabase é€£ç·šè³‡è¨Šã€‘
```python
from supabase import create_client
supabase = create_client(
    os.getenv("SUPABASE_URL"),
    os.getenv("SUPABASE_KEY")
)
```

ã€è¼¸å‡ºæ ¼å¼ã€‘
å®Œæ•´çš„ service.py æª”æ¡ˆ
```

### **Step 4: API è·¯ç”±**

```markdown
## Prompt 1-4: å»ºç«‹èªè­‰ API è·¯ç”±

ã€èƒŒæ™¯ã€‘
æœ€å¾Œä¸€æ­¥ï¼Œæˆ‘éœ€è¦å»ºç«‹å°å¤–çš„ API ç«¯é»ã€‚

ã€ä»»å‹™ã€‘
è«‹å»ºç«‹ router.py åŒ…å«ä»¥ä¸‹ç«¯é»ï¼š

1. POST /auth/register
   - æ¥æ”¶ UserCreate
   - å»ºç«‹æ–°ç”¨æˆ¶
   - å›å‚³ UserResponse
   - éŒ¯èª¤ï¼š400 (email å·²å­˜åœ¨)

2. POST /auth/login
   - æ¥æ”¶ UserLogin
   - é©—è­‰å¸³å¯†
   - æˆåŠŸå›å‚³ TokenResponse
   - éŒ¯èª¤ï¼š401 (å¸³å¯†éŒ¯èª¤)

3. GET /auth/me
   - éœ€è¦èªè­‰ (Bearer token)
   - å›å‚³ç•¶å‰ç”¨æˆ¶è³‡è¨Š UserResponse

4. PUT /auth/me
   - éœ€è¦èªè­‰
   - å¯æ›´æ–°è‡ªå·±çš„ email
   - å›å‚³æ›´æ–°å¾Œçš„ UserResponse

5. GET /auth/users (é™ admin)
   - éœ€è¦ admin è§’è‰²
   - å›å‚³æ‰€æœ‰ç”¨æˆ¶åˆ—è¡¨

ã€æŠ€è¡“è¦æ±‚ã€‘
- ä½¿ç”¨ FastAPI çš„ APIRouter
- é©ç•¶çš„ response_model
- å®Œæ•´çš„éŒ¯èª¤è™•ç†
- OpenAPI æ–‡æª”è¨»è§£ (summary, description)

ã€è¼¸å‡ºæ ¼å¼ã€‘
å®Œæ•´çš„ router.py æª”æ¡ˆï¼Œä¸¦å‘Šè¨´æˆ‘å¦‚ä½•åœ¨ main.py ä¸­å¼•å…¥
```

## âœ… é©—æ”¶æª¢æŸ¥æ¸…å–®

```
â–¡ å¯ä»¥æˆåŠŸè¨»å†Šæ–°ç”¨æˆ¶
â–¡ ç›¸åŒ email è¨»å†Šæœƒå ±éŒ¯
â–¡ å¯ä»¥ç™»å…¥å–å¾— JWT token
â–¡ éŒ¯èª¤å¯†ç¢¼æœƒå›å‚³ 401
â–¡ å¸¶ token å¯ä»¥å­˜å– /auth/me
â–¡ ä¸å¸¶ token å­˜å– /auth/me æœƒ 401
â–¡ é admin å­˜å– /auth/users æœƒ 403
â–¡ å¯†ç¢¼åœ¨è³‡æ–™åº«æ˜¯åŠ å¯†çš„
```

## ğŸ”§ èª¿æ•´ç”¨ Prompts

```markdown
ã€å¦‚æœ token éæœŸå¤ªå¿«ã€‘
è«‹æŠŠ ACCESS_TOKEN_EXPIRE_MINUTES æ”¹æˆ 480 (8å°æ™‚)

ã€å¦‚æœè¦åŠ å…¥ refresh tokenã€‘
è«‹åœ¨ TokenResponse åŠ å…¥ refresh_token æ¬„ä½ï¼Œ
ä¸¦æ–°å¢ POST /auth/refresh ç«¯é»ä¾†æ›ç™¼æ–° token

ã€å¦‚æœè¦åŠ å…¥ç™»å‡ºåŠŸèƒ½ã€‘
è«‹å¯¦ä½œ token é»‘åå–®æ©Ÿåˆ¶ï¼Œä½¿ç”¨ Redis å„²å­˜å·²ç™»å‡ºçš„ token
```

---

# æ¨¡çµ„ 2ï¸âƒ£ï¼šå¾Œå°ç®¡ç†ç³»çµ±

## ğŸ¯ æ¨¡çµ„ç›®æ¨™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å•†å“ CRUDã€è¨‚å–®ç®¡ç†ã€ç³»çµ±è¨­å®š                   â”‚
â”‚  é™ admin/staff è§’è‰²å­˜å–                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ æ¶æ§‹æ€è·¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¾Œå°ç®¡ç†æ¶æ§‹æ€è·¯                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   ã€æ¬Šé™å±¤ç´šã€‘                                                  â”‚
â”‚   admin â”€â”€â–º å…¨éƒ¨åŠŸèƒ½ (åŒ…å«ç”¨æˆ¶ç®¡ç†)                            â”‚
â”‚   staff â”€â”€â–º å•†å“ç®¡ç† + è¨‚å–®ç®¡ç†                                â”‚
â”‚                                                                 â”‚
â”‚   ã€API è·¯å¾‘è¨­è¨ˆã€‘                                              â”‚
â”‚   /admin/products/*   å•†å“ç›¸é—œ                                  â”‚
â”‚   /admin/orders/*     è¨‚å–®ç›¸é—œ                                  â”‚
â”‚   /admin/users/*      ç”¨æˆ¶ç®¡ç† (åƒ… admin)                       â”‚
â”‚   /admin/stats/*      çµ±è¨ˆæ•¸æ“š                                  â”‚
â”‚                                                                 â”‚
â”‚   ã€CRUD çµ±ä¸€æ¨¡å¼ã€‘                                             â”‚
â”‚   GET    /items       åˆ—è¡¨ (æ”¯æ´åˆ†é ã€ç¯©é¸)                    â”‚
â”‚   GET    /items/{id}  å–®ç­†è©³æƒ…                                  â”‚
â”‚   POST   /items       æ–°å¢                                      â”‚
â”‚   PUT    /items/{id}  å®Œæ•´æ›´æ–°                                  â”‚
â”‚   PATCH  /items/{id}  éƒ¨åˆ†æ›´æ–°                                  â”‚
â”‚   DELETE /items/{id}  åˆªé™¤                                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ Vibe Coding Prompts

### **Step 1: å•†å“ç®¡ç†æ¨¡å‹**

```markdown
## Prompt 2-1: å•†å“ç®¡ç†è³‡æ–™æ¨¡å‹

ã€èƒŒæ™¯ã€‘
æˆ‘æ­£åœ¨å»ºç«‹å¾Œå°ç®¡ç†ç³»çµ±ï¼Œå…ˆå¾å•†å“ç®¡ç†é–‹å§‹ã€‚
é€™æ˜¯ä¸€å€‹é£Ÿå“æ‰¹ç™¼å•†çš„ç³»çµ±ï¼Œå•†å“æœ‰åˆ†é¡ã€åƒ¹æ ¼ã€åº«å­˜ç­‰è³‡è¨Šã€‚

ã€ä»»å‹™ã€‘
è«‹å»ºç«‹å•†å“ç›¸é—œçš„ Pydantic æ¨¡å‹ï¼š

1. ProductCategory (Enum)
   - FRUIT: æ°´æœ
   - VEGETABLE: è”¬èœ
   - MEAT: è‚‰é¡
   - SEAFOOD: æµ·é®®
   - DAIRY: ä¹³è£½å“
   - OTHER: å…¶ä»–

2. ProductBase
   - name: å•†å“åç¨± (å¿…å¡«ï¼Œæœ€é•·100å­—)
   - category: åˆ†é¡ (ProductCategory)
   - price: å–®åƒ¹ (Decimalï¼Œå¿…é ˆ > 0)
   - unit: å–®ä½ (å¦‚ï¼šå…¬æ–¤ã€ç®±ã€åŒ…)
   - description: æè¿° (é¸å¡«)

3. ProductCreate (ç¹¼æ‰¿ ProductBase)
   - stock: åˆå§‹åº«å­˜ (æ•´æ•¸ï¼Œé è¨­ 0)

4. ProductUpdate (æ‰€æœ‰æ¬„ä½é¸å¡«)
   - ç”¨æ–¼éƒ¨åˆ†æ›´æ–°

5. ProductInDB
   - id: UUID
   - åŒ…å«æ‰€æœ‰æ¬„ä½
   - stock: åº«å­˜æ•¸é‡
   - is_active: æ˜¯å¦ä¸Šæ¶
   - created_at, updated_at

6. ProductResponse (å›å‚³ç”¨)
   - åŒ ProductInDB

7. ProductListResponse (åˆ—è¡¨ç”¨)
   - items: List[ProductResponse]
   - total: ç¸½ç­†æ•¸
   - page: ç•¶å‰é 
   - page_size: æ¯é ç­†æ•¸

ã€è¼¸å‡ºã€‘
å®Œæ•´çš„ products/models.py
```

### **Step 2: å•†å“ CRUD æœå‹™**

```markdown
## Prompt 2-2: å•†å“ CRUD æœå‹™å±¤

ã€èƒŒæ™¯ã€‘
åŸºæ–¼å‰›æ‰çš„æ¨¡å‹ï¼Œæˆ‘éœ€è¦å¯¦ä½œå•†å“çš„è³‡æ–™åº«æ“ä½œã€‚

ã€ä»»å‹™ã€‘
è«‹å»ºç«‹ products/service.pyï¼š

1. async list_products(
     page: int = 1,
     page_size: int = 20,
     category: ProductCategory | None = None,
     search: str | None = None,
     is_active: bool | None = None
   ) -> ProductListResponse
   - æ”¯æ´åˆ†é 
   - æ”¯æ´ä¾åˆ†é¡ç¯©é¸
   - æ”¯æ´åç¨±æœå°‹ (æ¨¡ç³Šæœå°‹)
   - æ”¯æ´ä¸Šæ¶ç‹€æ…‹ç¯©é¸

2. async get_product(product_id: UUID) -> ProductInDB | None
   - ä¾ ID æŸ¥è©¢å–®ç­†

3. async create_product(data: ProductCreate) -> ProductInDB
   - æ–°å¢å•†å“
   - è‡ªå‹•è¨­å®š created_at

4. async update_product(
     product_id: UUID, 
     data: ProductUpdate
   ) -> ProductInDB | None
   - éƒ¨åˆ†æ›´æ–° (åªæ›´æ–°æœ‰å‚³å…¥çš„æ¬„ä½)
   - è‡ªå‹•æ›´æ–° updated_at

5. async delete_product(product_id: UUID) -> bool
   - è»Ÿåˆªé™¤ (è¨­å®š is_active = False)

6. async update_stock(
     product_id: UUID, 
     quantity_change: int
   ) -> ProductInDB
   - æ›´æ–°åº«å­˜ (å¯æ­£å¯è² )
   - åº«å­˜ä¸è¶³æ™‚æ‹‹å‡ºéŒ¯èª¤

ã€Supabase æŸ¥è©¢ç¯„ä¾‹ã€‘
```python
# åˆ—è¡¨æŸ¥è©¢
result = supabase.table("products").select("*").eq("is_active", True).execute()

# æ¨¡ç³Šæœå°‹
result = supabase.table("products").select("*").ilike("name", f"%{search}%").execute()

# åˆ†é 
result = supabase.table("products").select("*", count="exact").range(start, end).execute()
```

ã€è¼¸å‡ºã€‘
å®Œæ•´çš„ products/service.py
```

### **Step 3: å•†å“ API è·¯ç”±**

```markdown
## Prompt 2-3: å•†å“ç®¡ç† API è·¯ç”±

ã€èƒŒæ™¯ã€‘
æˆ‘éœ€è¦å°å¤–æš´éœ²å•†å“ç®¡ç†çš„ APIï¼Œåªæœ‰ admin å’Œ staff å¯ä»¥å­˜å–ã€‚

ã€ä»»å‹™ã€‘
è«‹å»ºç«‹ products/router.pyï¼š

1. GET /admin/products
   - æŸ¥è©¢åƒæ•¸ï¼špage, page_size, category, search, is_active
   - å›å‚³ ProductListResponse
   - éœ€è¦ admin æˆ– staff è§’è‰²

2. GET /admin/products/{product_id}
   - å›å‚³å–®ç­† ProductResponse
   - æ‰¾ä¸åˆ°å›å‚³ 404

3. POST /admin/products
   - æ¥æ”¶ ProductCreate
   - å›å‚³ ProductResponse
   - éœ€è¦ admin æˆ– staff è§’è‰²

4. PUT /admin/products/{product_id}
   - æ¥æ”¶ ProductUpdate
   - å›å‚³æ›´æ–°å¾Œçš„ ProductResponse
   - æ‰¾ä¸åˆ°å›å‚³ 404

5. DELETE /admin/products/{product_id}
   - è»Ÿåˆªé™¤
   - å›å‚³ {"success": true}

6. POST /admin/products/{product_id}/stock
   - æ¥æ”¶ {"quantity_change": int}
   - å›å‚³æ›´æ–°å¾Œçš„ ProductResponse
   - åº«å­˜ä¸è¶³å›å‚³ 400

ã€æ¬Šé™æ§åˆ¶ã€‘
ä½¿ç”¨æ¨¡çµ„1å»ºç«‹çš„ require_role è£é£¾å™¨
```python
from ..auth.utils import get_current_user, require_role

@router.get("/admin/products")
async def list_products(
    current_user: UserInDB = Depends(require_role(["admin", "staff"]))
):
    ...
```

ã€è¼¸å‡ºã€‘
å®Œæ•´çš„ products/router.py
```

### **Step 4: è¨‚å–®ç®¡ç†**

```markdown
## Prompt 2-4: è¨‚å–®ç®¡ç†å®Œæ•´æ¨¡çµ„

ã€èƒŒæ™¯ã€‘
è¨‚å–®æ˜¯ç³»çµ±çš„æ ¸å¿ƒï¼Œéœ€è¦è¿½è¹¤ç‹€æ…‹æµè½‰ã€‚

ã€è¨‚å–®ç‹€æ…‹æµç¨‹ã€‘
pending (å¾…è™•ç†) â†’ processing (è™•ç†ä¸­) â†’ shipped (å·²å‡ºè²¨) â†’ completed (å®Œæˆ)
                                      â†˜ cancelled (å–æ¶ˆ)

ã€ä»»å‹™ã€‘
è«‹ä¸€æ¬¡å»ºç«‹å®Œæ•´çš„è¨‚å–®ç®¡ç†æ¨¡çµ„ï¼š

**models.py éœ€è¦ï¼š**
1. OrderStatus (Enum): pending, processing, shipped, completed, cancelled
2. OrderItemCreate: product_id, quantity
3. OrderCreate: customer_id, items: List[OrderItemCreate], notes
4. OrderItemResponse: product_id, product_name, quantity, unit_price, subtotal
5. OrderResponse: id, customer_id, customer_name, items, status, total_amount, created_at, updated_at
6. OrderListResponse: items, total, page, page_size
7. OrderStatusUpdate: status, notes (ç”¨æ–¼æ›´æ–°ç‹€æ…‹)

**service.py éœ€è¦ï¼š**
1. list_orders(page, page_size, status, customer_id, date_from, date_to)
2. get_order(order_id)
3. create_order(data) - éœ€è¦åŒæ™‚æ‰£åº«å­˜
4. update_order_status(order_id, new_status, notes)
5. cancel_order(order_id) - éœ€è¦æ¢å¾©åº«å­˜
6. get_order_stats() - å›å‚³çµ±è¨ˆï¼šå„ç‹€æ…‹æ•¸é‡ã€ä»Šæ—¥è¨‚å–®æ•¸ã€æœ¬æœˆç‡Ÿæ”¶

**router.py éœ€è¦ï¼š**
- GET /admin/orders (åˆ—è¡¨)
- GET /admin/orders/{id} (è©³æƒ…)
- PATCH /admin/orders/{id}/status (æ›´æ–°ç‹€æ…‹)
- GET /admin/orders/stats (çµ±è¨ˆæ•¸æ“š)

ã€é‡è¦é‚è¼¯ã€‘
- å»ºç«‹è¨‚å–®æ™‚è¦è¨ˆç®— total_amount = sum(quantity * unit_price)
- å»ºç«‹è¨‚å–®æ™‚è¦å¾ products è¡¨æ‰£é™¤åº«å­˜
- å–æ¶ˆè¨‚å–®æ™‚è¦æ¢å¾©åº«å­˜
- ç‹€æ…‹åªèƒ½æŒ‰æµç¨‹å‰é€²ï¼Œä¸èƒ½å€’é€€ (é™¤äº†å–æ¶ˆ)

ã€è¼¸å‡ºã€‘
ä¸‰å€‹å®Œæ•´æª”æ¡ˆï¼šmodels.py, service.py, router.py
```

## âœ… é©—æ”¶æª¢æŸ¥æ¸…å–®

```
â–¡ å•†å“ CRUD å…¨éƒ¨æ­£å¸¸é‹ä½œ
â–¡ åˆ†é å’Œæœå°‹åŠŸèƒ½æ­£å¸¸
â–¡ å»ºç«‹è¨‚å–®æœƒæ‰£åº«å­˜
â–¡ åº«å­˜ä¸è¶³ç„¡æ³•ä¸‹å–®
â–¡ å–æ¶ˆè¨‚å–®æœƒæ¢å¾©åº«å­˜
â–¡ è¨‚å–®ç‹€æ…‹åªèƒ½å¾€å‰èµ°
â–¡ çµ±è¨ˆæ•¸æ“šæ­£ç¢º
â–¡ é admin/staff ç„¡æ³•å­˜å–
```

---

# æ¨¡çµ„ 3ï¸âƒ£ï¼šå‰ç«¯å„€è¡¨æ¿ (Lovable)

## ğŸ¯ æ¨¡çµ„ç›®æ¨™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä½¿ç”¨ Lovable å¿«é€Ÿç”¢ç”Ÿ React å‰ç«¯                â”‚
â”‚  åŒ…å«ç™»å…¥ã€å„€è¡¨æ¿ã€è¨‚å–®ç®¡ç†ã€å®¢æˆ¶ç®¡ç†é é¢        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ æ¶æ§‹æ€è·¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯æ¶æ§‹æ€è·¯                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   ã€é é¢çµæ§‹ã€‘                                                  â”‚
â”‚   /login          â† ç™»å…¥é  (ç„¡éœ€èªè­‰)                          â”‚
â”‚   /               â† å„€è¡¨æ¿ (éœ€èªè­‰)                            â”‚
â”‚   /orders         â† è¨‚å–®åˆ—è¡¨                                   â”‚
â”‚   /orders/:id     â† è¨‚å–®è©³æƒ…                                   â”‚
â”‚   /customers      â† å®¢æˆ¶åˆ—è¡¨ (CRM)                             â”‚
â”‚   /customers/:id  â† å®¢æˆ¶è©³æƒ…                                   â”‚
â”‚   /products       â† å•†å“ç®¡ç†                                   â”‚
â”‚                                                                 â”‚
â”‚   ã€ç‹€æ…‹ç®¡ç†ã€‘                                                  â”‚
â”‚   AuthContext â”€â”€â–º ç®¡ç†ç™»å…¥ç‹€æ…‹ã€JWT token                      â”‚
â”‚   localStorage â”€â”€â–º æŒä¹…åŒ– token                                â”‚
â”‚                                                                 â”‚
â”‚   ã€API ä¸²æ¥ã€‘                                                  â”‚
â”‚   axios instance â”€â”€â–º è‡ªå‹•å¸¶å…¥ Bearer token                     â”‚
â”‚                  â”€â”€â–º 401 æ™‚è‡ªå‹•å°å‘ç™»å…¥é                       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ Vibe Coding Prompts (for Lovable)

### **Step 1: å°ˆæ¡ˆåˆå§‹åŒ– + ç™»å…¥é **

```markdown
## Lovable Prompt 3-1: å»ºç«‹å°ˆæ¡ˆèˆ‡ç™»å…¥é 

Create a React + TypeScript project for a B2B Order Management System called "OrderFlow".

## Project Setup
- Use Vite + React + TypeScript
- Tailwind CSS for styling
- React Router v6 for navigation
- Axios for API calls
- Recharts for charts
- Lucide React for icons

## First, create the Login Page (/login)

### Layout
- Centered card on a light gray background (#F3F4F6)
- Card width: max 400px
- White background with subtle shadow

### Components
1. Logo area at top
   - "OrderFlow" text in blue (#3B82F6), bold, 24px
   - Subtitle: "è¨‚å–®ç®¡ç†ç³»çµ±" in gray

2. Login Form
   - Email input with mail icon
   - Password input with lock icon (toggle visibility)
   - "è¨˜ä½æˆ‘" checkbox
   - "ç™»å…¥" button (full width, blue, rounded)
   - Loading spinner on submit

3. Form validation
   - Email format validation
   - Password minimum 8 characters
   - Show error messages below inputs in red

### API Integration Setup
Create src/lib/api.ts:
```typescript
import axios from 'axios';

const api = axios.create({
  baseURL: import.meta.env.VITE_API_URL || 'http://localhost:8000/api',
});

// Add auth token to requests
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// Handle 401 errors
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      localStorage.removeItem('token');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

export default api;
```

### Auth Context
Create src/contexts/AuthContext.tsx:
- Store user info and token
- login(email, password) function
- logout() function
- isAuthenticated boolean

### Protected Route Component
Create a wrapper that redirects to /login if not authenticated

Please generate all the code with proper TypeScript types.
```

### **Step 2: ä¸»è¦ä½ˆå±€ + å°è¦½åˆ—**

```markdown
## Lovable Prompt 3-2: ä¸»è¦ä½ˆå±€èˆ‡å°è¦½

Create the main layout for authenticated pages.

## Layout Structure

### Sidebar Navigation (Left side)
- Width: 240px (collapsible to 64px on mobile)
- Dark blue background (#1E3A5F)
- Logo at top

Navigation items with icons:
1. ğŸ“Š å„€è¡¨æ¿ (/) - LayoutDashboard icon
2. ğŸ“¦ è¨‚å–®ç®¡ç† (/orders) - Package icon
3. ğŸ‘¥ å®¢æˆ¶ç®¡ç† (/customers) - Users icon
4. ğŸ·ï¸ å•†å“ç®¡ç† (/products) - Tag icon

- Active item: lighter background, white text
- Hover effect on items
- Collapse button at bottom

### Top Navbar
- White background
- Left: Breadcrumb navigation
- Right: 
  - Notification bell icon (with red badge for unread)
  - User avatar dropdown
    - ç”¨æˆ¶åç¨±
    - è§’è‰² badge
    - Divider
    - è¨­å®š
    - ç™»å‡º

### Main Content Area
- Light gray background (#F9FAFB)
- Padding: 24px
- Max width: 1400px, centered
- Scrollable

### Responsive Behavior
- < 768px: Sidebar hidden, hamburger menu in navbar
- Sidebar overlays content when open on mobile

## Code Structure
```
src/
â”œâ”€â”€ layouts/
â”‚   â””â”€â”€ MainLayout.tsx
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”œâ”€â”€ Navbar.tsx
â”‚   â”œâ”€â”€ Breadcrumb.tsx
â”‚   â””â”€â”€ UserDropdown.tsx
```

Please implement with smooth transitions and proper TypeScript.
```

### **Step 3: å„€è¡¨æ¿é é¢**

```markdown
## Lovable Prompt 3-3: å„€è¡¨æ¿é é¢

Create the Dashboard page (/) with real-time stats and charts.

## Stats Cards Row (4 cards)

Each card has:
- Icon in colored circle (left)
- Value (large, bold)
- Label (small, gray)
- Trend indicator (â†‘ or â†“ with percentage)

Cards:
1. æœ¬æœˆç‡Ÿæ”¶ - DollarSign icon, green circle
   - Value: NT$ 1,234,567
   - Trend: â†‘ 12.5%

2. å¾…è™•ç†è¨‚å–® - Clock icon, yellow circle
   - Value: 23
   - Trend: â†“ 5%

3. æœ¬æœˆè¨‚å–®æ•¸ - ShoppingBag icon, blue circle
   - Value: 156
   - Trend: â†‘ 8.3%

4. å®¢æˆ¶ç¸½æ•¸ - Users icon, purple circle
   - Value: 48
   - Trend: â†‘ 2

## Charts Row (2 charts side by side)

### Left: ç‡Ÿæ”¶è¶¨å‹¢åœ– (Line Chart)
- Title: "è¿‘7æ—¥ç‡Ÿæ”¶è¶¨å‹¢"
- X-axis: æ—¥æœŸ (12/04 - 12/10)
- Y-axis: é‡‘é¡ (NT$)
- Blue line with gradient fill
- Tooltip showing exact value
- Using Recharts

### Right: è¨‚å–®ç‹€æ…‹åˆ†å¸ƒ (Pie Chart)
- Title: "è¨‚å–®ç‹€æ…‹åˆ†å¸ƒ"
- Segments:
  - å¾…è™•ç† (pending): Yellow
  - è™•ç†ä¸­ (processing): Blue
  - å·²å‡ºè²¨ (shipped): Purple
  - å·²å®Œæˆ (completed): Green
  - å·²å–æ¶ˆ (cancelled): Gray
- Legend at bottom
- Tooltip with count and percentage

## Recent Orders Table

Title: "æœ€è¿‘è¨‚å–®" with "æŸ¥çœ‹å…¨éƒ¨ â†’" link

Table columns:
- è¨‚å–®ç·¨è™Ÿ (ORD-XXXX)
- å®¢æˆ¶åç¨±
- é‡‘é¡
- ç‹€æ…‹ (colored badge)
- å»ºç«‹æ™‚é–“
- æ“ä½œ (eye icon to view)

Show 5 rows with mock data.

Status badge colors:
- pending: yellow bg
- processing: blue bg
- shipped: purple bg
- completed: green bg
- cancelled: gray bg

## API Endpoints to Call
```typescript
// On page load, call:
GET /admin/orders/stats
GET /admin/orders?page=1&page_size=5

// Response type for stats:
interface DashboardStats {
  monthlyRevenue: number;
  revenueGrowth: number;
  pendingOrders: number;
  monthlyOrders: number;
  totalCustomers: number;
  revenueByDay: { date: string; amount: number }[];
  ordersByStatus: { status: string; count: number }[];
}
```

## Loading States
- Skeleton loaders for cards and charts
- Spinner for table

Please make it look professional and polished.
```

### **Step 4: è¨‚å–®åˆ—è¡¨é **

```markdown
## Lovable Prompt 3-4: è¨‚å–®åˆ—è¡¨é 

Create the Orders List page (/orders).

## Page Header
- Title: "è¨‚å–®ç®¡ç†"
- Subtitle: "ç®¡ç†æ‰€æœ‰å®¢æˆ¶è¨‚å–®"

## Filter Bar

Row of filters:
1. æ—¥æœŸç¯„åœé¸æ“‡å™¨ (DateRangePicker)
   - é è¨­é¡¯ç¤ºæœ¬æœˆ
   - Quick options: ä»Šå¤©, æœ¬é€±, æœ¬æœˆ, ä¸Šæœˆ

2. ç‹€æ…‹ä¸‹æ‹‰é¸å–®
   - å…¨éƒ¨ç‹€æ…‹
   - å¾…è™•ç†
   - è™•ç†ä¸­
   - å·²å‡ºè²¨
   - å·²å®Œæˆ
   - å·²å–æ¶ˆ

3. æœå°‹æ¡†
   - Placeholder: "æœå°‹è¨‚å–®ç·¨è™Ÿæˆ–å®¢æˆ¶..."
   - Search icon inside
   - Debounced search (300ms)

4. åŒ¯å‡ºæŒ‰éˆ•
   - "åŒ¯å‡º Excel" with download icon
   - Secondary style (outlined)

## Orders Table

Sortable columns:
- è¨‚å–®ç·¨è™Ÿ (clickable, links to detail)
- å®¢æˆ¶åç¨±
- å•†å“æ•¸é‡
- ç¸½é‡‘é¡ (NT$ formatted)
- ç‹€æ…‹ (colored badge)
- å»ºç«‹æ™‚é–“ (relative time: "2å°æ™‚å‰")
- æ“ä½œ
  - Eye icon: æŸ¥çœ‹è©³æƒ…
  - Edit icon: æ›´æ–°ç‹€æ…‹ (opens modal)

## Status Update Modal

When clicking edit icon:
- Modal title: "æ›´æ–°è¨‚å–®ç‹€æ…‹"
- Current status shown
- Dropdown to select new status
  - Only show valid next statuses
- Notes textarea (optional)
- Cancel and Confirm buttons

## Pagination

At bottom of table:
- "é¡¯ç¤º 1-20 ç­†ï¼Œå…± 156 ç­†"
- Page size selector: 10, 20, 50
- Page number buttons with prev/next

## Empty State
When no orders:
- Illustration or icon
- "å°šç„¡è¨‚å–®è³‡æ–™"
- "ç•¶æœ‰æ–°è¨‚å–®æ™‚æœƒé¡¯ç¤ºåœ¨é€™è£¡"

## API Integration
```typescript
// List orders
GET /admin/orders?page=1&page_size=20&status=pending&date_from=2024-01-01&search=xxx

// Update status
PATCH /admin/orders/{id}/status
Body: { status: "processing", notes: "é–‹å§‹è™•ç†" }
```

Please include proper TypeScript interfaces and loading states.
```

### **Step 5: å®¢æˆ¶ç®¡ç†é  (CRM)**

```markdown
## Lovable Prompt 3-5: å®¢æˆ¶ç®¡ç†é é¢

Create the Customers page (/customers) as a CRM module.

## Page Header
- Title: "å®¢æˆ¶ç®¡ç†"
- "æ–°å¢å®¢æˆ¶" button (blue, with plus icon)

## View Toggle
- Grid view / Table view toggle buttons
- Save preference to localStorage

## Filter & Search
- Search box: "æœå°‹å…¬å¸åç¨±ã€è¯çµ¡äººã€é›»è©±..."
- Credit Level filter: All / Aç´š / Bç´š / Cç´š
- Sort by: æœ€è¿‘æ›´æ–° / å…¬å¸åç¨± / æ¶ˆè²»é‡‘é¡

## Customer Cards (Grid View)

Card layout:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Avatar]  å…¬å¸åç¨±         â”‚
â”‚            è¯çµ¡äºº           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ 0912-345-678            â”‚
â”‚  ğŸ“§ contact@company.com     â”‚
â”‚  ğŸ“ å°åŒ—å¸‚ä¿¡ç¾©å€...          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¿¡ç”¨ç­‰ç´š: [A] æœ¬æœˆæ¶ˆè²»: NT$50,000 â”‚
â”‚  è¨‚å–®æ•¸: 12    æœ€å¾Œè¨‚å–®: 2å¤©å‰     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [æŸ¥çœ‹è©³æƒ…]    [æ–°å¢è¨‚å–®]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Credit level badges:
- Aç´š: Green badge
- Bç´š: Blue badge  
- Cç´š: Gray badge

## Customer Table (Table View)

Columns:
- å…¬å¸åç¨±
- è¯çµ¡äºº
- é›»è©±
- ä¿¡ç”¨ç­‰ç´š
- ç¸½æ¶ˆè²»é‡‘é¡
- è¨‚å–®æ•¸
- æœ€å¾Œè¨‚å–®æ—¥
- æ“ä½œ (view/edit/delete)

## Add/Edit Customer Modal

Form fields:
- å…¬å¸åç¨± * (required)
- è¯çµ¡äºº *
- é›»è©± *
- Email
- åœ°å€
- ä¿¡ç”¨ç­‰ç´š (dropdown: A/B/C)
- å‚™è¨» (textarea)

Validation:
- Phone format: 09XX-XXX-XXX or 02-XXXX-XXXX
- Email format

## Customer Detail Page (/customers/:id)

Tabs:
1. åŸºæœ¬è³‡æ–™ - Display all customer info, edit button
2. è¨‚å–®è¨˜éŒ„ - Table of customer's orders
3. äº’å‹•è¨˜éŒ„ - Timeline of notes/interactions

Stats at top:
- ç¸½æ¶ˆè²»é‡‘é¡
- è¨‚å–®æ¬¡æ•¸
- å¹³å‡å–®åƒ¹
- å®¢æˆ¶ç­‰ç´š

## API Endpoints
```typescript
GET /api/customers
GET /api/customers/{id}
POST /api/customers
PUT /api/customers/{id}
DELETE /api/customers/{id}
GET /api/customers/{id}/orders
```

Please make the cards look modern with subtle shadows and hover effects.
```

## âœ… é©—æ”¶æª¢æŸ¥æ¸…å–®

```
â–¡ ç™»å…¥é é¢å¯æ­£å¸¸ç™»å…¥
â–¡ JWT token å­˜å…¥ localStorage
â–¡ æœªç™»å…¥æ™‚è‡ªå‹•å°å‘ç™»å…¥é 
â–¡ å´é‚Šæ¬„å°è¦½æ­£å¸¸
â–¡ å„€è¡¨æ¿æ•¸æ“šæ­£ç¢ºé¡¯ç¤º
â–¡ åœ–è¡¨æ­£å¸¸æ¸²æŸ“
â–¡ è¨‚å–®åˆ—è¡¨åˆ†é æ­£å¸¸
â–¡ è¨‚å–®ç‹€æ…‹å¯æ›´æ–°
â–¡ å®¢æˆ¶ CRUD æ­£å¸¸
â–¡ RWD åœ¨æ‰‹æ©Ÿä¸Šæ­£å¸¸
```

---

# æ¨¡çµ„ 4ï¸âƒ£ï¼šé›²ç«¯è³‡æ–™åº« (Supabase)

## ğŸ¯ æ¨¡çµ„ç›®æ¨™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åœ¨ Supabase å»ºç«‹å®Œæ•´çš„è³‡æ–™åº«çµæ§‹                â”‚
â”‚  åŒ…å«è³‡æ–™è¡¨ã€é—œè¯ã€ç´¢å¼•ã€RLS æ”¿ç­–               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ æ¶æ§‹æ€è·¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è³‡æ–™åº«æ¶æ§‹æ€è·¯                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   ã€è³‡æ–™è¡¨é—œè¯ã€‘                                                â”‚
â”‚                                                                 â”‚
â”‚   users â”€â”€â”€â”€â”                                                   â”‚
â”‚             â”‚ 1:N                                               â”‚
â”‚             â–¼                                                   â”‚
â”‚   orders â—„â”€â”€â”€â”€â”€â”€ customers (1:N)                               â”‚
â”‚      â”‚                                                          â”‚
â”‚      â”‚ 1:N                                                      â”‚
â”‚      â–¼                                                          â”‚
â”‚   order_items â”€â”€â”€â”€â–º products (N:1)                             â”‚
â”‚                                                                 â”‚
â”‚   ã€è¨­è¨ˆåŸå‰‡ã€‘                                                  â”‚
â”‚   â€¢ UUID ä½œç‚ºä¸»éµ (é¿å…åºè™ŸçŒœæ¸¬)                               â”‚
â”‚   â€¢ created_at / updated_at å¿…å‚™                               â”‚
â”‚   â€¢ è»Ÿåˆªé™¤ç”¨ is_active æˆ– deleted_at                           â”‚
â”‚   â€¢ é‡‘é¡ç”¨ DECIMAL(12,2)                                       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ Vibe Coding Prompts

### **Step 1: å»ºç«‹è³‡æ–™è¡¨**

```markdown
## Prompt 4-1: å»ºç«‹ Supabase è³‡æ–™è¡¨ SQL

ã€èƒŒæ™¯ã€‘
æˆ‘è¦åœ¨ Supabase (PostgreSQL) å»ºç«‹è¨‚å–®ç®¡ç†ç³»çµ±çš„è³‡æ–™è¡¨ã€‚

ã€ä»»å‹™ã€‘
è«‹çµ¦æˆ‘å®Œæ•´çš„ SQL è…³æœ¬ä¾†å»ºç«‹ä»¥ä¸‹è³‡æ–™è¡¨ï¼š

**1. users è¡¨ (ç”¨æˆ¶)**
- id: UUID, ä¸»éµ, é è¨­ gen_random_uuid()
- email: VARCHAR(255), å”¯ä¸€, ä¸å¯ç©º
- password_hash: VARCHAR(255), ä¸å¯ç©º
- role: VARCHAR(20), é è¨­ 'customer', CHECK (admin/staff/customer)
- is_active: BOOLEAN, é è¨­ true
- created_at: TIMESTAMPTZ, é è¨­ NOW()
- updated_at: TIMESTAMPTZ, é è¨­ NOW()

**2. customers è¡¨ (å®¢æˆ¶/CRM)**
- id: UUID, ä¸»éµ
- company_name: VARCHAR(100), ä¸å¯ç©º
- contact_person: VARCHAR(50), ä¸å¯ç©º
- phone: VARCHAR(20), ä¸å¯ç©º
- email: VARCHAR(255)
- address: TEXT
- credit_level: CHAR(1), é è¨­ 'C', CHECK (A/B/C)
- notes: TEXT
- created_at, updated_at

**3. products è¡¨ (å•†å“)**
- id: UUID, ä¸»éµ
- name: VARCHAR(100), ä¸å¯ç©º
- category: VARCHAR(20), CHECK åˆ—èˆ‰å€¼
- price: DECIMAL(12,2), ä¸å¯ç©º, CHECK > 0
- unit: VARCHAR(20), é è¨­ 'å€‹'
- description: TEXT
- stock: INTEGER, é è¨­ 0, CHECK >= 0
- is_active: BOOLEAN, é è¨­ true
- created_at, updated_at

**4. orders è¡¨ (è¨‚å–®)**
- id: UUID, ä¸»éµ
- order_number: VARCHAR(20), å”¯ä¸€, ä¸å¯ç©º (æ ¼å¼: ORD-YYYYMMDD-XXXX)
- user_id: UUID, å¤–éµ â†’ users(id)
- customer_id: UUID, å¤–éµ â†’ customers(id)
- status: VARCHAR(20), é è¨­ 'pending'
- total_amount: DECIMAL(12,2), é è¨­ 0
- notes: TEXT
- created_at, updated_at

**5. order_items è¡¨ (è¨‚å–®æ˜ç´°)**
- id: UUID, ä¸»éµ
- order_id: UUID, å¤–éµ â†’ orders(id), ON DELETE CASCADE
- product_id: UUID, å¤–éµ â†’ products(id)
- quantity: INTEGER, ä¸å¯ç©º, CHECK > 0
- unit_price: DECIMAL(12,2), ä¸å¯ç©º (ä¸‹å–®ç•¶æ™‚åƒ¹æ ¼)
- subtotal: DECIMAL(12,2), GENERATED ALWAYS AS (quantity * unit_price)
- created_at

ã€é¡å¤–éœ€æ±‚ã€‘
1. æ¯å€‹è¡¨éƒ½è¦æœ‰é©ç•¶çš„ç´¢å¼•
2. å»ºç«‹ updated_at è‡ªå‹•æ›´æ–°çš„ trigger
3. å»ºç«‹è¨‚å–®ç·¨è™Ÿè‡ªå‹•ç”¢ç”Ÿçš„ function

ã€è¼¸å‡ºæ ¼å¼ã€‘
å®Œæ•´çš„ SQL è…³æœ¬ï¼ŒåŒ…å«ï¼š
1. CREATE TABLE èªå¥
2. CREATE INDEX èªå¥
3. CREATE FUNCTION å’Œ TRIGGER
4. è¨»è§£èªªæ˜æ¯å€‹éƒ¨åˆ†
```

### **Step 2: æ¸¬è©¦è³‡æ–™**

```markdown
## Prompt 4-2: ç”¢ç”Ÿæ¸¬è©¦è³‡æ–™ (Seed Data)

ã€èƒŒæ™¯ã€‘
è³‡æ–™è¡¨å·²å»ºå¥½ï¼Œæˆ‘éœ€è¦ä¸€äº›æ¸¬è©¦è³‡æ–™ä¾†é–‹ç™¼å’Œ Demoã€‚

ã€ä»»å‹™ã€‘
è«‹ç”¢ç”Ÿ SQL INSERT èªå¥ï¼ŒåŒ…å«ï¼š

**1. Users (5ç­†)**
- 1 å€‹ admin (admin@orderflow.com / admin123)
- 2 å€‹ staff
- 2 å€‹ customer

**2. Customers (10ç­†)**
- ä½¿ç”¨çœŸå¯¦æ„Ÿçš„å°ç£å…¬å¸åç¨±
- é›»è©±æ ¼å¼ï¼š09XX-XXX-XXX
- åœ°å€ä½¿ç”¨å°ç£åœ°å€æ ¼å¼
- ä¿¡ç”¨ç­‰ç´šåˆ†å¸ƒï¼š2å€‹Aç´šã€3å€‹Bç´šã€5å€‹Cç´š

**3. Products (15ç­†)**
é£Ÿå“æ‰¹ç™¼å•†çš„å•†å“ï¼ŒåŒ…å«ï¼š
- 3å€‹æ°´æœé¡ (FRUIT)
- 3å€‹è”¬èœé¡ (VEGETABLE)
- 3å€‹è‚‰é¡ (MEAT)
- 3å€‹æµ·é®®é¡ (SEAFOOD)
- 3å€‹ä¹³è£½å“ (DAIRY)

åƒ¹æ ¼ç¯„åœï¼š50-500 å…ƒ
åº«å­˜ç¯„åœï¼š10-200

**4. Orders (20ç­†)**
- åˆ†å¸ƒåœ¨éå»30å¤©
- å„ç¨®ç‹€æ…‹éƒ½è¦æœ‰
- æ¯ç­†è¨‚å–®æœ‰ 2-5 å€‹å“é …

**5. Order Items**
- æ ¹æ“šè¨‚å–®è‡ªå‹•ç”¢ç”Ÿ
- æ•¸é‡ 1-10
- unit_price ä½¿ç”¨å•†å“ç•¶æ™‚åƒ¹æ ¼

ã€æ ¼å¼è¦æ±‚ã€‘
- å¯†ç¢¼è¦ç”¨ bcrypt åŠ å¯† (çµ¦æˆ‘ Python ç¨‹å¼ç¢¼ä¾†ç”¢ç”Ÿ)
- æ—¥æœŸä½¿ç”¨ç›¸å°æ–¼ä»Šå¤©çš„å¤©æ•¸
- UUID ä½¿ç”¨ gen_random_uuid()

ã€è¼¸å‡ºã€‘
1. seed.sql æª”æ¡ˆ
2. ç”¢ç”ŸåŠ å¯†å¯†ç¢¼çš„ Python ç¨‹å¼ç¢¼
```

### **Step 3: Python é€£ç·šè¨­å®š**

```markdown
## Prompt 4-3: Python Supabase é€£ç·šæ¨¡çµ„

ã€èƒŒæ™¯ã€‘
æˆ‘éœ€è¦å¾ FastAPI é€£ç·šåˆ° Supabase è³‡æ–™åº«ã€‚

ã€ä»»å‹™ã€‘
è«‹å»ºç«‹ database.py é€£ç·šæ¨¡çµ„ï¼š

**1. ç’°å¢ƒè®Šæ•¸é…ç½®**
```python
# .env æª”æ¡ˆæ ¼å¼
SUPABASE_URL=https://xxxx.supabase.co
SUPABASE_KEY=eyJxxxx
DATABASE_URL=postgresql://postgres:xxx@db.xxxx.supabase.co:5432/postgres
```

**2. Supabase Client åˆå§‹åŒ–**
- ä½¿ç”¨ supabase-py å¥—ä»¶
- Singleton æ¨¡å¼
- é€£ç·šæ¸¬è©¦å‡½æ•¸

**3. é€šç”¨çš„ CRUD å·¥å…·å‡½æ•¸**
```python
class DatabaseService:
    def __init__(self, table_name: str):
        self.table = table_name
    
    async def find_all(self, filters: dict = None, page: int = 1, page_size: int = 20)
    async def find_one(self, id: str)
    async def find_by(self, column: str, value: any)
    async def create(self, data: dict)
    async def update(self, id: str, data: dict)
    async def delete(self, id: str, soft: bool = True)
    async def count(self, filters: dict = None)
```

**4. äº¤æ˜“è™•ç†**
- ä½¿ç”¨ psycopg2 æˆ– asyncpg è™•ç†éœ€è¦äº¤æ˜“çš„æ“ä½œ
- æä¾› context manager

**5. éŒ¯èª¤è™•ç†**
- è‡ªå®šç¾©ä¾‹å¤–é¡åˆ¥
- é€£ç·šé‡è©¦æ©Ÿåˆ¶

ã€è¼¸å‡ºã€‘
å®Œæ•´çš„ database.py å’Œ .env.example
```

## âœ… é©—æ”¶æª¢æŸ¥æ¸…å–®

```
â–¡ æ‰€æœ‰è³‡æ–™è¡¨æˆåŠŸå»ºç«‹
â–¡ å¤–éµé—œè¯æ­£ç¢º
â–¡ ç´¢å¼•å·²å»ºç«‹
â–¡ updated_at è‡ªå‹•æ›´æ–°
â–¡ æ¸¬è©¦è³‡æ–™å·²åŒ¯å…¥
â–¡ Python å¯æˆåŠŸé€£ç·š
â–¡ CRUD æ“ä½œæ­£å¸¸
â–¡ å¯†ç¢¼æ­£ç¢ºåŠ å¯†
```

---

# æ¨¡çµ„ 5ï¸âƒ£ï¼šGoogle Sheet æ•´åˆ

## ğŸ¯ æ¨¡çµ„ç›®æ¨™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å°‡è³‡æ–™åº«æ•¸æ“šåŒæ­¥åˆ° Google Sheet                 â”‚
â”‚  ä¾›éæŠ€è¡“äººå“¡æŸ¥çœ‹å ±è¡¨                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ æ¶æ§‹æ€è·¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Google Sheet æ•´åˆæ€è·¯                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   ã€èªè­‰æ–¹å¼ã€‘                                                  â”‚
â”‚   Service Account â”€â”€â–º ä¸éœ€ç”¨æˆ¶ç™»å…¥ï¼ŒèƒŒæ™¯åŸ·è¡Œ                    â”‚
â”‚                                                                 â”‚
â”‚   ã€åŒæ­¥ç­–ç•¥ã€‘                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚ æ‰‹å‹•è§¸ç™¼ â”‚      â”‚ å®šæ™‚ä»»å‹™ â”‚      â”‚ äº‹ä»¶è§¸ç™¼ â”‚               â”‚
â”‚   â”‚ API å‘¼å« â”‚      â”‚ æ¯æ—¥å‡Œæ™¨ â”‚      â”‚ è¨‚å–®å®Œæˆ â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â”‚   ã€Sheet çµæ§‹ã€‘                                                â”‚
â”‚   ğŸ“Š OrderFlow å ±è¡¨                                             â”‚
â”‚   â”œâ”€â”€ æœ¬é€±è¨‚å–®æ˜ç´°                                              â”‚
â”‚   â”œâ”€â”€ æœˆç‡Ÿæ”¶å½™ç¸½                                                â”‚
â”‚   â”œâ”€â”€ å®¢æˆ¶æ¶ˆè²»æ’è¡Œ                                              â”‚
â”‚   â””â”€â”€ å•†å“éŠ·é‡çµ±è¨ˆ                                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ Vibe Coding Prompts

### **Step 1: è¨­å®š Service Account**

```markdown
## Prompt 5-1: Google Service Account è¨­å®šæŒ‡å—

ã€èƒŒæ™¯ã€‘
æˆ‘éœ€è¦è®“ Python ç¨‹å¼è‡ªå‹•å¯«å…¥ Google Sheetï¼Œä¸éœ€è¦ç”¨æˆ¶æ‰‹å‹•æˆæ¬Šã€‚

ã€ä»»å‹™ã€‘
è«‹çµ¦æˆ‘å®Œæ•´çš„è¨­å®šæ­¥é©Ÿæ•™å­¸ï¼š

**1. Google Cloud Console è¨­å®š**
- å»ºç«‹å°ˆæ¡ˆ
- å•Ÿç”¨ Google Sheets API
- å•Ÿç”¨ Google Drive API
- å»ºç«‹ Service Account
- ä¸‹è¼‰ JSON é‡‘é‘°

**2. Google Sheet æ¬Šé™è¨­å®š**
- å¦‚ä½•å°‡ Sheet åˆ†äº«çµ¦ Service Account
- Service Account çš„ email æ ¼å¼èªªæ˜

**3. ç’°å¢ƒè®Šæ•¸é…ç½®**
- JSON é‡‘é‘°çš„è™•ç†æ–¹å¼
- å»ºè­°çš„ .env æ ¼å¼

**4. å®‰å…¨æ³¨æ„äº‹é …**
- ä¸è¦æŠŠ JSON é‡‘é‘° commit åˆ° git
- ç”Ÿç”¢ç’°å¢ƒçš„å»ºè­°åšæ³•

ã€è¼¸å‡ºæ ¼å¼ã€‘
Step by step æ•™å­¸ï¼ŒåŒ…å«æˆªåœ–ä½ç½®èªªæ˜
```

### **Step 2: Google Sheet æœå‹™æ¨¡çµ„**

```markdown
## Prompt 5-2: Google Sheet æ“ä½œæœå‹™

ã€èƒŒæ™¯ã€‘
Service Account å·²è¨­å®šå¥½ï¼Œæˆ‘éœ€è¦ Python æ¨¡çµ„ä¾†æ“ä½œ Google Sheetã€‚

ã€ä»»å‹™ã€‘
è«‹å»ºç«‹ sheets/service.pyï¼š

**1. åˆå§‹åŒ–é€£ç·š**
```python
import gspread
from google.oauth2.service_account import Credentials

class GoogleSheetService:
    def __init__(self):
        # å¾ç’°å¢ƒè®Šæ•¸æˆ– JSON æª”æ¡ˆè¼‰å…¥æ†‘è­‰
        # é€£æ¥åˆ°æŒ‡å®šçš„ Spreadsheet
        pass
```

**2. åŸºæœ¬æ“ä½œå‡½æ•¸**
```python
def get_worksheet(self, sheet_name: str)
    """å–å¾—æˆ–å»ºç«‹å·¥ä½œè¡¨"""

def clear_worksheet(self, sheet_name: str)
    """æ¸…ç©ºå·¥ä½œè¡¨å…§å®¹"""

def write_header(self, sheet_name: str, headers: list)
    """å¯«å…¥æ¨™é¡Œåˆ—ï¼ˆç²—é«”ã€å‡çµï¼‰"""

def append_rows(self, sheet_name: str, data: list[list])
    """æ‰¹æ¬¡æ–°å¢å¤šåˆ—è³‡æ–™"""

def update_cell(self, sheet_name: str, row: int, col: int, value)
    """æ›´æ–°å–®ä¸€å„²å­˜æ ¼"""

def format_as_currency(self, sheet_name: str, column: str)
    """å°‡æŒ‡å®šæ¬„ä½æ ¼å¼åŒ–ç‚ºè²¨å¹£"""

def format_as_date(self, sheet_name: str, column: str)
    """å°‡æŒ‡å®šæ¬„ä½æ ¼å¼åŒ–ç‚ºæ—¥æœŸ"""
```

**3. å ±è¡¨ç”¢ç”Ÿå‡½æ•¸**
```python
async def generate_weekly_orders_report(self, start_date, end_date)
    """
    ç”¢ç”Ÿé€±è¨‚å–®æ˜ç´°å ±è¡¨
    æ¬„ä½ï¼šè¨‚å–®ç·¨è™Ÿã€å®¢æˆ¶ã€å•†å“æ˜ç´°ã€é‡‘é¡ã€ç‹€æ…‹ã€æ—¥æœŸ
    """

async def generate_monthly_revenue_summary(self, year: int, month: int)
    """
    ç”¢ç”Ÿæœˆç‡Ÿæ”¶å½™ç¸½
    æ¬„ä½ï¼šæ—¥æœŸã€è¨‚å–®æ•¸ã€ç‡Ÿæ”¶ã€å¹³å‡å–®åƒ¹
    æœ€å¾Œä¸€åˆ—ï¼šç•¶æœˆåˆè¨ˆ
    """

async def generate_customer_ranking(self, top_n: int = 20)
    """
    ç”¢ç”Ÿå®¢æˆ¶æ¶ˆè²»æ’è¡Œ
    æ¬„ä½ï¼šæ’åã€å…¬å¸åç¨±ã€è¯çµ¡äººã€ç¸½æ¶ˆè²»ã€è¨‚å–®æ•¸ã€å¹³å‡å–®åƒ¹ã€ç­‰ç´š
    """

async def generate_product_sales_report(self, start_date, end_date)
    """
    ç”¢ç”Ÿå•†å“éŠ·é‡å ±è¡¨
    æ¬„ä½ï¼šå•†å“åç¨±ã€åˆ†é¡ã€éŠ·å”®æ•¸é‡ã€éŠ·å”®é‡‘é¡ã€ä½”æ¯”
    """
```

**4. éŒ¯èª¤è™•ç†**
- API é™æµè™•ç† (429 Too Many Requests)
- é‡è©¦æ©Ÿåˆ¶ (exponential backoff)
- æ“ä½œå¤±æ•—é€šçŸ¥

ã€è¼¸å‡ºã€‘
å®Œæ•´çš„ sheets/service.py
```

### **Step 3: API ç«¯é»**

```markdown
## Prompt 5-3: å ±è¡¨ API ç«¯é»

ã€èƒŒæ™¯ã€‘
æˆ‘éœ€è¦åœ¨å¾Œå°æä¾›ã€ŒåŒ¯å‡ºå ±è¡¨ã€çš„åŠŸèƒ½ã€‚

ã€ä»»å‹™ã€‘
è«‹å»ºç«‹ sheets/router.pyï¼š

**1. æ‰‹å‹•è§¸ç™¼å ±è¡¨ç”¢ç”Ÿ**
```python
POST /admin/reports/weekly-orders
Body: { "start_date": "2024-01-01", "end_date": "2024-01-07" }
Response: { 
    "success": true, 
    "sheet_url": "https://docs.google.com/spreadsheets/d/xxx",
    "rows_written": 150
}

POST /admin/reports/monthly-revenue
Body: { "year": 2024, "month": 1 }

POST /admin/reports/customer-ranking
Body: { "top_n": 20 }

POST /admin/reports/product-sales
Body: { "start_date": "...", "end_date": "..." }
```

**2. å–å¾—å ±è¡¨ç‹€æ…‹**
```python
GET /admin/reports/status
Response: {
    "last_sync": "2024-01-10T08:00:00Z",
    "sheet_url": "https://...",
    "available_sheets": ["é€±è¨‚å–®æ˜ç´°", "æœˆç‡Ÿæ”¶å½™ç¸½", ...]
}
```

**3. å®šæ™‚ä»»å‹™è¨­å®š**
```python
# æ¯å¤©å‡Œæ™¨ 2 é»åŸ·è¡Œ
POST /admin/reports/schedule
Body: { "report_type": "weekly-orders", "cron": "0 2 * * *" }
```

ã€æ¬Šé™ã€‘
åƒ…é™ admin è§’è‰²å­˜å–

ã€è¼¸å‡ºã€‘
å®Œæ•´çš„ sheets/router.py
```

### **Step 4: å®šæ™‚ä»»å‹™**

```markdown
## Prompt 5-4: å®šæ™‚åŒæ­¥ä»»å‹™

ã€èƒŒæ™¯ã€‘
æˆ‘å¸Œæœ›æ¯å¤©è‡ªå‹•ç”¢ç”Ÿå ±è¡¨åˆ° Google Sheetã€‚

ã€ä»»å‹™ã€‘
è«‹ç”¨ APScheduler å¯¦ä½œå®šæ™‚ä»»å‹™ï¼š

**1. å®‰è£èˆ‡è¨­å®š**
```python
from apscheduler.schedulers.asyncio import AsyncIOScheduler
from apscheduler.triggers.cron import CronTrigger
```

**2. æ’ç¨‹ä»»å‹™å®šç¾©**
```python
# æ¯å¤©å‡Œæ™¨ 2:00 - åŒæ­¥æ˜¨æ—¥è¨‚å–®
# æ¯é€±ä¸€ 3:00 - ç”¢ç”Ÿä¸Šé€±é€±å ±
# æ¯æœˆ 1 è™Ÿ 4:00 - ç”¢ç”Ÿä¸Šæœˆæœˆå ±
```

**3. ä»»å‹™åŸ·è¡Œè¨˜éŒ„**
- è¨˜éŒ„æ¯æ¬¡åŸ·è¡Œçš„æ™‚é–“ã€çµæœ
- å¤±æ•—æ™‚ç™¼é€é€šçŸ¥ (å¯é¸)

**4. æ•´åˆåˆ° FastAPI**
```python
# main.py
@app.on_event("startup")
async def start_scheduler():
    ...

@app.on_event("shutdown")
async def shutdown_scheduler():
    ...
```

ã€è¼¸å‡ºã€‘
scheduler.py å’Œ main.py çš„æ•´åˆç¨‹å¼ç¢¼
```

## âœ… é©—æ”¶æª¢æŸ¥æ¸…å–®

```
â–¡ Service Account è¨­å®šå®Œæˆ
â–¡ Python å¯é€£ç·š Google Sheet
â–¡ å¯å¯«å…¥è³‡æ–™åˆ°å·¥ä½œè¡¨
â–¡ å ±è¡¨æ ¼å¼æ­£ç¢º (è²¨å¹£ã€æ—¥æœŸ)
â–¡ API å¯è§¸ç™¼å ±è¡¨ç”¢ç”Ÿ
â–¡ å®šæ™‚ä»»å‹™æ­£å¸¸åŸ·è¡Œ
â–¡ éŒ¯èª¤æœ‰é©ç•¶è™•ç†
â–¡ Google Sheet æœ‰é©ç•¶æ¬Šé™
```

---

# æ¨¡çµ„ 6ï¸âƒ£ï¼šCRM å®¢æˆ¶ç®¡ç†ç³»çµ±

## ğŸ¯ æ¨¡çµ„ç›®æ¨™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®Œæ•´çš„å®¢æˆ¶é—œä¿‚ç®¡ç†åŠŸèƒ½                          â”‚
â”‚  å®¢æˆ¶åˆ†ç´šã€æ¶ˆè²»åˆ†æã€æµå¤±é è­¦                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ æ¶æ§‹æ€è·¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       CRM æ¶æ§‹æ€è·¯                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   ã€CRM æ ¸å¿ƒåŠŸèƒ½ã€‘                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â”‚  å®¢æˆ¶è³‡æ–™   â”‚   â”‚  æ¶ˆè²»åˆ†æ   â”‚   â”‚  æ™ºèƒ½æ¨™ç±¤   â”‚         â”‚
â”‚   â”‚  CRUD       â”‚   â”‚  RFM æ¨¡å‹   â”‚   â”‚  è‡ªå‹•åˆ†ç´š   â”‚         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                 â”‚
â”‚   ã€RFM åˆ†ææ¨¡å‹ã€‘                                              â”‚
â”‚   R (Recency)  = æœ€è¿‘ä¸€æ¬¡æ¶ˆè²»è·ä»Šå¤©æ•¸                          â”‚
â”‚   F (Frequency) = æ¶ˆè²»é »ç‡ (éå»90å¤©è¨‚å–®æ•¸)                    â”‚
â”‚   M (Monetary)  = æ¶ˆè²»é‡‘é¡ (éå»90å¤©ç¸½é‡‘é¡)                    â”‚
â”‚                                                                 â”‚
â”‚   ã€è‡ªå‹•åˆ†ç´šé‚è¼¯ã€‘                                              â”‚
â”‚   Aç´š: RFM ç¸½åˆ† >= 12 æˆ– æœˆæ¶ˆè²» > 50,000                       â”‚
â”‚   Bç´š: RFM ç¸½åˆ† >= 8  æˆ– æœˆæ¶ˆè²» > 10,000                       â”‚
â”‚   Cç´š: å…¶ä»–                                                     â”‚
â”‚                                                                 â”‚
â”‚   ã€æµå¤±é è­¦ã€‘                                                  â”‚
â”‚   âš ï¸ è¶…é 30 å¤©æœªä¸‹å–®çš„æ´»èºå®¢æˆ¶                                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ Vibe Coding Prompts

### **Step 1: CRM è³‡æ–™æ¨¡å‹**

```markdown
## Prompt 6-1: CRM è³‡æ–™æ¨¡å‹è¨­è¨ˆ

ã€èƒŒæ™¯ã€‘
æˆ‘è¦å»ºç«‹ CRM æ¨¡çµ„ï¼Œé™¤äº†åŸºæœ¬ CRUD é‚„éœ€è¦å®¢æˆ¶åˆ†æåŠŸèƒ½ã€‚

ã€ä»»å‹™ã€‘
è«‹å»ºç«‹ customers/models.pyï¼š

**1. CreditLevel Enum**
- A: é«˜åƒ¹å€¼å®¢æˆ¶
- B: ä¸­ç­‰åƒ¹å€¼å®¢æˆ¶
- C: ä¸€èˆ¬å®¢æˆ¶

**2. CustomerBase**
- company_name: å…¬å¸åç¨± (å¿…å¡«ï¼Œæœ€é•·100å­—)
- contact_person: è¯çµ¡äºº (å¿…å¡«ï¼Œæœ€é•·50å­—)
- phone: é›»è©± (å¿…å¡«ï¼Œé©—è­‰æ ¼å¼)
- email: é›»å­éƒµä»¶ (é¸å¡«ï¼Œé©—è­‰æ ¼å¼)
- address: åœ°å€ (é¸å¡«)
- notes: å‚™è¨» (é¸å¡«)

**3. CustomerCreate** (ç¹¼æ‰¿ CustomerBase)

**4. CustomerUpdate** (æ‰€æœ‰æ¬„ä½é¸å¡«)

**5. CustomerInDB**
- id: UUID
- æ‰€æœ‰ Base æ¬„ä½
- credit_level: CreditLevel
- created_at, updated_at

**6. CustomerStats** (å®¢æˆ¶çµ±è¨ˆ)
- total_orders: ç¸½è¨‚å–®æ•¸
- total_spent: ç¸½æ¶ˆè²»é‡‘é¡
- average_order_value: å¹³å‡å–®åƒ¹
- last_order_date: æœ€å¾Œè¨‚å–®æ—¥
- days_since_last_order: è·ä¸Šæ¬¡ä¸‹å–®å¤©æ•¸
- monthly_average: æœˆå¹³å‡æ¶ˆè²»

**7. CustomerRFM** (RFM åˆ†æçµæœ)
- recency_score: 1-5
- frequency_score: 1-5
- monetary_score: 1-5
- total_score: 3-15
- segment: å®¢æˆ¶åˆ†ç¾¤æ¨™ç±¤

**8. CustomerResponse** (å®Œæ•´å›å‚³)
- åŸºæœ¬è³‡è¨Š + stats + rfm
- is_at_risk: æ˜¯å¦æœ‰æµå¤±é¢¨éšª

**9. CustomerListResponse**
- items: List[CustomerResponse]
- total, page, page_size
- at_risk_count: æœ‰é¢¨éšªçš„å®¢æˆ¶æ•¸

ã€è¼¸å‡ºã€‘
å®Œæ•´çš„ customers/models.py
```

### **Step 2: CRM æ¥­å‹™é‚è¼¯**

```markdown
## Prompt 6-2: CRM æœå‹™å±¤ - åˆ†æèˆ‡æ™ºèƒ½åŠŸèƒ½

ã€èƒŒæ™¯ã€‘
CRM çš„æ ¸å¿ƒåƒ¹å€¼åœ¨æ–¼æ•¸æ“šåˆ†æï¼Œå¹«åŠ©è­˜åˆ¥é«˜åƒ¹å€¼å®¢æˆ¶å’Œæµå¤±é¢¨éšªã€‚

ã€ä»»å‹™ã€‘
è«‹å»ºç«‹ customers/service.pyï¼š

**1. åŸºæœ¬ CRUD**
```python
async def list_customers(
    page: int = 1,
    page_size: int = 20,
    credit_level: CreditLevel = None,
    search: str = None,
    sort_by: str = "updated_at",
    sort_order: str = "desc",
    at_risk_only: bool = False
) -> CustomerListResponse

async def get_customer(customer_id: UUID) -> CustomerResponse | None

async def create_customer(data: CustomerCreate) -> CustomerResponse

async def update_customer(customer_id: UUID, data: CustomerUpdate) -> CustomerResponse

async def delete_customer(customer_id: UUID) -> bool
```

**2. çµ±è¨ˆè¨ˆç®—**
```python
async def calculate_customer_stats(customer_id: UUID) -> CustomerStats
    """
    è¨ˆç®—å–®ä¸€å®¢æˆ¶çš„æ¶ˆè²»çµ±è¨ˆ
    æŸ¥è©¢è©²å®¢æˆ¶æ‰€æœ‰è¨‚å–®ï¼Œè¨ˆç®—ï¼š
    - ç¸½è¨‚å–®æ•¸
    - ç¸½æ¶ˆè²»é‡‘é¡
    - å¹³å‡å–®åƒ¹
    - æœ€å¾Œè¨‚å–®æ—¥æœŸ
    - æœˆå¹³å‡æ¶ˆè²» (éå»12å€‹æœˆ)
    """
```

**3. RFM åˆ†æ**
```python
async def calculate_rfm(customer_id: UUID) -> CustomerRFM
    """
    è¨ˆç®— RFM åˆ†æ•¸
    
    Recency è©•åˆ† (è·ä¸Šæ¬¡ä¸‹å–®å¤©æ•¸):
    - <= 7 å¤©: 5åˆ†
    - <= 14 å¤©: 4åˆ†
    - <= 30 å¤©: 3åˆ†
    - <= 60 å¤©: 2åˆ†
    - > 60 å¤©: 1åˆ†
    
    Frequency è©•åˆ† (éå»90å¤©è¨‚å–®æ•¸):
    - >= 10 ç­†: 5åˆ†
    - >= 6 ç­†: 4åˆ†
    - >= 3 ç­†: 3åˆ†
    - >= 1 ç­†: 2åˆ†
    - 0 ç­†: 1åˆ†
    
    Monetary è©•åˆ† (éå»90å¤©æ¶ˆè²»):
    - >= 100,000: 5åˆ†
    - >= 50,000: 4åˆ†
    - >= 20,000: 3åˆ†
    - >= 5,000: 2åˆ†
    - < 5,000: 1åˆ†
    
    åˆ†ç¾¤æ¨™ç±¤:
    - ç¸½åˆ† >= 13: "VIPå®¢æˆ¶"
    - ç¸½åˆ† >= 10: "é«˜åƒ¹å€¼å®¢æˆ¶"
    - ç¸½åˆ† >= 7: "ä¸€èˆ¬å®¢æˆ¶"
    - ç¸½åˆ† >= 4: "ä½æ´»èºå®¢æˆ¶"
    - ç¸½åˆ† < 4: "æµå¤±é¢¨éšªå®¢æˆ¶"
    """

async def calculate_all_rfm() -> list[dict]
    """æ‰¹æ¬¡è¨ˆç®—æ‰€æœ‰å®¢æˆ¶çš„ RFM"""
```

**4. è‡ªå‹•åˆ†ç´š**
```python
async def auto_update_credit_levels()
    """
    æ ¹æ“š RFM åˆ†æ•¸è‡ªå‹•æ›´æ–°å®¢æˆ¶ç­‰ç´š
    æ¯æ—¥åŸ·è¡Œä¸€æ¬¡
    """
```

**5. æµå¤±é è­¦**
```python
async def get_at_risk_customers() -> list[CustomerResponse]
    """
    æ‰¾å‡ºæœ‰æµå¤±é¢¨éšªçš„å®¢æˆ¶:
    - éå» 90 å¤©æœ‰æ¶ˆè²»
    - æœ€è¿‘ 30 å¤©æ²’æœ‰æ¶ˆè²»
    - åŸæœ¬æ˜¯ A æˆ– B ç´šå®¢æˆ¶
    """

async def get_churn_analysis() -> dict
    """
    æµå¤±åˆ†æå ±å‘Š:
    - æœ¬æœˆæµå¤±å®¢æˆ¶æ•¸
    - æµå¤±å®¢æˆ¶ç¸½åƒ¹å€¼
    - æµå¤±åŸå› åˆ†æ (å¦‚æœæœ‰å‚™è¨»)
    """
```

**6. å®¢æˆ¶æ—…ç¨‹**
```python
async def get_customer_timeline(customer_id: UUID) -> list
    """
    å–å¾—å®¢æˆ¶äº’å‹•æ™‚é–“è»¸:
    - è¨‚å–®è¨˜éŒ„
    - ç­‰ç´šè®Šæ›´è¨˜éŒ„
    - å‚™è¨»è¨˜éŒ„
    æŒ‰æ™‚é–“æ’åº
    """
```

ã€è¼¸å‡ºã€‘
å®Œæ•´çš„ customers/service.py
```

### **Step 3: CRM API ç«¯é»**

```markdown
## Prompt 6-3: CRM API è·¯ç”±

ã€èƒŒæ™¯ã€‘
éœ€è¦å°å¤–æš´éœ² CRM åŠŸèƒ½çš„ APIã€‚

ã€ä»»å‹™ã€‘
è«‹å»ºç«‹ customers/router.pyï¼š

**1. åŸºæœ¬ CRUD**
```
GET    /api/customers              åˆ—è¡¨ (æ”¯æ´ç¯©é¸)
GET    /api/customers/{id}         å–®ç­†è©³æƒ… (å« stats + rfm)
POST   /api/customers              æ–°å¢
PUT    /api/customers/{id}         æ›´æ–°
DELETE /api/customers/{id}         åˆªé™¤
```

**2. åˆ†æç›¸é—œ**
```
GET    /api/customers/{id}/stats      è©²å®¢æˆ¶çµ±è¨ˆ
GET    /api/customers/{id}/rfm        è©²å®¢æˆ¶ RFM
GET    /api/customers/{id}/orders     è©²å®¢æˆ¶è¨‚å–®æ­·å²
GET    /api/customers/{id}/timeline   è©²å®¢æˆ¶äº’å‹•æ™‚é–“è»¸
```

**3. æ‰¹æ¬¡æ“ä½œ**
```
GET    /api/customers/at-risk         æµå¤±é¢¨éšªå®¢æˆ¶åˆ—è¡¨
GET    /api/customers/analysis        æ•´é«”å®¢æˆ¶åˆ†æå ±å‘Š
POST   /api/customers/recalculate     é‡æ–°è¨ˆç®—æ‰€æœ‰å®¢æˆ¶ç­‰ç´š
```

**4. åŒ¯å‡ºåŠŸèƒ½**
```
GET    /api/customers/export          åŒ¯å‡ºå®¢æˆ¶è³‡æ–™ (CSV)
```

ã€å®Œæ•´å›å‚³ç¯„ä¾‹ã€‘
```json
{
  "id": "uuid",
  "company_name": "å¥½å‘³é¤å»³",
  "contact_person": "ç‹å°æ˜",
  "phone": "0912-345-678",
  "email": "wang@goodtaste.com",
  "address": "å°åŒ—å¸‚ä¿¡ç¾©å€æ¾é«˜è·¯1è™Ÿ",
  "credit_level": "A",
  "notes": "åå¥½æœ‰æ©Ÿè”¬èœ",
  "created_at": "2024-01-01T00:00:00Z",
  "stats": {
    "total_orders": 45,
    "total_spent": 567800,
    "average_order_value": 12617,
    "last_order_date": "2024-01-08",
    "days_since_last_order": 2,
    "monthly_average": 47316
  },
  "rfm": {
    "recency_score": 5,
    "frequency_score": 4,
    "monetary_score": 5,
    "total_score": 14,
    "segment": "VIPå®¢æˆ¶"
  },
  "is_at_risk": false
}
```

ã€è¼¸å‡ºã€‘
å®Œæ•´çš„ customers/router.py
```

### **Step 4: å‰ç«¯ CRM é é¢ Prompt (Lovable)**

```markdown
## Lovable Prompt 6-4: CRM é€²éšåŠŸèƒ½é é¢

Enhance the existing Customers page with advanced CRM features.

## Customer Detail Page (/customers/:id)

### Header Section
- Large customer name
- Credit level badge (A/B/C with colors)
- "At Risk" warning badge if applicable
- Edit and Delete buttons

### Stats Cards Row (4 cards)
1. ç¸½æ¶ˆè²»é‡‘é¡ - NT$ XXX,XXX
2. è¨‚å–®æ¬¡æ•¸ - XX ç­†
3. å¹³å‡å–®åƒ¹ - NT$ X,XXX
4. ä¸Šæ¬¡æ¶ˆè²» - X å¤©å‰

### RFM Score Card
Visual representation:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RFM åˆ†æ                [VIPå®¢æˆ¶] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  R (Recency)    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  4/5    â”‚
â”‚  F (Frequency)  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  5/5    â”‚
â”‚  M (Monetary)   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  4/5    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¸½åˆ†: 13/15                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tabs
1. **è¨‚å–®è¨˜éŒ„** 
   - Table of customer's orders
   - Status filter
   - Date range filter

2. **æ¶ˆè²»è¶¨å‹¢**
   - Line chart: æœˆæ¶ˆè²»è¶¨å‹¢ (past 12 months)
   - Bar chart: å•†å“é¡åˆ¥åå¥½

3. **äº’å‹•æ™‚é–“è»¸**
   - Timeline component showing:
     - ğŸ›’ Order placed
     - â­ Credit level changed
     - ğŸ“ Note added
   - Each item shows date and details

4. **åŸºæœ¬è³‡æ–™**
   - Editable form
   - Company info
   - Contact info
   - Notes textarea

## At-Risk Customers Page (/customers/at-risk)

### Alert Banner
"âš ï¸ ç›®å‰æœ‰ X ä½å®¢æˆ¶æœ‰æµå¤±é¢¨éšªï¼Œå»ºè­°ç«‹å³é—œæ‡·"

### Customer Cards
Each card shows:
- Customer name and contact
- Last order: X days ago
- Previous monthly average
- "Contact" button (opens email)
- "Add Note" button

### Actions
- "åŒ¯å‡ºåå–®" button
- "ç™¼é€é—œæ‡·ä¿¡" button (future feature placeholder)

## Customer Analysis Dashboard (/customers/analysis)

### Overview Stats
- Total customers by level (pie chart)
- Monthly new customers (line chart)
- Churn rate trend (line chart)

### RFM Distribution
- Scatter plot: R vs F vs M
- Customer segments breakdown

### Top Customers Table
- Top 10 by revenue
- Top 10 by order frequency

Please implement with smooth animations and proper loading states.
```

## âœ… é©—æ”¶æª¢æŸ¥æ¸…å–®

```
â–¡ å®¢æˆ¶ CRUD æ­£å¸¸é‹ä½œ
â–¡ çµ±è¨ˆæ•¸æ“šæ­£ç¢ºè¨ˆç®—
â–¡ RFM åˆ†æ•¸è¨ˆç®—æ­£ç¢º
â–¡ è‡ªå‹•åˆ†ç´šé‚è¼¯æ­£ç¢º
â–¡ æµå¤±é è­¦åŠŸèƒ½æ­£å¸¸
â–¡ å®¢æˆ¶æ™‚é–“è»¸é¡¯ç¤ºæ­£ç¢º
â–¡ å‰ç«¯ RFM è¦–è¦ºåŒ–æ­£å¸¸
â–¡ At-Risk åˆ—è¡¨æ­£ç¢ºç¯©é¸
â–¡ åŒ¯å‡ºåŠŸèƒ½æ­£å¸¸
```

---

# ğŸ“‹ ç¸½æ•´ç†ï¼šPrompt ä½¿ç”¨é †åº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å»ºè­°é–‹ç™¼é †åº                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Phase 1: åŸºç¤å»ºè¨­ (Week 1)                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  æ¨¡çµ„4 Prompt 4-1 â†’ å»ºç«‹è³‡æ–™è¡¨                                      â”‚   â”‚
â”‚  â”‚  æ¨¡çµ„4 Prompt 4-2 â†’ åŒ¯å…¥æ¸¬è©¦è³‡æ–™                                    â”‚   â”‚
â”‚  â”‚  æ¨¡çµ„4 Prompt 4-3 â†’ Python é€£ç·š                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â–¼                                             â”‚
â”‚  Phase 2: æœƒå“¡ç³»çµ± (Week 2)                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  æ¨¡çµ„1 Prompt 1-1 â†’ è³‡æ–™æ¨¡å‹                                        â”‚   â”‚
â”‚  â”‚  æ¨¡çµ„1 Prompt 1-2 â†’ JWT å·¥å…·                                        â”‚   â”‚
â”‚  â”‚  æ¨¡çµ„1 Prompt 1-3 â†’ æœå‹™å±¤                                          â”‚   â”‚
â”‚  â”‚  æ¨¡çµ„1 Prompt 1-4 â†’ API è·¯ç”±                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â–¼                                             â”‚
â”‚  Phase 3: å¾Œå°ç®¡ç† (Week 3)                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  æ¨¡çµ„2 Prompt 2-1 â†’ å•†å“æ¨¡å‹                                        â”‚   â”‚
â”‚  â”‚  æ¨¡çµ„2 Prompt 2-2 â†’ å•†å“æœå‹™                                        â”‚   â”‚
â”‚  â”‚  æ¨¡çµ„2 Prompt 2-3 â†’ å•†å“è·¯ç”±                                        â”‚   â”‚
â”‚  â”‚  æ¨¡çµ„2 Prompt 2-4 â†’ è¨‚å–®ç®¡ç†                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â–¼                                             â”‚
â”‚  Phase 4: å‰ç«¯ä»‹é¢ (Week 4)                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  æ¨¡çµ„3 Prompt 3-1 â†’ ç™»å…¥é                                           â”‚   â”‚
â”‚  â”‚  æ¨¡çµ„3 Prompt 3-2 â†’ ä¸»è¦ä½ˆå±€                                        â”‚   â”‚
â”‚  â”‚  æ¨¡çµ„3 Prompt 3-3 â†’ å„€è¡¨æ¿                                          â”‚   â”‚
â”‚  â”‚  æ¨¡çµ„3 Prompt 3-4 â†’ è¨‚å–®é                                           â”‚   â”‚
â”‚  â”‚  æ¨¡çµ„3 Prompt 3-5 â†’ å®¢æˆ¶é                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â–¼                                             â”‚
â”‚  Phase 5: é€²éšåŠŸèƒ½ (Week 5)                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  æ¨¡çµ„6 Prompt 6-1~6-4 â†’ CRM å®Œæ•´åŠŸèƒ½                                â”‚   â”‚
â”‚  â”‚  æ¨¡çµ„5 Prompt 5-1~5-4 â†’ Google Sheet æ•´åˆ                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ é¡å¤–è³‡æº

éœ€è¦æˆ‘æä¾›ä»¥ä¸‹ä»»ä½•é …ç›®å—ï¼Ÿ

1. **å®Œæ•´çš„ requirements.txt** - Python å¥—ä»¶æ¸…å–®
2. **Docker éƒ¨ç½²è¨­å®š** - docker-compose.yml
3. **ç’°å¢ƒè®Šæ•¸ç¯„æœ¬** - .env.example
4. **API æ–‡æª”ç¯„æœ¬** - OpenAPI/Swagger è¨­å®š
5. **æ¸¬è©¦æ¡ˆä¾‹ Prompt** - å–®å…ƒæ¸¬è©¦å’Œæ•´åˆæ¸¬è©¦