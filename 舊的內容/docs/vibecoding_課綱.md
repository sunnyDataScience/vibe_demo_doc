# 🎯 Vibe Coding 工作坊課程設計：積木式系統開發

## 課程核心理念

```
┌─────────────────────────────────────────────────────────┐
│  「不寫程式碼，但建構系統思維」                         │
│   從需求 → 架構 → 流程 → AI實現 → 文件 → 整合          │
└─────────────────────────────────────────────────────────┘
```

---

## 📚 課程總覽：三階段學習法

### 【第一階段】俯瞰全局（2小時）
**目標**：建立完整系統的心智模型

```
完整系統長什麼樣？
        ↓
┌───────────────────────────────────────────────┐
│         🌐 前端儀表板 (Lovable)              │
│    (學員看到的介面：下單、查訂單)             │
└─────────────┬─────────────────────────────────┘
              ↓ 資料流動
┌─────────────────────────────────────────────────┐
│    🔐 會員登入 + 🎛️ 後台管理                    │
│    (誰能做什麼：權限控制的中樞)                 │
└──────────┬──────────────────────────────────────┘
           ↓ 存取資料
┌──────────────────────────────────────────────────┐
│         💾 雲端資料庫 (Supabase)                 │
│    (所有資料的家：訂單、會員、商品)              │
└──────┬───────────────────────────┬───────────────┘
       ↓                           ↓
┌──────────────┐           ┌──────────────────┐
│ 📊 Google    │           │ 🤝 CRM 客戶      │
│    Sheet     │           │    管理系統      │
│  (對帳報表)  │           │  (客戶互動紀錄)  │
└──────────────┘           └──────────────────┘
```

### 【第二階段】模組開發（12小時）
**目標**：由下至上，個別擊破每個積木

### 【第三階段】系統整合（2小時）
**目標**：積木組裝，跑通完整流程

---

## 🧩 第一階段：俯瞰全局（2小時）

### 📍 活動1：用戶故事地圖（30分鐘）

**帶領學生描繪使用情境**

```
情境：小明餐廳的訂單管理系統

👤 角色卡：
┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│  餐廳老闆   │  │  客戶經理   │  │  一般客戶   │
│  (系統管理者)│  │  (業務人員) │  │  (下單者)   │
└─────────────┘  └─────────────┘  └─────────────┘
      │                  │                  │
      ↓                  ↓                  ↓
 後台管理介面        CRM系統            前端下單頁面
```

**學生練習：**
1. 每組選一個角色
2. 寫下「他想要完成什麼任務」（便利貼）
3. 貼在白板上，畫出任務之間的關係

**產出文件**：`01_使用者旅程地圖.md`

---

### 📍 活動2：積木拆解（30分鐘）

**用樂高比喻讓學生理解模組化**

```
一套完整系統 = 6塊樂高積木

🧱 基礎層積木（必須先做）
   ├─ 模組4：資料庫（所有資料的地基）
   └─ 模組1：會員登入（誰能進來的門）

🧱 功能層積木（蓋在基礎上）
   ├─ 模組2：後台管理（老闆的控制室）
   ├─ 模組3：前端儀表板（客戶的操作面板）
   └─ 模組6：CRM系統（客戶資料整理箱）

🧱 擴展層積木（錦上添花）
   └─ 模組5：Google Sheet（自動產報表）
```

**學生練習：**
1. 拿到6張「模組卡片」
2. 討論「哪個模組要先做？為什麼？」
3. 排出開發順序

**產出文件**：`02_模組依賴關係圖.md`

---

### 📍 活動3：資料流動模擬（60分鐘）

**用角色扮演理解資料如何流動**

**情境劇本：客戶下單流程**

```
🎬 場景1：客戶登入
演員A（客戶）：「我想登入下單」
演員B（登入系統）：「請給我帳號密碼」
演員A：「user123 / pass456」
演員B 問 演員C（資料庫）：「這組帳密對嗎？」
演員C：「對的！這是他的資料」→ 回傳會員資料
演員B：「歡迎回來！」→ 讓客戶進入系統

🎬 場景2：瀏覽商品
演員A：「我想看商品列表」
演員D（前端儀表板）問 演員C（資料庫）：「給我所有商品」
演員C：「這是商品清單」→ 回傳商品資料
演員D：「這是可以買的商品」→ 顯示給客戶

🎬 場景3：下單
演員A：「我要買商品001，2個」
演員D：「收到！」→ 送出訂單資料
演員C：「已儲存訂單編號ORD-123」
演員E（後台管理）：「老闆！有新訂單了」
演員F（Google Sheet）：「我幫你記錄在報表裡」
```

**學生練習：**
- 6人一組，每人扮演一個模組
- 演出完整流程
- 記錄「誰問了誰？傳了什麼資料？」

**產出文件**：`03_資料流程圖.md`

---

## 🧩 第二階段：模組開發（12小時）

### 開發原則：SDD（Structure-Driven Development）

```
每個模組開發流程：
1️⃣ 第一性原理拆解（20分鐘）
2️⃣ 架構設計（30分鐘）
3️⃣ Vibe Prompt設計（20分鐘）
4️⃣ AI協作開發（40分鐘）
5️⃣ 文件產出（30分鐘）
────────────────────────────
總計：2小時20分鐘/模組
```

---

## 📦 模組1：會員登入系統（2.5小時）

### 🔍 第一性原理拆解

**核心知識點：身份驗證 (Authentication)**

```
最根本的問題：
「怎麼證明你是你？」

生活類比：
├─ 進公司刷門禁卡 → 卡片 = 身份證明
├─ 銀行提款輸入密碼 → 密碼 = 秘密資訊
└─ 手機指紋解鎖 → 生物特徵 = 唯一識別

軟體中的實現：
帳號 + 密碼 = 數位身份證明
```

**拆解成3個子問題：**
1. **註冊**：「怎麼讓新人加入？」
2. **登入**：「怎麼確認是本人？」
3. **保持狀態**：「怎麼讓他不用一直登入？」

---

### 📐 架構設計（用白話文）

**學生填寫架構設計表**

| 設計面向 | 學生需要思考的問題 | 範例答案 |
|---------|-------------------|---------|
| **輸入是什麼？** | 使用者要提供什麼資訊？ | 帳號、密碼、（email） |
| **處理邏輯** | 系統要檢查什麼？ | 1. 帳號是否已存在<br>2. 密碼是否符合規則<br>3. 密碼是否正確 |
| **輸出是什麼？** | 成功/失敗後顯示什麼？ | 成功→進入系統<br>失敗→顯示錯誤訊息 |
| **資料存哪裡？** | 哪些資訊要存起來？ | 帳號、加密後的密碼、註冊時間 |
| **安全性考量** | 有什麼風險？怎麼防？ | 密碼不能明文存→要加密<br>避免暴力破解→錯太多次鎖帳號 |

**產出文件**：`模組1_架構設計文件.md`

---

### 💬 Vibe Prompt 設計

**教學生如何寫出好Prompt**

#### ❌ 不好的Prompt：
```
「幫我做會員登入」
```
**問題**：太模糊，AI不知道要做什麼

#### ✅ 好的Prompt（結構化範本）：

```markdown
# 會員登入系統需求

## 背景說明
我正在做一個訂單管理系統，需要區分「客戶」和「管理員」兩種身份。

## 功能需求

### 註冊功能
**使用者角色**：新客戶
**流程**：
1. 填寫註冊表單（帳號、密碼、email、公司名稱）
2. 系統檢查帳號是否已被使用
3. 如果可用 → 建立帳號，寄送歡迎信
4. 如果已存在 → 顯示「帳號已被使用，請換一個」

**驗證規則**：
- 帳號：4-20字元，只能英文數字
- 密碼：至少8個字元，要有英文+數字
- Email：要符合email格式

### 登入功能
**使用者角色**：已註冊客戶
**流程**：
1. 輸入帳號密碼
2. 系統檢查資料庫
3. 如果正確 → 記住登入狀態，導向首頁
4. 如果錯誤 → 顯示「帳號或密碼錯誤」
5. 如果連錯3次 → 鎖定帳號30分鐘

### 登出功能
**流程**：
清除登入狀態，導回登入頁面

## 技術需求
- 資料庫：使用 Supabase
- 密碼處理：需要加密（不要明文存）
- 登入狀態：保持7天（除非主動登出）

## 介面需求
- 簡潔的登入畫面（不要太花俏）
- 錯誤訊息要清楚明確
- 手機版也要能用

請幫我生成這個會員系統的程式碼。
```

**學生練習：**
用這個範本，填寫自己的需求

**產出文件**：`模組1_開發Prompt.md`

---

### 🤖 AI協作開發（實作演練）

**Step 1：第一版實現（20分鐘）**

```
學生：把準備好的Prompt丟給AI（Claude/GPT）
AI：回傳程式碼
學生：複製到開發環境執行
```

**Step 2：測試驗證（10分鐘）**

**測試清單（學生逐一確認）：**
- [ ] 能註冊新帳號
- [ ] 重複帳號會被擋下
- [ ] 能用註冊的帳號登入
- [ ] 錯誤密碼無法登入
- [ ] 登出後需要重新登入

**Step 3：發現問題，迭代改進（10分鐘）**

**如果測試失敗，教學生如何修正Prompt：**

```
學生：「註冊時系統沒有檢查密碼強度」
講師：「很好！你發現了問題。現在告訴AI：
       『我發現密碼沒有被檢查，請加上驗證：
        至少8個字元，要包含英文和數字』」
AI：回傳修正後的程式碼
```

**產出文件**：`模組1_測試報告.md`

---

### 📝 文件產出（文件驅動開發）

**每個模組都要產出的4份文件：**

#### 1️⃣ **架構設計文件**
```markdown
# 模組1：會員登入系統架構

## 系統目標
提供安全的身份驗證機制，區分客戶和管理員權限

## 核心功能
1. 註冊
2. 登入
3. 登出
4. 權限判定

## 資料結構
```sql
使用者表 (users)
├─ id (唯一識別碼)
├─ username (帳號)
├─ password_hash (加密後的密碼)
├─ email (信箱)
├─ role (角色：customer/admin)
└─ created_at (註冊時間)
```

## 流程圖
[插入流程圖]

## 安全機制
- 密碼使用bcrypt加密
- 登入狀態使用JWT Token
- 連續登入失敗鎖定機制
```

#### 2️⃣ **開發Prompt文件**
```markdown
# 模組1：給AI的開發指令

## Prompt 版本記錄
v1.0 (2025-01-01)：初版
v1.1 (2025-01-02)：新增密碼強度檢查
v1.2 (2025-01-03)：修正登出邏輯

## 當前使用的Prompt
[完整的Prompt內容]

## AI回應分析
- 哪些部分AI理解正確
- 哪些需要額外說明
- 遇到的問題與解決方式
```

#### 3️⃣ **測試報告**
```markdown
# 模組1：測試報告

## 測試日期
2025-01-05

## 測試案例

| 編號 | 測試項目 | 輸入 | 預期結果 | 實際結果 | 狀態 |
|------|----------|------|----------|----------|------|
| T01 | 註冊新帳號 | user001/pass1234 | 註冊成功 | ✅成功 | PASS |
| T02 | 重複帳號 | user001/pass5678 | 顯示錯誤 | ✅顯示錯誤 | PASS |
| T03 | 弱密碼 | user002/123 | 拒絕註冊 | ⚠️允許註冊 | FAIL |

## 發現的問題
1. 密碼強度檢查未生效 → 已修正

## 待改進項目
- 加入email驗證機制
- 忘記密碼功能
```

#### 4️⃣ **擴展性備忘錄**
```markdown
# 模組1：未來可能的擴展

## 短期擴展（1個月內）
- 社群登入（Google/Facebook）
- 雙因素驗證（2FA）

## 中期擴展（3個月內）
- 多租戶支援（一個系統多家公司用）
- 細緻的權限管理（不只客戶/管理員）

## 長期擴展（6個月以上）
- SSO單一登入整合
- 生物辨識登入

## 設計時要注意
- 資料庫schema預留role_details欄位（JSON格式）
- API設計要支援多種驗證方式
```

---

### 🎯 可維護性思考引導

**在開發過程中，講師要不斷提問：**

| 維度 | 引導問題 | 期望學生思考的點 |
|------|---------|------------------|
| **模組化** | 「如果未來要改密碼規則，需要改幾個地方？」 | → 驗證邏輯應該集中在一個地方 |
| **擴展性** | 「如果未來要加Line登入，現在的架構好加嗎？」 | → 應該設計「登入方式」的抽象層 |
| **可讀性** | 「6個月後另一個人接手，他看得懂你的設計嗎？」 | → 文件的重要性 |
| **安全性** | 「如果駭客想攻擊，他會從哪裡下手？」 | → 輸入驗證、密碼存儲 |

---

## 📦 模組2：後台管理系統（2.5小時）

### 🔍 第一性原理拆解

**核心知識點：權限管理 (Authorization)**

```
最根本的問題：
「不同的人能做不同的事」

生活類比：
├─ 超市員工：只能收銀
├─ 店長：能收銀+查看報表+管理員工
└─ 總部：能看所有店的資料

軟體中的實現：
角色(Role) + 權限(Permission) = 能做什麼
```

**拆解成4個子問題：**
1. **角色定義**：「系統有哪些角色？」
2. **權限分配**：「每個角色能做什麼？」
3. **權限檢查**：「怎麼確認某人有權限做某事？」
4. **介面呈現**：「不同角色看到不同畫面」

---

### 📐 架構設計

**角色-權限對照表（學生設計）**

```
🎭 角色定義

┌─────────────┬───────────────────────────────┐
│   角色名稱   │         能做的事情            │
├─────────────┼───────────────────────────────┤
│ 超級管理員  │ • 管理所有使用者              │
│ (Super Admin)│ • 查看所有訂單                │
│             │ • 修改系統設定                │
│             │ • 匯出資料                    │
├─────────────┼───────────────────────────────┤
│ 一般管理員  │ • 查看訂單                    │
│ (Admin)     │ • 修改訂單狀態                │
│             │ • 管理商品                    │
├─────────────┼───────────────────────────────┤
│ 客戶經理    │ • 查看自己負責的客戶訂單      │
│ (Manager)   │ • 聯繫客戶                    │
│             │ • 新增客戶備註                │
├─────────────┼───────────────────────────────┤
│ 一般客戶    │ • 查看自己的訂單              │
│ (Customer)  │ • 下新訂單                    │
│             │ • 修改個人資料                │
└─────────────┴───────────────────────────────┘
```

**頁面訪問控制矩陣**

```
                 |超級管理員|一般管理員|客戶經理|一般客戶|
─────────────────┼─────────┼─────────┼────────┼────────┤
訂單列表(全部)   |    ✅    |    ✅    |   ❌   |   ❌   |
訂單列表(自己的) |    ✅    |    ✅    |   ✅   |   ✅   |
修改訂單狀態     |    ✅    |    ✅    |   ❌   |   ❌   |
使用者管理       |    ✅    |    ❌    |   ❌   |   ❌   |
系統設定         |    ✅    |    ❌    |   ❌   |   ❌   |
CRM客戶資料      |    ✅    |    ✅    |   ✅   |   ❌   |
```

**學生練習：設計自己的角色權限表**

**產出文件**：`模組2_權限設計矩陣.md`

---

### 💬 Vibe Prompt範例

```markdown
# 後台管理系統需求

## 系統角色
我需要4種角色：超級管理員、一般管理員、客戶經理、一般客戶

權限分配如下：
[貼上剛才設計的權限矩陣]

## 主要功能

### 1. 訂單管理
- 列表顯示所有訂單（依權限過濾）
- 可以篩選：訂單狀態、日期範圍、客戶名稱
- 點擊訂單可以看詳細資訊
- 管理員可以修改訂單狀態（待處理→處理中→已出貨→已完成）

### 2. 商品管理（僅管理員）
- 新增商品（名稱、價格、庫存）
- 編輯商品資訊
- 下架商品（不刪除，只是不顯示）

### 3. 使用者管理（僅超級管理員）
- 查看所有使用者列表
- 修改使用者角色
- 停用/啟用帳號

## 介面需求
- 左側選單（依角色顯示不同選項）
- 上方顯示目前登入者身份
- 每個功能區塊都要檢查權限（沒權限顯示「無權訪問」）

## 技術需求
- 後台使用Streamlit建構（快速開發）
- 資料來自Supabase
- 權限檢查要在每個頁面載入時執行

請生成這個後台管理系統的程式碼。
```

---

### 🎯 可維護性重點：中介層設計

**教學生「不要把邏輯寫死在頁面上」**

#### ❌ 不好的做法：
```python
# 在每個頁面都寫一次權限判斷
if user.role == "admin" or user.role == "super_admin":
    顯示訂單管理頁面
else:
    顯示錯誤訊息
```

**問題**：如果新增角色「運營經理」也能看訂單，要改N個地方

#### ✅ 好的做法：
```markdown
告訴AI：
「請建立一個權限檢查器（permission_checker.py）
- 定義每個角色的權限清單
- 提供函式：can_user_do(user_role, action)
- 所有頁面都呼叫這個檢查器
這樣未來改權限只要改一個檔案」
```

**學生練習：用白話文寫出「中介層」的設計概念**

---

## 📦 模組3：前端儀表板 Lovable（2小時）

### 🔍 第一性原理拆解

**核心知識點：使用者介面設計 (UI/UX)**

```
最根本的問題：
「怎麼讓不懂電腦的人也能輕鬆使用？」

生活類比：
├─ 電梯：只有上下兩個按鈕→簡單明確
├─ 提款機：一步步引導→不會迷路
└─ 自助點餐機：圖片+文字→清楚易懂

軟體中的實現：
資訊階層 + 互動流程 + 視覺引導 = 好用的介面
```

**拆解成3個子問題：**
1. **資訊架構**：「要顯示哪些資訊？怎麼分類？」
2. **互動設計**：「使用者要做哪些操作？順序如何？」
3. **視覺設計**：「怎麼用顏色、排版讓資訊易讀？」

---

### 📐 架構設計：資訊階層圖

**學生練習：畫出頁面結構**

```
前端儀表板結構
│
├─ 📊 首頁（Dashboard）
│   ├─ 本月訂單統計（卡片）
│   ├─ 最近訂單列表（表格）
│   └─ 快速操作按鈕（新增訂單）
│
├─ 📦 我的訂單
│   ├─ 訂單列表（可篩選）
│   │   └─ 點擊→訂單詳情（跳出視窗）
│   └─ 新增訂單按鈕
│
├─ 🛍️ 商品目錄
│   ├─ 商品卡片（網格排列）
│   └─ 點擊→加入訂單
│
└─ 👤 個人資料
    ├─ 基本資料編輯
    └─ 密碼變更
```

**產出文件**：`模組3_資訊架構圖.md`

---

### 💬 給Lovable的Prompt範本

**Lovable特點：用自然語言生成React前端**

```markdown
# 訂單管理前端需求

請幫我建立一個訂單管理系統的客戶端介面：

## 整體風格
- 乾淨簡約的設計
- 主色調：藍色（專業感）
- 適合桌機和手機使用（響應式）

## 頁面1：首頁Dashboard

**上半部：統計卡片**
並排顯示3個卡片：
- 本月訂單數（數字大大的）
- 待處理訂單（黃色標示）
- 本月總金額（綠色標示）

**下半部：最近訂單**
顯示最近5筆訂單的表格：
欄位：訂單編號、日期、金額、狀態
狀態用標籤顯示（待處理=黃色、已完成=綠色）

## 頁面2：訂單列表

**上方：篩選器**
- 日期範圍選擇器
- 狀態下拉選單（全部/待處理/處理中/已完成）
- 搜尋框（輸入訂單編號）

**主要內容：訂單表格**
顯示欄位：訂單編號、日期、商品、數量、金額、狀態
點擊某一行 → 跳出詳細視窗

**詳細視窗內容：**
- 訂單基本資訊
- 商品明細表格
- 配送資訊
- 如果是「待處理」狀態，顯示「取消訂單」按鈕

## 頁面3：新增訂單

**表單內容：**
1. 選擇商品（下拉選單）
2. 輸入數量
3. 填寫配送地址
4. 填寫備註（選填）
5. 送出按鈕（藍色、大按鈕）

送出後→顯示「訂單已建立！」，並跳轉回訂單列表

## 導航列
固定在頂端，包含：
- Logo（左側）
- 選單：首頁、我的訂單、新增訂單、個人資料
- 登出按鈕（右側）

## 資料來源
暫時使用假資料（mock data），之後會接Supabase API

請生成這個前端專案的程式碼。
```

**學生練習：**
1. 把Prompt貼到Lovable
2. 看生成的介面
3. 根據結果調整Prompt（例如：「首頁卡片太小，請放大1.5倍」）

**產出文件**：`模組3_Lovable開發紀錄.md`

---

### 🎯 可維護性重點：元件化思維

**教學生「重複的東西要做成元件」**

```
當你發現「訂單卡片」在3個地方出現：
1. 首頁的最近訂單
2. 訂單列表頁
3. 搜尋結果頁

告訴AI：
「請建立一個OrderCard元件，可以重複使用
輸入：訂單物件
輸出：顯示訂單編號、日期、狀態的卡片
然後在3個頁面引用這個元件」

好處：未來要改卡片樣式，只改一個地方
```

---

## 📦 模組4：雲端資料庫 Supabase（2小時）

### 🔍 第一性原理拆解

**核心知識點：資料建模 (Data Modeling)**

```
最根本的問題：
「現實世界的東西，怎麼存進電腦？」

生活類比：
├─ 圖書館書架：書分類擺放→資料表分類
├─ 書的借閱卡：記錄誰借了什麼→關聯資料
└─ 書目索引：快速找書→資料庫索引

軟體中的實現：
實體(Entity) + 屬性(Attribute) + 關係(Relationship) = 資料模型
```

**拆解成3個子問題：**
1. **實體識別**：「系統要存哪些『東西』？」
2. **屬性定義**：「每個『東西』有哪些特徵？」
3. **關係建立**：「『東西』之間如何連結？」

---

### 📐 架構設計：ER圖（實體關係圖）

**用視覺化方式教學生設計資料庫**

```
┌──────────────┐         ┌──────────────┐         ┌──────────────┐
│   使用者     │         │    訂單      │         │    商品      │
├──────────────┤         ├──────────────┤         ├──────────────┤
│ id (PK)      │1       ∞│ id (PK)      │        ∞│ id (PK)      │
│ username     ├─────────│ user_id (FK) │         │ name         │
│ email        │  下     │ order_date   │         │ price        │
│ role         │         │ status       │         │ stock        │
│ created_at   │         │ total_amount │         │ category     │
└──────────────┘         └──────┬───────┘         └──────┬───────┘
                                │                        │
                                │                        │
                                │ ∞                     1│
                                │                        │
                         ┌──────┴────────┐              │
                         │  訂單明細     │              │
                         ├───────────────┤              │
                         │ id (PK)       │              │
                         │ order_id (FK) ├──────────────┘
                         │ product_id (FK)              
                         │ quantity      │              
                         │ price         │              
                         └───────────────┘              

符號說明：
PK = Primary Key (主鍵，唯一識別)
FK = Foreign Key (外鍵，關聯到其他表)
1 = 一對一 or 一
∞ = 一對多 or 多
```

**學生練習：用便利貼設計資料庫**

1. **步驟1：找出實體（名詞）**
   - 拿出便利貼，每張寫一個「東西」
   - 例如：訂單、商品、使用者、類別

2. **步驟2：定義屬性**
   - 每個實體下方列出屬性
   - 訂單：編號、日期、金額、狀態

3. **步驟3：畫出關係線**
   - 用線連接有關係的實體
   - 一個使用者有多個訂單 → 畫線，標註「1對多」

**產出文件**：`模組4_資料表設計.md`

---

### 💬 給Supabase的建表Prompt

```markdown
# Supabase資料庫結構設計

我需要為訂單管理系統建立資料庫，請幫我產生Supabase的SQL建表語法。

## 表1：使用者表 (users)

**欄位：**
- id：UUID，主鍵，自動產生
- username：文字，唯一，不能為空
- email：文字，唯一，不能為空
- password_hash：文字，不能為空
- role：文字，預設值'customer'，可選值(customer/admin/super_admin)
- created_at：時間戳記，預設當前時間

**索引：**
- username（加快查詢）
- email（加快查詢）

## 表2：商品表 (products)

**欄位：**
- id：UUID，主鍵
- name：文字，不能為空
- description：文字，可為空
- price：數字（小數點2位）
- stock：整數，預設0
- category：文字
- is_active：布林值，預設true（是否上架）
- created_at：時間戳記

## 表3：訂單表 (orders)

**欄位：**
- id：UUID，主鍵
- order_number：文字，唯一（格式：ORD-20250101-001）
- user_id：UUID，外鍵連接users.id
- order_date：時間戳記，預設當前時間
- status：文字，預設'pending'，可選值(pending/processing/shipped/completed/cancelled)
- total_amount：數字（小數點2位）
- delivery_address：文字
- notes：文字，可為空

**外鍵約束：**
- user_id → users.id（刪除使用者時訂單設為NULL）

## 表4：訂單明細表 (order_items)

**欄位：**
- id：UUID，主鍵
- order_id：UUID，外鍵連接orders.id
- product_id：UUID，外鍵連接products.id
- quantity：整數，不能為空
- unit_price：數字（小數點2位）
- subtotal：數字（小數點2位）

**外鍵約束：**
- order_id → orders.id（刪除訂單時一起刪除明細）
- product_id → products.id（刪除商品時明細保留但標記）

請產生建立這些表的SQL語法，並加上適當的註解。
```

**學生練習：**
把生成的SQL貼到Supabase執行，確認表建立成功

**產出文件**：`模組4_建表SQL.sql` + `模組4_資料字典.md`

---

### 🎯 可維護性重點：資料完整性

**教學生「資料庫設計要防止錯誤資料」**

| 設計原則 | 範例 | 用白話文告訴AI |
|---------|------|---------------|
| **非空約束** | email不能是空的 | 「email欄位設為NOT NULL」 |
| **唯一約束** | 帳號不能重複 | 「username要有UNIQUE約束」 |
| **預設值** | 訂單狀態預設「待處理」 | 「status欄位預設值'pending'」 |
| **外鍵約束** | 訂單要對應到真實使用者 | 「user_id要連到users表的id」 |
| **檢查約束** | 數量不能是負數 | 「quantity欄位加CHECK約束 >= 0」 |

---

## 📦 模組5：Google Sheet整合（2小時）

### 🔍 第一性原理拆解

**核心知識點：API整合 (API Integration)**

```
最根本的問題：
「怎麼讓兩個不同的系統互相傳資料？」

生活類比：
├─ 郵局：寄信到指定地址→API呼叫
├─ 自動販賣機：投幣→取貨→API請求與回應
└─ 餐廳外送：下單→店家收單→外送員送達→多系統協作

軟體中的實現：
請求(Request) + 回應(Response) + 資料格式(JSON) = API溝通
```

**拆解成3個子問題：**
1. **認證授權**：「怎麼證明我有權限操作別人的系統？」
2. **資料轉換**：「我的資料格式跟對方的一樣嗎？」
3. **錯誤處理**：「如果對方系統掛了怎麼辦？」

---

### 📐 架構設計：整合流程圖

```
訂單系統 → Google Sheet 整合流程

觸發點：每週五晚上12點 (定時任務)
│
├─ 步驟1：從資料庫抓取本週訂單
│   └─ SELECT * FROM orders WHERE order_date >= '本週一'
│
├─ 步驟2：資料整理（轉換格式）
│   ├─ 原始資料：JSON格式
│   └─ 轉換成：表格行列格式
│
├─ 步驟3：連接Google Sheet API
│   ├─ 認證：使用服務帳號金鑰
│   └─ 取得試算表ID
│
├─ 步驟4：寫入資料
│   ├─ 清空舊資料（或新增分頁）
│   ├─ 寫入表頭：訂單編號、日期、客戶、金額、狀態
│   └─ 逐行寫入訂單資料
│
└─ 步驟5：通知完成
    └─ 寄信給會計：「本週報表已更新」
```

**學生練習：畫出自己的整合流程**

**產出文件**：`模組5_整合流程圖.md`

---

### 💬 Vibe Prompt範例

```markdown
# Google Sheet 整合需求

## 目標
每週自動將訂單資料匯出到Google Sheet，方便會計對帳。

## 資料來源
從Supabase的orders和order_items表抓取資料。

## 目標試算表
- Google Sheet名稱：「訂單週報表」
- Sheet ID：1234567890abcdef（請用這個ID）

## 試算表格式

**工作表1：本週訂單摘要**
欄位：
- A欄：訂單編號
- B欄：訂單日期
- C欄：客戶名稱
- D欄：商品清單（多項商品用逗號分隔）
- E欄：訂單金額
- F欄：訂單狀態

**工作表2：統計資訊**
- 總訂單數
- 總金額
- 各狀態訂單數量（待處理、已完成...）

## 執行時機
每週五晚上11:50執行（使用排程器）

## 認證方式
使用Google Service Account認證
金鑰檔案路徑：./config/google-credentials.json

## 流程
1. 查詢本週訂單（星期一00:00至星期日23:59）
2. 轉換成試算表格式
3. 清空「本週訂單摘要」工作表的舊資料
4. 寫入新資料
5. 更新「統計資訊」工作表
6. 發送email通知：「本週報表已更新，共X筆訂單」

## 錯誤處理
- 如果連不上Google API → 重試3次，失敗則寄信通知管理員
- 如果沒有訂單 → 依然建立試算表，顯示「本週無訂單」

請幫我生成這個整合程式的Python程式碼。
```

**學生練習：**
1. 先手動在Google Sheet建立試算表
2. 取得試算表ID
3. 設定服務帳號權限
4. 執行程式看結果

**產出文件**：`模組5_API整合文件.md`

---

### 🎯 可維護性重點：容錯機制

**教學生「外部系統不可靠，要做好備案」**

```
告訴AI加入容錯機制：

「請在程式中加入以下處理：

1. 連線逾時處理
   - 如果10秒內沒回應→重試
   - 重試3次都失敗→記錄錯誤，寄信通知

2. 資料驗證
   - 匯出前檢查資料是否完整
   - 如果金額欄位有空值→填0

3. 本地備份
   - 除了寫入Google Sheet，也存一份CSV在本地
   - 檔名：weekly_report_20250110.csv

4. 執行日誌
   - 每次執行記錄：時間、筆數、是否成功
   - 日誌存在：./logs/sheet_sync.log」
```

---

## 📦 模組6：CRM客戶管理系統（2.5小時）

### 🔍 第一性原理拆解

**核心知識點：業務邏輯設計 (Business Logic)**

```
最根本的問題：
「怎麼追蹤客戶的狀態，提供更好的服務？」

生活類比：
├─ 診所病歷：記錄就診歷史→了解病情
├─ 銀行客戶分級：VIP、一般客戶→不同服務
└─ 店員記熟客：這個客人喜歡什麼→客製服務

軟體中的實現：
客戶資料 + 互動紀錄 + 狀態追蹤 = CRM系統
```

**拆解成4個子問題：**
1. **客戶分類**：「怎麼把客戶分群？」
2. **互動記錄**：「要記錄哪些互動？」
3. **狀態追蹤**：「客戶處於銷售漏斗的哪個階段？」
4. **自動提醒**：「什麼時候該主動聯繫客戶？」

---

### 📐 架構設計：客戶生命週期

```
客戶旅程地圖（Customer Journey）

┌────────┐    ┌────────┐    ┌────────┐    ┌────────┐    ┌────────┐
│ 潛在   │ →  │ 初次   │ →  │ 活躍   │ →  │ 忠誠   │ →  │ 流失   │
│ 客戶   │    │ 購買   │    │ 客戶   │    │ 客戶   │    │ 客戶   │
│(Lead)  │    │(New)   │    │(Active)│    │(Loyal) │    │(Churn) │
└────────┘    └────────┘    └────────┘    └────────┘    └────────┘
    │             │             │             │             │
    ↓             ↓             ↓             ↓             ↓
詢價階段      首購階段      回購階段      VIP階段       未購買>6個月
- 電話詢問    - 訂單筆數1  - 訂單筆數2-5 - 訂單筆數>5   - 6個月沒下單
- 索取報價    - 未滿3個月  - 3-12個月    - 超過1年     - 需要關懷
- 尚未下單                  - 穩定回購    - 大額消費
```

**CRM要記錄的資料結構**

```
客戶檔案 (customers)
├─ 基本資料
│   ├─ 公司名稱
│   ├─ 聯絡人
│   ├─ 電話/Email
│   └─ 地址
│
├─ 分類標籤
│   ├─ 客戶等級：A/B/C級
│   ├─ 產業別：餐飲/零售/製造
│   └─ 來源：廣告/轉介/展會
│
├─ 銷售狀態
│   ├─ 目前階段：潛在→新客→活躍→忠誠
│   ├─ 負責業務：誰在跟
│   └─ 下次聯繫日期
│
└─ 統計數據
    ├─ 累計訂單數
    ├─ 累計金額
    ├─ 最近訂單日期
    └─ 客戶價值評分

互動紀錄 (interactions)
├─ 時間戳記
├─ 互動類型：電話/Email/拜訪/訂單
├─ 內容摘要
├─ 下一步行動
└─ 記錄者
```

**學生練習：設計自己的CRM資料結構**

**產出文件**：`模組6_CRM資料模型.md`

---

### 💬 Vibe Prompt範例

```markdown
# CRM客戶管理系統需求

## 系統目標
追蹤客戶從「潛在客戶」到「忠誠客戶」的完整旅程，幫助業務團隊提供更好的服務。

## 核心功能

### 1. 客戶檔案管理

**客戶列表頁**
- 顯示所有客戶，可依狀態篩選（潛在/新客/活躍/忠誠/流失）
- 顯示欄位：公司名稱、聯絡人、客戶等級、累計訂單、最近訂單日期
- 可依「最近訂單日期」排序，越久沒下單的排前面

**客戶詳情頁**
分成4個區塊：

**區塊1：基本資料卡**
- 公司名稱、聯絡人、電話、Email、地址
- 可編輯按鈕

**區塊2：客戶標籤**
- 客戶等級（A/B/C）用顏色標示（A=金色、B=銀色、C=灰色）
- 產業別
- 客戶來源
- 可新增自訂標籤

**區塊3：統計儀表板**
- 累計訂單數（大字顯示）
- 累計金額（大字顯示）
- 最近訂單日期
- 平均訂單金額
- 訂單趨勢圖（最近6個月）

**區塊4：訂單歷史**
- 列出所有訂單（可展開看明細）

### 2. 互動紀錄

**新增互動記錄**
- 選擇類型：電話、Email、拜訪、其他
- 時間（預設當前時間）
- 互動內容（文字框）
- 下一步行動（選填）
- 下次聯繫日期（選填）

**互動歷史時間軸**
- 按時間倒序顯示
- 不同類型用不同圖示（電話=📞、Email=📧、拜訪=🤝）

### 3. 待辦提醒

**提醒列表**
自動產生以下提醒：
- 「客戶X已經3個月沒下單，建議關懷」
- 「今天要聯繫客戶Y」（根據「下次聯繫日期」）
- 「客戶Z昨天下了大單，建議致謝」

提醒可以「標記完成」或「延後」

### 4. 客戶等級自動評分

**評分規則：**
A級客戶：
- 累計訂單金額 > 50萬
- 或 訂單筆數 > 20筆
- 或 最近訂單在1個月內

B級客戶：
- 累計訂單金額 10-50萬
- 或 訂單筆數 5-20筆
- 或 最近訂單在3個月內

C級客戶：其他

每天凌晨自動重新計算所有客戶等級。

## 資料來源
- 客戶基本資料：customers表
- 訂單資料：來自orders表（用user_id關聯）
- 互動紀錄：interactions表

## 技術需求
- 後端：Python + Supabase
- 前端：可用Streamlit或Lovable
- 自動評分：使用排程器每天執行

請幫我生成這個CRM系統的程式碼。
```

**學生練習：**
1. 理解業務邏輯（客戶分級規則）
2. 設計資料表（customers + interactions）
3. 用Prompt請AI實作

**產出文件**：`模組6_業務邏輯文件.md`

---

### 🎯 可維護性重點：規則引擎設計

**教學生「業務規則會變，要設計成可調整的」**

```
不好的做法：把規則寫死在程式碼裡
if total_amount > 500000:
    level = "A"

好的做法：規則存在設定檔

告訴AI：
「請建立一個config.json存放評分規則：
{
  "scoring_rules": {
    "A_level": {
      "min_amount": 500000,
      "min_orders": 20,
      "recent_days": 30
    },
    "B_level": {
      "min_amount": 100000,
      "min_orders": 5,
      "recent_days": 90
    }
  }
}

程式碼要從這個檔案讀取規則，這樣未來改規則不用動程式碼」
```

**產出文件**：`模組6_規則設定檔.json`

---

## 🧩 第三階段：系統整合（2小時）

### 📍 活動1：積木組裝（60分鐘）

**完整的資料流串接**

```
完整流程：客戶下單 → 訂單處理 → CRM更新 → 週報產生

步驟1：確認各模組獨立運作正常
- [ ] 模組1：能註冊、登入
- [ ] 模組2：後台能看訂單
- [ ] 模組3：前端能下單
- [ ] 模組4：資料庫有資料
- [ ] 模組5：能匯出Google Sheet
- [ ] 模組6：CRM能顯示客戶

步驟2：串接前端與後端
- 前端(Lovable) → API → 後端(Python)
- 測試：前端下單，後端資料庫有沒有記錄

步驟3：串接訂單與CRM
- 新訂單建立 → 自動更新客戶統計
- 測試：下單後CRM的「最近訂單日期」有更新

步驟4：串接定時任務
- 設定排程：每週五匯出Google Sheet
- 測試：手動觸發，確認試算表有更新
```

**學生練習：**
對照整合清單，逐項串接並測試

**產出文件**：`整合測試報告.md`

---

### 📍 活動2：壓力測試（30分鐘）

**測試系統在異常情況的表現**

| 測試案例 | 操作步驟 | 預期結果 | 實際結果 |
|---------|---------|---------|---------|
| 重複下單 | 連續按3次下單按鈕 | 只建立1筆訂單 | _待測試_ |
| 錯誤資料 | 訂單金額輸入負數 | 顯示錯誤訊息 | _待測試_ |
| 權限越界 | 一般客戶嘗試訪問後台 | 拒絕訪問 | _待測試_ |
| API失效 | Google Sheet API無回應 | 顯示提示，但不影響下單 | _待測試_ |
| 大量資料 | 一次匯出1000筆訂單 | 能順利完成（可能較慢） | _待測試_ |

**學生練習：**
每組選3個案例測試，記錄結果

**產出文件**：`壓力測試報告.md`

---

### 📍 活動3：費曼學習法應用（30分鐘）

**用「教別人」的方式鞏固學習**

#### 步驟1：選擇一個模組
每個學生選一個最有把握的模組

#### 步驟2：5分鐘簡報
用白板或投影片，向其他同學解釋：
1. 這個模組在解決什麼問題？
2. 核心概念是什麼？
3. 資料怎麼流動？
4. 如果要擴展，可以怎麼做？

#### 步驟3：回答提問
其他同學可以提問，講者要能回答

#### 步驟4：反思改進
- 哪些地方解釋得不清楚？
- 回去補強文件

**產出文件**：`模組X_費曼學習筆記.md`

---

## 📚 文件化最佳實踐

### 完整專案文件結構

```
📁 OrderFlow專案文件/
│
├─ 📄 README.md（專案總覽）
│   ├─ 專案簡介
│   ├─ 系統架構圖
│   ├─ 模組清單
│   └─ 快速開始指南
│
├─ 📁 01_需求分析/
│   ├─ 使用者旅程地圖.md
│   ├─ 功能需求清單.md
│   └─ 非功能需求.md
│
├─ 📁 02_系統設計/
│   ├─ 整體架構圖.png
│   ├─ 資料流程圖.md
│   ├─ 模組依賴關係.md
│   └─ 資料庫ER圖.png
│
├─ 📁 03_模組文件/
│   ├─ 模組1_會員登入/
│   │   ├─ 架構設計.md
│   │   ├─ 開發Prompt.md
│   │   ├─ 測試報告.md
│   │   └─ API文件.md
│   ├─ 模組2_後台管理/
│   ├─ 模組3_前端儀表板/
│   ├─ 模組4_資料庫/
│   ├─ 模組5_Google整合/
│   └─ 模組6_CRM系統/
│
├─ 📁 04_開發紀錄/
│   ├─ 開發日誌.md（每天記錄進度）
│   ├─ 問題追蹤.md（遇到的問題與解法）
│   └─ AI對話紀錄/（重要的Prompt對話）
│
├─ 📁 05_測試文件/
│   ├─ 單元測試報告.md
│   ├─ 整合測試報告.md
│   └─ 壓力測試報告.md
│
└─ 📁 06_維運手冊/
    ├─ 部署指南.md
    ├─ 常見問題FAQ.md
    └─ 備份復原流程.md
```

---

## 🎓 課程總時數分配

| 階段 | 內容 | 時數 | 累計 |
|------|------|------|------|
| **第一階段** | 俯瞰全局 | 2hr | 2hr |
| **第二階段** | 模組1：會員登入 | 2.5hr | 4.5hr |
|  | 模組2：後台管理 | 2.5hr | 7hr |
|  | 模組3：前端儀表板 | 2hr | 9hr |
|  | 模組4：雲端資料庫 | 2hr | 11hr |
|  | 模組5：Google整合 | 2hr | 13hr |
|  | 模組6：CRM系統 | 2.5hr | 15.5hr |
| **第三階段** | 系統整合 | 2hr | 17.5hr |
| **彈性時間** | 問題處理、進階討論 | 2.5hr | **20hr** |

**建議安排：**
- 2天密集工作坊（每天10小時）
- 或4個半天（每次5小時）

---

## 🎯 學習成效檢核

### 學生完成課程後應該能：

✅ **思維層面**
- [ ] 用運算思維拆解問題（分解、模式、抽象、演算法）
- [ ] 畫出系統架構圖（不用寫程式碼也能設計系統）
- [ ] 理解資料如何在模組間流動

✅ **技能層面**
- [ ] 寫出結構化的Prompt與AI協作
- [ ] 理解基本的軟體概念（認證、API、資料庫、前後端）
- [ ] 閱讀AI生成的程式碼，理解它在做什麼

✅ **文件層面**
- [ ] 產出完整的專案文件
- [ ] 用圖表清楚表達架構
- [ ] 記錄開發過程供未來參考

✅ **維護層面**
- [ ] 知道如何設計可擴展的系統
- [ ] 理解模組化的好處
- [ ] 能向其他人解釋系統運作

---

## 💡 教學技巧建議

### 1. 多用類比
「資料庫就像圖書館，API就像郵局，認證就像門禁卡」

### 2. 視覺化優先
用白板、便利貼、流程圖，減少文字說明

### 3. 失敗也是學習
「AI生成的程式碼有bug？很好！我們來看錯誤訊息，告訴AI怎麼修正」

### 4. 小步快跑
每個模組先做最簡單的版本能跑，再慢慢加功能

### 5. 鼓勵提問
「沒有笨問題，每個問題都幫助我們把系統想得更清楚」

---

這套課程設計強調：**不寫程式碼，但建構系統思維**。學生離開教室時，帶走的不是一堆看不懂的code，而是**能用自然語言指揮AI，建構完整系統的能力**。

需要我針對任何一個模組產出詳細的教案嗎？或者調整課程時數分配？