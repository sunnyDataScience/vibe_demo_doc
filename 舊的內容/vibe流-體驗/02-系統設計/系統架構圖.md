# 🏗️ 系統架構圖 (C4 Model)：從大局到細節

## 🎯 什麼是 C4 模型？
C4 = Context（環境）、Container（容器）、Component（組件）、Code（程式碼）
就像看地圖一樣：世界地圖 → 國家地圖 → 城市地圖 → 街道地圖

## 📍 Level 1: 系統環境圖 (Context)
**目的**：展示系統在整個生態中的位置

```
                    [用戶]
                      |
            使用Chrome瀏覽器上網
                      |
                      ▼
            ┌─────────────────────┐
            │   智能新聞摘要助手    │ ◄─── 我們要建立的系統
            │   (Chrome插件)      │
            └─────────────────────┘
                      |
        ┌─────────────┼─────────────┐
        |             |             |
        ▼             ▼             ▼
   [新聞網站]    [AI摘要服務]    [語音合成服務]
  (資料來源)    (OpenAI API)   (Google TTS)
```

### 外部系統說明
- **新聞網站**：我們要抓取內容的來源
- **AI摘要服務**：第三方API，生成摘要
- **語音合成服務**：將文字轉換為語音
- **用戶**：最終使用者，透過Chrome瀏覽器使用

## 🏪 Level 2: 容器圖 (Container)
**目的**：展示系統內部的主要組件

```
                [用戶的Chrome瀏覽器]
                        |
                        | HTTPS請求
                        ▼
              ┌─────────────────────┐
              │   Chrome插件前端     │
              │  (HTML/CSS/JS)     │
              └─────────────────────┘
                        |
                        | API呼叫
                        ▼
              ┌─────────────────────┐
              │    後端API服務       │
              │   (Node.js/Python) │
              └─────────────────────┘
                        |
                ┌───────┼───────┐
                |       |       |
                ▼       ▼       ▼
        ┌─────────┐ ┌─────────┐ ┌─────────┐
        │  資料庫  │ │ 排程器  │ │檔案儲存 │
        │(SQLite) │ │(Cron)  │ │(本地)  │
        └─────────┘ └─────────┘ └─────────┘
```

### 容器職責說明
1. **Chrome插件前端**：用戶介面和互動
2. **後端API服務**：業務邏輯處理
3. **資料庫**：用戶設定和歷史記錄
4. **排程器**：定時任務執行
5. **檔案儲存**：語音檔案和快取

## 🔧 Level 3: 組件圖 (Component)
**目的**：展示容器內部的組件結構

### Chrome插件前端組件
```
┌─────────────────────────────────────────┐
│              Chrome插件前端              │
├─────────────────────────────────────────┤
│                                         │
│  ┌─────────────┐  ┌─────────────┐      │
│  │  設定管理    │  │  結果展示    │      │
│  │  組件       │  │  組件       │      │
│  └─────────────┘  └─────────────┘      │
│          │                │            │
│          └────────┬───────┘            │
│                   │                    │
│  ┌─────────────┐  │  ┌─────────────┐   │
│  │ API通訊管理  │◄─┴─►│  狀態管理    │   │
│  │ 組件        │     │  組件       │   │
│  └─────────────┘     └─────────────┘   │
│                                         │
└─────────────────────────────────────────┘
```

### 後端API服務組件
```
┌─────────────────────────────────────────┐
│             後端API服務                  │
├─────────────────────────────────────────┤
│                                         │
│ ┌─────────────┐    ┌─────────────┐     │
│ │  API路由     │    │  用戶管理    │     │
│ │  控制器      │◄──►│  服務       │     │
│ └─────────────┘    └─────────────┘     │
│         │                              │
│         ▼                              │
│ ┌─────────────┐    ┌─────────────┐     │
│ │ 新聞抓取     │    │ AI摘要       │     │
│ │ 服務        │◄──►│ 服務        │     │
│ └─────────────┘    └─────────────┘     │
│         │                  │           │
│         ▼                  ▼           │
│ ┌─────────────┐    ┌─────────────┐     │
│ │ 排程管理     │    │ 語音合成     │     │
│ │ 服務        │    │ 服務        │     │
│ └─────────────┘    └─────────────┘     │
│                                         │
└─────────────────────────────────────────┘
```

## 🔄 資料流程設計

### 用戶發起摘要流程
```
1. [用戶] 在插件中輸入設定
   ↓
2. [前端] 驗證輸入並呼叫API
   ↓
3. [API控制器] 接收請求，轉發給相應服務
   ↓
4. [新聞抓取服務] 從網址抓取內容
   ↓
5. [AI摘要服務] 生成摘要文字
   ↓
6. [語音合成服務] 生成語音檔案
   ↓
7. [資料庫] 儲存結果
   ↓
8. [前端] 展示摘要結果給用戶
```

### 排程自動執行流程
```
1. [排程器] 定時檢查待執行任務
   ↓
2. [排程管理服務] 取得任務清單
   ↓
3. [新聞抓取服務] 批量處理網址
   ↓
4. [AI摘要服務] 批量生成摘要
   ↓
5. [語音合成服務] 批量生成語音
   ↓
6. [通知服務] 通知用戶結果就緒
```

## 🔗 介面設計 (API Contract)

### 核心API端點
```
POST /api/summary/create
功能：創建新的摘要任務
輸入：{
  urls: ["url1", "url2"],
  prompt: "用商業角度分析",
  schedule: {
    type: "weekly",
    time: "09:00",
    timezone: "Asia/Taipei"
  }
}
輸出：{
  taskId: "task_123",
  status: "pending"
}

GET /api/summary/{taskId}
功能：獲取摘要結果
輸出：{
  taskId: "task_123",
  status: "completed",
  summary: "摘要內容...",
  audioUrl: "/audio/task_123.mp3",
  references: [...]
}

GET /api/user/preferences
功能：獲取用戶偏好設定
輸出：{
  summaryStyle: "business",
  language: "zh-TW",
  audioSpeed: "normal"
}
```

## 📊 技術選型說明

### 前端技術
- **HTML/CSS/JavaScript**：Chrome插件標準技術
- **框架**：Vanilla JS（輕量化，快速載入）
- **UI庫**：考慮使用Tailwind CSS（樣式一致性）

### 後端技術
- **主要語言**：Node.js（JavaScript生態豐富）
- **框架**：Express.js（輕量、靈活）
- **資料庫**：SQLite（簡單、無需額外安裝）

### 外部服務
- **AI摘要**：OpenAI GPT API
- **語音合成**：Google Text-to-Speech
- **網頁抓取**：Puppeteer（處理動態內容）

## 🛡️ 安全性考量

### 資料安全
- 用戶設定加密儲存
- API使用HTTPS加密傳輸
- 定期清理敏感資料

### 系統安全
- API速率限制防止濫用
- 輸入驗證防止注入攻擊
- 錯誤處理不洩露系統資訊

## 📈 擴展性設計

### 水平擴展
- API服務可部署多個實例
- 使用負載均衡器分散請求
- 資料庫支援讀寫分離

### 功能擴展
- 插件介面支援多語言
- 摘要引擎支援多種AI模型
- 輸出格式易於新增類型

---
*好的架構設計讓系統既穩定又有彈性，就像建築的鋼骨結構一樣！*