# 🔄 流程設計圖 (UML)：用戶操作和系統流程

## 🎯 什麼是UML流程圖？
UML (Unified Modeling Language) 是一種標準化的圖形語言，用來描述系統的行為和互動。就像交通標誌一樣，讓所有人都能看懂系統是如何運作的。

## 📋 流程圖類型說明

### 🎭 使用案例圖 (Use Case Diagram)
**目的**：展示系統功能和使用者的關係

```
                   智能新聞摘要系統
                 ┌─────────────────────┐
     [用戶]      │                     │
        │        │  ◯ 創建摘要任務      │
        ├────────┤                     │
        │        │  ◯ 設定個人偏好      │
        ├────────┤                     │
        │        │  ◯ 查看摘要結果      │
        ├────────┤                     │
        │        │  ◯ 播放語音摘要      │
        ├────────┤                     │
        │        │  ◯ 管理排程設定      │
        └────────┤                     │
                 │                     │
    [系統管理員]  │  ◯ 監控系統狀態      │
        ├────────┤                     │
        │        │  ◯ 管理用戶資料      │
        └────────┤                     │
                 └─────────────────────┘

外部系統互動：
[AI摘要服務] ──── ◯ 生成文字摘要
[語音合成服務] ── ◯ 生成語音檔案
[新聞網站] ────── ◯ 提供新聞內容
```

### 🔄 活動圖 (Activity Diagram)
**目的**：展示業務流程的執行步驟

#### 用戶創建摘要任務流程
```
開始
  │
  ▼
┌─────────────┐
│ 用戶打開插件 │
└─────────────┘
  │
  ▼
┌─────────────┐
│ 輸入網址清單 │
└─────────────┘
  │
  ▼
┌─────────────┐    否   ┌─────────────┐
│ 網址格式正確？├─────→│ 顯示錯誤訊息 │
└─────────────┘       └─────────────┘
  │ 是                        │
  ▼                          │
┌─────────────┐               │
│ 設定摘要偏好 │               │
└─────────────┘               │
  │                          │
  ▼                          │
┌─────────────┐               │
│ 選擇執行方式 │               │
└─────────────┘               │
  │                          │
  ├─現在執行──┐                │
  │          │                │
  │          ▼                │
  │    ┌─────────────┐         │
  │    │ 立即處理任務 │         │
  │    └─────────────┘         │
  │          │                │
  └─排程執行──┤                │
            │                │
            ▼                │
      ┌─────────────┐         │
      │ 儲存排程設定 │         │
      └─────────────┘         │
            │                │
            ▼                │
      ┌─────────────┐         │
      │ 顯示確認訊息 │◄────────┘
      └─────────────┘
            │
            ▼
          結束
```

#### 系統自動執行排程流程
```
定時觸發
    │
    ▼
┌─────────────┐
│ 檢查待執行   │
│ 排程任務    │
└─────────────┘
    │
    ▼
┌─────────────┐    否   ┌─────────────┐
│ 有待執行任務？├─────→│ 等待下次檢查 │
└─────────────┘       └─────────────┘
    │ 是                        │
    ▼                          │
┌─────────────┐               │
│ 取得任務詳情 │               │
└─────────────┘               │
    │                          │
    ▼                          │
┌─────────────┐               │
│ 抓取網頁內容 │               │
└─────────────┘               │
    │                          │
    ▼                          │
┌─────────────┐    失敗  ┌─────────────┐
│ 內容抓取成功？├─────→│ 記錄錯誤日誌 │
└─────────────┘       └─────────────┘
    │ 成功                       │
    ▼                          │
┌─────────────┐               │
│ 呼叫AI服務   │               │
│ 生成摘要    │               │
└─────────────┘               │
    │                          │
    ▼                          │
┌─────────────┐    失敗       │
│ 摘要生成成功？├─────────────┘
└─────────────┘
    │ 成功
    ▼
┌─────────────┐
│ 生成語音檔案 │
└─────────────┘
    │
    ▼
┌─────────────┐
│ 儲存處理結果 │
└─────────────┘
    │
    ▼
┌─────────────┐
│ 通知用戶完成 │
└─────────────┘
    │
    ▼
┌─────────────┐
│ 更新任務狀態 │──────────────┐
└─────────────┘             │
    │                       │
    ▼                       │
   結束 ◄────────────────────┘
```

### 📞 序列圖 (Sequence Diagram)
**目的**：展示系統組件之間的互動時序

#### 用戶查看摘要結果的互動流程
```
用戶    插件前端   API服務   資料庫   AI服務   語音服務
 │        │        │        │        │        │
 │─點擊查看→│        │        │        │        │
 │        │─GET請求→│        │        │        │
 │        │        │─查詢─→│        │        │
 │        │        │←結果──│        │        │
 │        │←摘要數據─│        │        │        │
 │←顯示結果─│        │        │        │        │
 │        │        │        │        │        │
 │─點擊播放→│        │        │        │        │
 │        │─音頻請求→│        │        │        │
 │        │        │─檢查─→│        │        │
 │        │        │←狀態──│        │        │
 │        │        │                 │        │
 │        │        │─如果沒有音頻檔案→│        │
 │        │        │                 │─生成語音→│
 │        │        │                 │←音頻檔─│
 │        │        │─儲存─→│        │        │
 │        │        │←確認──│        │        │
 │        │←音頻URL─│        │        │        │
 │←開始播放─│        │        │        │        │
```

#### 排程任務執行的系統互動
```
排程器   任務服務   網頁抓取   AI服務   語音服務   資料庫   通知服務
  │       │        │         │       │         │       │
  │─檢查任務→│        │         │       │         │       │
  │       │─查詢─→│         │       │         │       │
  │       │←任務列表─│         │       │         │       │
  │←待處理─│        │         │       │         │       │
  │       │        │         │       │         │       │
  │─執行任務→│        │         │       │         │       │
  │       │─抓取網頁→│         │       │         │       │
  │       │←網頁內容─│         │       │         │       │
  │       │─生成摘要─────────→│       │         │       │
  │       │←摘要文字──────────│       │         │       │
  │       │─語音合成─────────────────→│         │       │
  │       │←音頻檔案──────────────────│         │       │
  │       │─儲存結果────────────────────────→│       │
  │       │←儲存確認─────────────────────────│       │
  │       │─發送通知──────────────────────────────→│
  │       │←通知確認───────────────────────────────│
  │←完成──│        │         │       │         │       │
```

### 🏛️ 狀態圖 (State Diagram)
**目的**：展示對象在生命週期中的狀態變化

#### 摘要任務的狀態轉換
```
                    ┌─────────────┐
                    │   初始狀態   │
                    │  (Created)  │
                    └─────────────┘
                           │
                    [用戶提交任務]
                           │
                           ▼
                    ┌─────────────┐
                    │   等待執行   │
                    │  (Pending)  │
                    └─────────────┘
                           │
                    [排程器觸發] 或 [立即執行]
                           │
                           ▼
                    ┌─────────────┐
                    │   執行中    │──[超時/錯誤]─┐
                    │(Processing) │             │
                    └─────────────┘             │
                           │                    │
                    [處理成功]                   │
                           │                    │
                           ▼                    ▼
                    ┌─────────────┐      ┌─────────────┐
                    │   已完成    │      │    失敗     │
                    │(Completed)  │      │  (Failed)   │
                    └─────────────┘      └─────────────┘
                           │                    │
                    [用戶重新執行]           [用戶重試]
                           │                    │
                           └────────┬───────────┘
                                   │
                                   ▼
                    ┌─────────────┐
                    │   重新處理   │
                    │(Retrying)   │
                    └─────────────┘
                           │
                    [重新進入處理流程]
                           │
                           ▼
                    (回到Processing狀態)
```

### 🔀 類別圖 (Class Diagram)
**目的**：展示系統中類別之間的關係

```
┌─────────────────────────┐
│         User           │
├─────────────────────────┤
│ + userId: String        │
│ + name: String          │
│ + email: String         │
│ + preferences: Object   │
├─────────────────────────┤
│ + createTask()          │
│ + updatePreferences()   │
│ + viewHistory()         │
└─────────────────────────┘
           │ 1
           │ creates
           │ *
           ▼
┌─────────────────────────┐
│      SummaryTask       │
├─────────────────────────┤
│ + taskId: String        │
│ + userId: String        │
│ + urls: Array<String>   │
│ + prompt: String        │
│ + status: TaskStatus    │
│ + createdAt: DateTime   │
│ + scheduledAt: DateTime │
├─────────────────────────┤
│ + execute()             │
│ + retry()               │
│ + cancel()              │
│ + getResult()           │
└─────────────────────────┘
           │ 1
           │ produces
           │ 1
           ▼
┌─────────────────────────┐
│      TaskResult        │
├─────────────────────────┤
│ + resultId: String      │
│ + taskId: String        │
│ + summaryText: String   │
│ + audioUrl: String      │
│ + references: Array     │
│ + completedAt: DateTime │
├─────────────────────────┤
│ + generateAudio()       │
│ + addReference()        │
└─────────────────────────┘

┌─────────────────────────┐
│    ContentCrawler      │
├─────────────────────────┤
│ + fetchContent()        │
│ + validateUrl()         │
│ + extractArticle()      │
└─────────────────────────┘

┌─────────────────────────┐
│     AIService          │
├─────────────────────────┤
│ + generateSummary()     │
│ + validatePrompt()      │
└─────────────────────────┘

┌─────────────────────────┐
│    VoiceService        │
├─────────────────────────┤
│ + textToSpeech()        │
│ + getAudioUrl()         │
└─────────────────────────┘
```

## 💡 流程設計最佳實務

### 1. 用戶體驗優先
- **預期管理**：清楚告訴用戶處理需要多久時間
- **進度反饋**：顯示處理進度，避免用戶不安
- **錯誤處理**：友善的錯誤訊息和恢復建議

### 2. 系統穩健性
- **超時處理**：設定合理的超時時間
- **重試機制**：自動重試失敗的操作
- **降級方案**：關鍵服務不可用時的備用方案

### 3. 性能優化
- **異步處理**：耗時操作不阻塞用戶界面
- **快取機制**：重複請求使用快取結果
- **批次處理**：合併相似請求減少系統負載

## 🔧 流程驗證檢查清單

### 用戶流程檢查
- [ ] 每個用戶操作都有明確反饋
- [ ] 錯誤情況有適當處理
- [ ] 操作步驟符合用戶習慣
- [ ] 關鍵路徑足夠簡潔

### 系統流程檢查
- [ ] 各組件職責清楚分離
- [ ] 依賴關係明確定義
- [ ] 異常情況有處理機制
- [ ] 性能瓶頸已識別

### 整體架構檢查
- [ ] 流程符合業務需求
- [ ] 技術實現可行
- [ ] 擴展性需求考慮
- [ ] 維護性良好

## 📊 流程監控指標

### 用戶體驗指標
- **任務完成率**：用戶成功完成任務的比例
- **平均完成時間**：從開始到結束的時間
- **錯誤重試次數**：用戶因錯誤重試的頻率

### 系統性能指標
- **處理時間分布**：各階段耗時統計
- **系統可用性**：服務正常運行時間比例
- **錯誤率**：各類錯誤發生的頻率

---
*好的流程設計讓系統運行順暢，用戶使用愉快！*