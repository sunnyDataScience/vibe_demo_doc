# âš¡ æ€§èƒ½å„ªåŒ–æŒ‡å—

## ğŸ¯ å„ªåŒ–ç›®æ¨™
æå‡ç³»çµ±æ•´é«”æ€§èƒ½ï¼Œç¢ºä¿ç”¨æˆ¶ç²å¾—å¿«é€Ÿã€æµæš¢çš„ä½¿ç”¨é«”é©—ï¼ŒåŒæ™‚å„ªåŒ–æœå‹™å™¨è³‡æºä½¿ç”¨æ•ˆç‡ã€‚

---

## ğŸ“Š æ€§èƒ½æŒ‡æ¨™åŸºæº–

### 1. å‰ç«¯æ€§èƒ½æŒ‡æ¨™

#### 1.1 Core Web Vitals
| æŒ‡æ¨™ | èªªæ˜ | è‰¯å¥½æ¨™æº– | éœ€æ”¹é€² | å·® |
|------|------|----------|-------|-----|
| LCP (Largest Contentful Paint) | æœ€å¤§å…§å®¹ç¹ªè£½æ™‚é–“ | â‰¤ 2.5s | 2.5-4.0s | > 4.0s |
| FID (First Input Delay) | é¦–æ¬¡è¼¸å…¥å»¶é² | â‰¤ 100ms | 100-300ms | > 300ms |
| CLS (Cumulative Layout Shift) | ç´¯ç©ä½ˆå±€åç§» | â‰¤ 0.1 | 0.1-0.25 | > 0.25 |

#### 1.2 é¡å¤–é—œéµæŒ‡æ¨™
| æŒ‡æ¨™ | ç›®æ¨™å€¼ | å„ªç§€å€¼ | æ¸¬é‡å·¥å…· |
|------|--------|-------|----------|
| FCP (First Contentful Paint) | < 1.8s | < 1.2s | Lighthouse |
| TTI (Time to Interactive) | < 3.8s | < 2.5s | WebPageTest |
| Speed Index | < 3.4s | < 2.3s | Lighthouse |
| ç¸½é é¢å¤§å° | < 1.6MB | < 1MB | DevTools |

### 2. å¾Œç«¯æ€§èƒ½æŒ‡æ¨™

#### 2.1 éŸ¿æ‡‰æ™‚é–“æ¨™æº–
| æ“ä½œé¡å‹ | ç›®æ¨™éŸ¿æ‡‰æ™‚é–“ | å„ªç§€æ¨™æº– | å¯æ¥å—ä¸Šé™ |
|---------|-------------|----------|------------|
| ç°¡å–®æŸ¥è©¢ | < 200ms | < 100ms | 500ms |
| è¤‡é›œæŸ¥è©¢ | < 800ms | < 400ms | 2s |
| æ•¸æ“šå¯«å…¥ | < 300ms | < 150ms | 1s |
| æ–‡ä»¶ä¸Šå‚³ | < 5s (10MB) | < 2s | 10s |

#### 2.2 ååé‡æŒ‡æ¨™
| å ´æ™¯ | ç›®æ¨™QPS | ä½µç™¼ç”¨æˆ¶ | è³‡æºä½¿ç”¨ç‡ |
|------|---------|----------|------------|
| ä¸€èˆ¬ç€è¦½ | 1000+ | 200+ | CPU < 70% |
| ç™»éŒ„è¨»å†Š | 500+ | 100+ | CPU < 60% |
| æ–‡ä»¶è™•ç† | 100+ | 50+ | CPU < 80% |
| æ•¸æ“šåˆ†æ | 50+ | 20+ | CPU < 90% |

---

## ğŸš€ å‰ç«¯æ€§èƒ½å„ªåŒ–

### 1. è³‡æºå„ªåŒ–ç­–ç•¥

#### 1.1 ç¨‹å¼ç¢¼åˆ†å‰²èˆ‡æ‡¶è¼‰å…¥
**å¯¦æ–½æ–¹æ¡ˆ**
```javascript
// è·¯ç”±ç´šåˆ¥åˆ†å‰²
const Home = lazy(() => import('./pages/Home'));
const Dashboard = lazy(() => import('./pages/Dashboard'));
const Profile = lazy(() => import('./pages/Profile'));

// å…ƒä»¶ç´šåˆ¥åˆ†å‰²
const HeavyComponent = lazy(() =>
  import('./components/HeavyComponent')
);

// ç¬¬ä¸‰æ–¹åº«åˆ†å‰²
const Chart = lazy(() =>
  import('react-chartjs-2').then(module => ({
    default: module.Chart
  }))
);
```

**å„ªåŒ–æ•ˆæœé æœŸ**
- é¦–æ¬¡è¼‰å…¥æ™‚é–“æ¸›å°‘ 40-60%
- éå¿…è¦è³‡æºå»¶é²è¼‰å…¥
- Bundle å¤§å°æ¸›å°‘ 30-50%

#### 1.2 åœ–ç‰‡å„ªåŒ–ç­–ç•¥
| å„ªåŒ–æŠ€è¡“ | æ‡‰ç”¨å ´æ™¯ | é æœŸæ•ˆæœ |
|---------|----------|----------|
| WebPæ ¼å¼ | ç¾ä»£ç€è¦½å™¨ | æª”æ¡ˆå¤§å°æ¸›å°‘ 25-35% |
| éŸ¿æ‡‰å¼åœ–ç‰‡ | ä¸åŒè¨­å‚™å°ºå¯¸ | è¼‰å…¥æ™‚é–“æ¸›å°‘ 20-40% |
| æ‡¶è¼‰å…¥ | é•·é é¢åœ–ç‰‡ | é¦–å±è¼‰å…¥æå‡ 50% |
| CDNåŠ é€Ÿ | å…¨çƒç”¨æˆ¶è¨ªå• | è¼‰å…¥é€Ÿåº¦æå‡ 30-70% |

**å¯¦æ–½ç¯„ä¾‹**
```html
<!-- éŸ¿æ‡‰å¼åœ–ç‰‡ -->
<picture>
  <source srcset="image-800w.webp" media="(max-width: 800px)" type="image/webp">
  <source srcset="image-1200w.webp" media="(max-width: 1200px)" type="image/webp">
  <img src="image-1200w.jpg" alt="æè¿°" loading="lazy">
</picture>

<!-- æ‡¶è¼‰å…¥å¯¦ç¾ -->
<img
  src="placeholder.jpg"
  data-src="actual-image.jpg"
  loading="lazy"
  class="lazy-load">
```

#### 1.3 CSS èˆ‡ JavaScript å„ªåŒ–
**CSS å„ªåŒ–**
```css
/* é—œéµè·¯å¾‘CSSå…§è¯ */
<style>
  /* é¦–å±é—œéµæ¨£å¼ */
  body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; }
  .header { height: 60px; background: #fff; }
</style>

/* éé—œéµCSSç•°æ­¥è¼‰å…¥ */
<link rel="preload" href="non-critical.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
```

**JavaScript å„ªåŒ–**
```javascript
// Tree Shaking
import { debounce } from 'lodash-es'; // åªå°å…¥éœ€è¦çš„å‡½æ•¸

// Service Worker å¿«å–ç­–ç•¥
self.addEventListener('fetch', event => {
  if (event.request.destination === 'script') {
    event.respondWith(
      caches.match(event.request).then(response => {
        return response || fetch(event.request);
      })
    );
  }
});
```

### 2. æ¸²æŸ“æ€§èƒ½å„ªåŒ–

#### 2.1 è™›æ“¬åŒ–é•·åˆ—è¡¨
**å¯¦æ–½æ–¹æ¡ˆ**
```javascript
// React Virtual Scroller
import { FixedSizeList } from 'react-window';

const VirtualizedList = ({ items }) => (
  <FixedSizeList
    height={600}
    itemCount={items.length}
    itemSize={50}
    itemData={items}
  >
    {({ index, style, data }) => (
      <div style={style}>
        {data[index].name}
      </div>
    )}
  </FixedSizeList>
);
```

**æ•ˆæœé æœŸ**
- æ¸²æŸ“1è¬é …ç›®æ™‚é–“å¾ 2s é™è‡³ 200ms
- è¨˜æ†¶é«”ä½¿ç”¨æ¸›å°‘ 80%
- æ»¾å‹•æ€§èƒ½æå‡ 90%

#### 2.2 ç‹€æ…‹ç®¡ç†å„ªåŒ–
**React å„ªåŒ–ç­–ç•¥**
```javascript
// memo é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
const UserCard = memo(({ user, onEdit }) => {
  return (
    <div className="user-card">
      <h3>{user.name}</h3>
      <button onClick={() => onEdit(user.id)}>ç·¨è¼¯</button>
    </div>
  );
});

// useMemo å¿«å–è¨ˆç®—çµæœ
const ExpensiveComponent = ({ data }) => {
  const processedData = useMemo(() => {
    return data.map(item => ({
      ...item,
      computed: heavyCalculation(item)
    }));
  }, [data]);

  return <div>{/* ä½¿ç”¨ processedData */}</div>;
};

// useCallback å¿«å–å‡½æ•¸
const ParentComponent = () => {
  const [count, setCount] = useState(0);

  const handleClick = useCallback((id) => {
    // è™•ç†é»æ“Šé‚è¼¯
  }, []);

  return <ChildComponent onClick={handleClick} />;
};
```

### 3. ç¶²è·¯æ€§èƒ½å„ªåŒ–

#### 3.1 HTTP/2 å’Œè³‡æºæç¤º
**å¯¦æ–½ç­–ç•¥**
```html
<!-- DNS é è§£æ -->
<link rel="dns-prefetch" href="//api.example.com">

<!-- é é€£æ¥ -->
<link rel="preconnect" href="//fonts.googleapis.com" crossorigin>

<!-- è³‡æºé è¼‰å…¥ -->
<link rel="preload" href="/critical.css" as="style">
<link rel="preload" href="/hero-image.webp" as="image">

<!-- é å–ä¸‹å€‹é é¢è³‡æº -->
<link rel="prefetch" href="/next-page-bundle.js">
```

#### 3.2 API å„ªåŒ–ç­–ç•¥
**è«‹æ±‚å„ªåŒ–**
```javascript
// è«‹æ±‚åˆä½µ
const batchRequests = async (requests) => {
  const batchedData = await fetch('/api/batch', {
    method: 'POST',
    body: JSON.stringify({ requests })
  });
  return batchedData.json();
};

// è«‹æ±‚å¿«å–
const cache = new Map();
const cachedFetch = async (url, options = {}) => {
  const key = `${url}-${JSON.stringify(options)}`;

  if (cache.has(key)) {
    return cache.get(key);
  }

  const response = await fetch(url, options);
  const data = await response.json();
  cache.set(key, data);

  return data;
};

// è«‹æ±‚é˜²æŠ–
const debouncedSearch = debounce(async (query) => {
  const results = await searchAPI(query);
  setSearchResults(results);
}, 300);
```

---

## ğŸ”§ å¾Œç«¯æ€§èƒ½å„ªåŒ–

### 1. æ•¸æ“šåº«å„ªåŒ–

#### 1.1 æŸ¥è©¢å„ªåŒ–ç­–ç•¥
**ç´¢å¼•è¨­è¨ˆ**
```sql
-- è¤‡åˆç´¢å¼•è¨­è¨ˆ
CREATE INDEX idx_user_status_created ON users (status, created_at);
CREATE INDEX idx_order_user_date ON orders (user_id, order_date DESC);

-- éƒ¨åˆ†ç´¢å¼•
CREATE INDEX idx_active_users ON users (email) WHERE status = 'active';

-- è¡¨é”å¼ç´¢å¼•
CREATE INDEX idx_user_search ON users USING gin(to_tsvector('english', name || ' ' || email));
```

**æŸ¥è©¢å„ªåŒ–**
```sql
-- é¿å… N+1 æŸ¥è©¢ï¼Œä½¿ç”¨ JOIN
SELECT u.*, p.* FROM users u
LEFT JOIN profiles p ON u.id = p.user_id
WHERE u.status = 'active';

-- ä½¿ç”¨ LIMIT åˆ†é 
SELECT * FROM posts
WHERE created_at < ?
ORDER BY created_at DESC
LIMIT 20;

-- é¿å… SELECT *
SELECT id, name, email FROM users WHERE status = 'active';
```

#### 1.2 å¿«å–ç­–ç•¥å¯¦æ–½
**Redis å¿«å–å±¤ç´š**
```javascript
// L1: æ‡‰ç”¨ç¨‹å¼è¨˜æ†¶é«”å¿«å–
const appCache = new NodeCache({ stdTTL: 300 }); // 5åˆ†é˜

// L2: Redis åˆ†æ•£å¼å¿«å–
const redisCache = redis.createClient();

// L3: æ•¸æ“šåº«æŸ¥è©¢çµæœå¿«å–
const getCachedUser = async (userId) => {
  // å…ˆæª¢æŸ¥ L1 å¿«å–
  let user = appCache.get(`user:${userId}`);
  if (user) return user;

  // å†æª¢æŸ¥ L2 å¿«å–
  user = await redisCache.get(`user:${userId}`);
  if (user) {
    user = JSON.parse(user);
    appCache.set(`user:${userId}`, user);
    return user;
  }

  // æœ€å¾ŒæŸ¥è©¢æ•¸æ“šåº«
  user = await db.findUser(userId);
  if (user) {
    await redisCache.setex(`user:${userId}`, 3600, JSON.stringify(user));
    appCache.set(`user:${userId}`, user);
  }

  return user;
};
```

**å¿«å–ç­–ç•¥é¸æ“‡**
| å ´æ™¯ | ç­–ç•¥ | TTL | å¤±æ•ˆæ©Ÿåˆ¶ |
|------|------|-----|----------|
| ç”¨æˆ¶è³‡è¨Š | Cache-Aside | 1å°æ™‚ | ç”¨æˆ¶æ›´æ–°æ™‚ä¸»å‹•åˆªé™¤ |
| å•†å“åˆ—è¡¨ | Write-Through | 30åˆ†é˜ | å®šæ™‚åˆ·æ–° |
| ç†±é–€å…§å®¹ | Write-Behind | 24å°æ™‚ | LRUè‡ªå‹•æ·˜æ±° |
| éœæ…‹é…ç½® | Read-Through | æ°¸ä¹… | é…ç½®è®Šæ›´æ™‚æ¸…ç©º |

### 2. æœå‹™å™¨ç«¯å„ªåŒ–

#### 2.1 è² è¼‰å‡è¡¡é…ç½®
**Nginx é…ç½®ç¯„ä¾‹**
```nginx
upstream backend {
    least_conn;
    server 192.168.1.10:3000 weight=3 max_fails=3 fail_timeout=30s;
    server 192.168.1.11:3000 weight=2 max_fails=3 fail_timeout=30s;
    server 192.168.1.12:3000 weight=1 backup;
}

server {
    listen 80;

    # å•Ÿç”¨ gzip å£“ç¸®
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css application/json application/javascript text/xml;

    # éœæ…‹è³‡æºå¿«å–
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # API è«‹æ±‚
    location /api/ {
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_cache api_cache;
        proxy_cache_valid 200 5m;
    }
}
```

#### 2.2 é€£æ¥æ± ç®¡ç†
**æ•¸æ“šåº«é€£æ¥æ± **
```javascript
const mysql = require('mysql2');

const pool = mysql.createPool({
    host: 'localhost',
    user: 'app_user',
    password: 'password',
    database: 'app_db',

    // é€£æ¥æ± è¨­å®š
    connectionLimit: 20,      // æœ€å¤§é€£æ¥æ•¸
    queueLimit: 50,          // æ’éšŠè«‹æ±‚ä¸Šé™
    acquireTimeout: 60000,   // ç²å–é€£æ¥è¶…æ™‚
    timeout: 60000,          // æŸ¥è©¢è¶…æ™‚

    // é€£æ¥ç¶­è­·
    reconnect: true,
    idleTimeout: 300000,     // 5åˆ†é˜é–’ç½®å›æ”¶
    maxAge: 3600000,         // 1å°æ™‚æœ€å¤§å­˜æ´»æ™‚é–“
});

// ç›£æ§é€£æ¥æ± ç‹€æ…‹
setInterval(() => {
    console.log('é€£æ¥æ± ç‹€æ…‹:', {
        ç¸½é€£æ¥æ•¸: pool._allConnections.length,
        ä½¿ç”¨ä¸­: pool._acquiringConnections.length,
        ç©ºé–’ä¸­: pool._freeConnections.length,
        æ’éšŠä¸­: pool._connectionQueue.length
    });
}, 30000);
```

### 3. å¾®æœå‹™æ¶æ§‹å„ªåŒ–

#### 3.1 æœå‹™æ‹†åˆ†ç­–ç•¥
**æŒ‰æ¥­å‹™åŸŸæ‹†åˆ†**
```
ç”¨æˆ¶æœå‹™ (User Service)
â”œâ”€â”€ ç”¨æˆ¶è¨»å†Šç™»éŒ„
â”œâ”€â”€ ç”¨æˆ¶è³‡è¨Šç®¡ç†
â””â”€â”€ ç”¨æˆ¶æ¬Šé™é©—è­‰

è¨‚å–®æœå‹™ (Order Service)
â”œâ”€â”€ è¨‚å–®å‰µå»º
â”œâ”€â”€ è¨‚å–®ç‹€æ…‹è¿½è¹¤
â””â”€â”€ è¨‚å–®æ­·å²æŸ¥è©¢

æ”¯ä»˜æœå‹™ (Payment Service)
â”œâ”€â”€ æ”¯ä»˜è™•ç†
â”œâ”€â”€ é€€æ¬¾ç®¡ç†
â””â”€â”€ è²¡å‹™å°å¸³

é€šçŸ¥æœå‹™ (Notification Service)
â”œâ”€â”€ éƒµä»¶é€šçŸ¥
â”œâ”€â”€ ç°¡è¨Šé€šçŸ¥
â””â”€â”€ æ¨é€é€šçŸ¥
```

#### 3.2 æœå‹™é–“é€šè¨Šå„ªåŒ–
**ç•°æ­¥è™•ç†æ©Ÿåˆ¶**
```javascript
// ä½¿ç”¨è¨Šæ¯ä½‡åˆ—è™•ç†è€—æ™‚ä»»å‹™
const Queue = require('bull');
const emailQueue = new Queue('email processing', redis.port, redis.host);

// ç”Ÿç”¢è€…
const sendWelcomeEmail = async (userId) => {
    await emailQueue.add('welcome email', {
        userId,
        template: 'welcome',
        priority: 'high'
    }, {
        delay: 5000,      // 5ç§’å¾Œè™•ç†
        attempts: 3,      // é‡è©¦3æ¬¡
        backoff: 'exponential'
    });
};

// æ¶ˆè²»è€…
emailQueue.process('welcome email', 5, async (job) => {
    const { userId, template } = job.data;

    // è™•ç†éƒµä»¶ç™¼é€é‚è¼¯
    const user = await getUserById(userId);
    await emailService.send(user.email, template, user);

    return { status: 'sent', userId };
});
```

---

## ğŸ“± ç§»å‹•ç«¯æ€§èƒ½å„ªåŒ–

### 1. React Native å„ªåŒ–

#### 1.1 æ¸²æŸ“æ€§èƒ½å„ªåŒ–
```javascript
// ä½¿ç”¨ FlatList æ›¿ä»£ ScrollView
import { FlatList } from 'react-native';

const OptimizedList = ({ data }) => {
    const renderItem = useCallback(({ item, index }) => (
        <ListItem item={item} index={index} />
    ), []);

    return (
        <FlatList
            data={data}
            renderItem={renderItem}
            keyExtractor={(item) => item.id.toString()}

            // æ€§èƒ½å„ªåŒ–è¨­å®š
            initialNumToRender={10}      // åˆå§‹æ¸²æŸ“é …ç›®æ•¸
            maxToRenderPerBatch={5}      // æ¯æ‰¹æ¸²æŸ“æ•¸é‡
            windowSize={10}              // ç¶­è­·çš„è¦–çª—å¤§å°
            removeClippedSubviews={true} // ç§»é™¤éå¯è¦‹å…ƒç´ 
            getItemLayout={(data, index) => ({
                length: ITEM_HEIGHT,
                offset: ITEM_HEIGHT * index,
                index,
            })}
        />
    );
};
```

#### 1.2 åœ–ç‰‡å’Œè³‡æºå„ªåŒ–
```javascript
// åœ–ç‰‡å¿«å–å’Œå„ªåŒ–
import FastImage from 'react-native-fast-image';

const OptimizedImage = ({ uri, ...props }) => (
    <FastImage
        source={{
            uri,
            priority: FastImage.priority.normal,
            cache: FastImage.cacheControl.immutable
        }}
        resizeMode={FastImage.resizeMode.cover}
        {...props}
    />
);

// è³‡æºé è¼‰å…¥
const preloadImages = async () => {
    const imageUris = ['image1.jpg', 'image2.jpg'];
    await FastImage.preload(imageUris.map(uri => ({ uri })));
};
```

### 2. PWA å„ªåŒ–ç­–ç•¥

#### 2.1 Service Worker å¯¦æ–½
```javascript
// service-worker.js
const CACHE_NAME = 'app-v1.2.0';
const STATIC_CACHE_URLS = [
    '/',
    '/static/js/bundle.js',
    '/static/css/main.css',
    '/manifest.json'
];

// å®‰è£éšæ®µ - é å¿«å–éœæ…‹è³‡æº
self.addEventListener('install', event => {
    event.waitUntil(
        caches.open(CACHE_NAME).then(cache => {
            return cache.addAll(STATIC_CACHE_URLS);
        })
    );
});

// æ””æˆªç¶²è·¯è«‹æ±‚
self.addEventListener('fetch', event => {
    const { request } = event;

    // API è«‹æ±‚ - Network First ç­–ç•¥
    if (request.url.includes('/api/')) {
        event.respondWith(
            fetch(request).catch(() => {
                return caches.match(request);
            })
        );
    }

    // éœæ…‹è³‡æº - Cache First ç­–ç•¥
    else {
        event.respondWith(
            caches.match(request).then(response => {
                return response || fetch(request);
            })
        );
    }
});
```

#### 2.2 App Shell æ¶æ§‹
```javascript
// App Shell è¨­è¨ˆ
const AppShell = () => {
    return (
        <div className="app-shell">
            <Header />
            <Navigation />
            <main className="content">
                <Suspense fallback={<ContentSkeleton />}>
                    <Routes>
                        <Route path="/" element={<Home />} />
                        <Route path="/dashboard" element={<Dashboard />} />
                    </Routes>
                </Suspense>
            </main>
            <Footer />
        </div>
    );
};
```

---

## ğŸ” æ€§èƒ½ç›£æ§èˆ‡æ¸¬é‡

### 1. ç›£æ§æŒ‡æ¨™è¨­ç½®

#### 1.1 å‰ç«¯æ€§èƒ½ç›£æ§
**Real User Monitoring (RUM)**
```javascript
// æ€§èƒ½æ•¸æ“šæ”¶é›†
const collectPerformanceData = () => {
    const navigation = performance.getEntriesByType('navigation')[0];
    const paint = performance.getEntriesByType('paint');

    const metrics = {
        // é é¢è¼‰å…¥æ™‚é–“
        domContentLoaded: navigation.domContentLoadedEventEnd - navigation.navigationStart,
        loadComplete: navigation.loadEventEnd - navigation.navigationStart,

        // Core Web Vitals
        fcp: paint.find(entry => entry.name === 'first-contentful-paint')?.startTime,
        lcp: getLCP(),
        fid: getFID(),
        cls: getCLS(),

        // ç¶²è·¯æ€§èƒ½
        dnsTime: navigation.domainLookupEnd - navigation.domainLookupStart,
        tcpTime: navigation.connectEnd - navigation.connectStart,
        requestTime: navigation.responseStart - navigation.requestStart,
        responseTime: navigation.responseEnd - navigation.responseStart,

        // ç”¨æˆ¶ç’°å¢ƒ
        userAgent: navigator.userAgent,
        connectionType: navigator.connection?.effectiveType,
        pageUrl: window.location.href,
        timestamp: Date.now()
    };

    // ç™¼é€åˆ°åˆ†ææœå‹™
    sendAnalytics('performance', metrics);
};

// é é¢å¸è¼‰æ™‚æ”¶é›†æ•¸æ“š
window.addEventListener('beforeunload', collectPerformanceData);
```

#### 1.2 å¾Œç«¯æ€§èƒ½ç›£æ§
**APM ç›£æ§å¯¦æ–½**
```javascript
const express = require('express');
const promClient = require('prom-client');

// å‰µå»ºç›£æ§æŒ‡æ¨™
const httpRequestDuration = new promClient.Histogram({
    name: 'http_request_duration_seconds',
    help: 'HTTP request duration in seconds',
    labelNames: ['method', 'route', 'status']
});

const httpRequestTotal = new promClient.Counter({
    name: 'http_requests_total',
    help: 'Total number of HTTP requests',
    labelNames: ['method', 'route', 'status']
});

// ä¸­é–“ä»¶æ”¶é›†æŒ‡æ¨™
const metricsMiddleware = (req, res, next) => {
    const startTime = Date.now();

    res.on('finish', () => {
        const duration = (Date.now() - startTime) / 1000;
        const labels = {
            method: req.method,
            route: req.route?.path || req.path,
            status: res.statusCode
        };

        httpRequestDuration.observe(labels, duration);
        httpRequestTotal.inc(labels);
    });

    next();
};

// è‡ªå®šç¾©æ¥­å‹™æŒ‡æ¨™
const activeUsers = new promClient.Gauge({
    name: 'active_users_total',
    help: 'Number of active users'
});

const databaseQueryDuration = new promClient.Histogram({
    name: 'database_query_duration_seconds',
    help: 'Database query duration in seconds',
    labelNames: ['query_type', 'table']
});
```

### 2. æ€§èƒ½æ¸¬è©¦è‡ªå‹•åŒ–

#### 2.1 è² è¼‰æ¸¬è©¦
**K6 æ¸¬è©¦è…³æœ¬**
```javascript
import http from 'k6/http';
import { check, sleep } from 'k6';

export let options = {
    stages: [
        { duration: '2m', target: 10 },   // çˆ¬å‡åˆ°10ç”¨æˆ¶
        { duration: '5m', target: 10 },   // ä¿æŒ10ç”¨æˆ¶
        { duration: '2m', target: 50 },   // çˆ¬å‡åˆ°50ç”¨æˆ¶
        { duration: '5m', target: 50 },   // ä¿æŒ50ç”¨æˆ¶
        { duration: '2m', target: 100 },  // çˆ¬å‡åˆ°100ç”¨æˆ¶
        { duration: '10m', target: 100 }, // ä¿æŒ100ç”¨æˆ¶
        { duration: '2m', target: 0 },    // é™è‡³0ç”¨æˆ¶
    ],
    thresholds: {
        'http_req_duration': ['p(95)<500'],   // 95%è«‹æ±‚<500ms
        'http_req_failed': ['rate<0.1'],      // å¤±æ•—ç‡<10%
    },
};

export default function () {
    // æ¸¬è©¦ä¸»é 
    let response = http.get('https://api.example.com/');
    check(response, {
        'status is 200': (r) => r.status === 200,
        'response time < 500ms': (r) => r.timings.duration < 500,
    });

    // æ¸¬è©¦API
    response = http.post('https://api.example.com/api/users', {
        name: 'Test User',
        email: 'test@example.com'
    });

    check(response, {
        'API status is 201': (r) => r.status === 201,
        'API response time < 800ms': (r) => r.timings.duration < 800,
    });

    sleep(1);
}
```

#### 2.2 CI/CD æ•´åˆæ€§èƒ½æ¸¬è©¦
**GitHub Actions å·¥ä½œæµç¨‹**
```yaml
name: Performance Testing

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  performance-test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Setup Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '16'
        cache: 'npm'

    - name: Install dependencies
      run: npm ci

    - name: Build application
      run: npm run build

    - name: Start application
      run: npm start &

    - name: Wait for application
      run: npx wait-on http://localhost:3000

    - name: Run Lighthouse CI
      run: |
        npm install -g @lhci/cli@0.8.x
        lhci autorun
      env:
        LHCI_GITHUB_APP_TOKEN: ${{ secrets.LHCI_GITHUB_APP_TOKEN }}

    - name: Run load testing
      run: |
        docker run --rm -v $(pwd):/app -w /app loadimpact/k6 run load-test.js

    - name: Performance budget check
      run: npm run perf-budget-check
```

---

## ğŸ“ˆ æ€§èƒ½å„ªåŒ–æª¢æŸ¥æ¸…å–®

### 1. å‰ç«¯å„ªåŒ–æª¢æŸ¥
- [ ] **è³‡æºå„ªåŒ–**
  - [ ] å•Ÿç”¨ gzip/brotli å£“ç¸®
  - [ ] åœ–ç‰‡æ ¼å¼å„ªåŒ– (WebP, AVIF)
  - [ ] åœ–ç‰‡æ‡¶è¼‰å…¥å¯¦æ–½
  - [ ] CSS å’Œ JS ä»£ç¢¼åˆ†å‰²
  - [ ] ç§»é™¤æœªä½¿ç”¨çš„ä»£ç¢¼
  - [ ] å­—é«”å„ªåŒ–å’Œé è¼‰å…¥

- [ ] **å¿«å–ç­–ç•¥**
  - [ ] ç€è¦½å™¨å¿«å–è¨­å®š
  - [ ] Service Worker å¿«å–
  - [ ] CDN é…ç½®
  - [ ] API éŸ¿æ‡‰å¿«å–
  - [ ] éœæ…‹è³‡æºç‰ˆæœ¬æ§åˆ¶

- [ ] **æ¸²æŸ“å„ªåŒ–**
  - [ ] é—œéµ CSS å…§è¯
  - [ ] éé—œéµ CSS ç•°æ­¥è¼‰å…¥
  - [ ] åœ–ç‰‡å°ºå¯¸å’Œæ ¼å¼å„ªåŒ–
  - [ ] DOM æ“ä½œæœ€å°åŒ–
  - [ ] è™›æ“¬æ»¾å‹•å¯¦æ–½

### 2. å¾Œç«¯å„ªåŒ–æª¢æŸ¥
- [ ] **æ•¸æ“šåº«å„ªåŒ–**
  - [ ] æŸ¥è©¢èªå¥å„ªåŒ–
  - [ ] ç´¢å¼•è¨­è¨ˆå’Œç¶­è­·
  - [ ] æ•¸æ“šåº«é€£æ¥æ± é…ç½®
  - [ ] æ…¢æŸ¥è©¢æ—¥èªŒåˆ†æ
  - [ ] æ•¸æ“šåˆ†é å’Œé™åˆ¶

- [ ] **æœå‹™å™¨é…ç½®**
  - [ ] HTTP/2 å•Ÿç”¨
  - [ ] è² è¼‰å‡è¡¡é…ç½®
  - [ ] æœå‹™å™¨å¿«å–è¨­å®š
  - [ ] è³‡æºé™åˆ¶å„ªåŒ–
  - [ ] ç›£æ§å’Œè­¦å ±è¨­ç½®

- [ ] **æ‡‰ç”¨æ¶æ§‹**
  - [ ] å¾®æœå‹™æ‹†åˆ†åˆç†æ€§
  - [ ] ç•°æ­¥è™•ç†å¯¦æ–½
  - [ ] è¨Šæ¯ä½‡åˆ—ä½¿ç”¨
  - [ ] å¿«å–å±¤è¨­è¨ˆ
  - [ ] API è¨­è¨ˆå„ªåŒ–

### 3. éƒ¨ç½²å’Œç›£æ§æª¢æŸ¥
- [ ] **éƒ¨ç½²å„ªåŒ–**
  - [ ] è—ç¶ éƒ¨ç½²å¯¦æ–½
  - [ ] å®¹å™¨åŒ–é…ç½®å„ªåŒ–
  - [ ] è‡ªå‹•æ“´ç¸®å®¹è¨­å®š
  - [ ] å¥åº·æª¢æŸ¥é…ç½®
  - [ ] å›æ»¾æ©Ÿåˆ¶æº–å‚™

- [ ] **ç›£æ§é«”ç³»**
  - [ ] æ€§èƒ½æŒ‡æ¨™æ”¶é›†
  - [ ] ç”¨æˆ¶é«”é©—ç›£æ§
  - [ ] éŒ¯èª¤æ—¥èªŒåˆ†æ
  - [ ] æ¥­å‹™æŒ‡æ¨™è¿½è¹¤
  - [ ] è­¦å ±é–¾å€¼è¨­å®š

---

## ğŸ¯ å„ªåŒ–å¯¦æ–½è¨ˆåŠƒ

### Phase 1: åŸºç¤å„ªåŒ– (1-2é€±)
**å„ªå…ˆç´šï¼šé«˜å½±éŸ¿ã€ä½é›£åº¦**
- [ ] å•Ÿç”¨ gzip å£“ç¸®
- [ ] åœ–ç‰‡æ ¼å¼å„ªåŒ–
- [ ] åŸºæœ¬å¿«å–è¨­å®š
- [ ] æ•¸æ“šåº«ç´¢å¼•æª¢æŸ¥
- [ ] ç°¡å–®æŸ¥è©¢å„ªåŒ–

**é æœŸæ•ˆæœï¼š**
- é é¢è¼‰å…¥æ™‚é–“æ¸›å°‘ 20-30%
- æœå‹™å™¨éŸ¿æ‡‰æ™‚é–“æå‡ 15-25%
- ç”¨æˆ¶é«”é©—é¡¯è‘—æ”¹å–„

### Phase 2: é€²éšå„ªåŒ– (3-4é€±)
**å„ªå…ˆç´šï¼šä¸­ç­‰å½±éŸ¿ã€ä¸­ç­‰é›£åº¦**
- [ ] ä»£ç¢¼åˆ†å‰²å¯¦æ–½
- [ ] Service Worker éƒ¨ç½²
- [ ] æ•¸æ“šåº«é€£æ¥æ± å„ªåŒ–
- [ ] è² è¼‰å‡è¡¡é…ç½®
- [ ] API éŸ¿æ‡‰å¿«å–

**é æœŸæ•ˆæœï¼š**
- é¦–å±è¼‰å…¥æ™‚é–“æ¸›å°‘ 40-50%
- ä½µç™¼è™•ç†èƒ½åŠ›æå‡ 2-3å€
- ç³»çµ±ç©©å®šæ€§å¢å¼·

### Phase 3: æ¶æ§‹å„ªåŒ– (4-6é€±)
**å„ªå…ˆç´šï¼šé«˜å½±éŸ¿ã€é«˜é›£åº¦**
- [ ] å¾®æœå‹™æ¶æ§‹å„ªåŒ–
- [ ] åˆ†æ•£å¼å¿«å–å¯¦æ–½
- [ ] ç•°æ­¥è™•ç†æ¶æ§‹
- [ ] CDN å…¨çƒéƒ¨ç½²
- [ ] ç›£æ§ç³»çµ±å®Œå–„

**é æœŸæ•ˆæœï¼š**
- ç³»çµ±æ•´é«”æ€§èƒ½æå‡ 50-70%
- å¯æ“´å±•æ€§å¤§å¹…å¢å¼·
- é‹ç¶­æ•ˆç‡é¡¯è‘—æå‡

### Phase 4: æŒçºŒå„ªåŒ– (æŒçºŒé€²è¡Œ)
**å„ªå…ˆç´šï¼šæŒçºŒæ”¹é€²**
- [ ] æ€§èƒ½ç›£æ§å’Œåˆ†æ
- [ ] A/B æ¸¬è©¦å„ªåŒ–
- [ ] ç”¨æˆ¶åé¥‹æ”¶é›†
- [ ] æ–°æŠ€è¡“è©•ä¼°å’Œæ‡‰ç”¨
- [ ] æ€§èƒ½é ç®—ç®¡ç†

**é æœŸæ•ˆæœï¼š**
- å»ºç«‹æ€§èƒ½å„ªåŒ–æ–‡åŒ–
- æŒçºŒçš„æ€§èƒ½æ”¹é€²
- æŠ€è¡“å‚µå‹™æ§åˆ¶